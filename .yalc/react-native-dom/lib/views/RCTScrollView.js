Object.defineProperty(exports,"__esModule",{value:true});exports.RCTScrollContentView=undefined;var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray");var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _get2=require("babel-runtime/helpers/get");var _get3=_interopRequireDefault(_get2);var _set2=require("babel-runtime/helpers/set");var _set3=_interopRequireDefault(_set2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _extends2=require("babel-runtime/helpers/extends");var _extends3=_interopRequireDefault(_extends2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_class,_dec2,_class2;var _RCTView3=require("./RCTView");var _RCTView4=_interopRequireDefault(_RCTView3);var _UIView=require("./../base/UIView");var _UIView2=_interopRequireDefault(_UIView);var _CustomElement=require("./../utils/CustomElement");var _CustomElement2=_interopRequireDefault(_CustomElement);var _detectIt=require("detect-it");var _detectIt2=_interopRequireDefault(_detectIt);var _RCTScrollViewLocalData=require("./RCTScrollViewLocalData");var _RCTScrollViewLocalData2=_interopRequireDefault(_RCTScrollViewLocalData);var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);var _debounce=require("debounce");var _debounce2=_interopRequireDefault(_debounce);var _RCTEventDispatcher=require("./../bridge/RCTEventDispatcher");var _RCTEventDispatcher2=_interopRequireDefault(_RCTEventDispatcher);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var SCROLL_LISTENER_OPTIONS=_detectIt2.default.passiveEvents?{passive:true}:false;var SHOULD_CORRECT_SCROLL=!!navigator.platform.match(/iPhone|iPod|iPad/g);var RCTScrollEvent=function(){function RCTScrollEvent(eventName,reactTag,contentOffset,contentInset,contentSize,scrollFrame,zoomScale,coalescingKey,userData){(0,_classCallCheck3.default)(this,RCTScrollEvent);this.eventName=eventName;this.viewTag=reactTag;this.scrollViewContentOffset=contentOffset;this.scrollViewContentInset=contentInset;this.scrollViewContentSize=contentSize;this.scrollViewFrame=scrollFrame;this.scrollViewZoomScale=zoomScale;this.userData=userData;this.coalescingKey=coalescingKey;}(0,_createClass3.default)(RCTScrollEvent,[{key:"canCoalesce",value:function canCoalesce(){return true;}},{key:"coalesceWithEvent",value:function coalesceWithEvent(newEvent){var updatedChildFrames=[];if(this.userData&&this.userData.updatedChildFrames)updatedChildFrames=updatedChildFrames.concat(this.userData.updatedChildFrames);if(newEvent.userData&&newEvent.userData.updatedChildFrames)updatedChildFrames=updatedChildFrames.concat(newEvent.userData.updatedChildFrames);if(updatedChildFrames.length!==0){newEvent.userData={updatedChildFrames:updatedChildFrames};}return newEvent;}},{key:"moduleDotMethod",value:function moduleDotMethod(){return"RCTEventEmitter.receiveEvent";}},{key:"arguments",value:function _arguments(){var args=[this.viewTag,(0,_RCTEventDispatcher.normalizeInputEventName)(this.eventName),this.body];return args;}},{key:"body",get:function get(){var body={contentOffset:(0,_extends3.default)({},this.scrollViewContentOffset),contentInset:(0,_extends3.default)({},this.scrollViewContentInset),contentSize:(0,_extends3.default)({},this.scrollViewContentSize),layoutMeasurement:{width:this.scrollViewFrame.width,height:this.scrollViewFrame.height},zoomScale:this.scrollViewZoomScale};var userData=this.userData;if(userData){body=(0,_extends3.default)({},body,userData);}return body;}}]);return RCTScrollEvent;}();var RCTScrollContentView=exports.RCTScrollContentView=(_dec=(0,_CustomElement2.default)("rct-scroll-content-view"),_dec(_class=function(_RCTView){(0,_inherits3.default)(RCTScrollContentView,_RCTView);function RCTScrollContentView(bridge){(0,_classCallCheck3.default)(this,RCTScrollContentView);var _this=(0,_possibleConstructorReturn3.default)(this,(RCTScrollContentView.__proto__||Object.getPrototypeOf(RCTScrollContentView)).call(this,bridge));_this.updateHostStyle({position:"relative",display:"block",opacity:"1",willChange:"transform"});return _this;}(0,_createClass3.default)(RCTScrollContentView,[{key:"frame",set:function set(value){(0,_set3.default)(RCTScrollContentView.prototype.__proto__||Object.getPrototypeOf(RCTScrollContentView.prototype),"frame",value,this);var superView=this.reactSuperview;var subView=this.reactSubviews[0];if(subView&&subView instanceof _RCTView4.default&&superView&&superView instanceof RCTScrollView){superView.boundsDidChange(subView);}},get:function get(){return(0,_get3.default)(RCTScrollContentView.prototype.__proto__||Object.getPrototypeOf(RCTScrollContentView.prototype),"frame",this);}}]);return RCTScrollContentView;}(_RCTView4.default))||_class);var RCTScrollView=(_dec2=(0,_CustomElement2.default)("rct-scroll-view"),_dec2(_class2=function(_RCTView2){(0,_inherits3.default)(RCTScrollView,_RCTView2);function RCTScrollView(bridge){var _this3=this;(0,_classCallCheck3.default)(this,RCTScrollView);var _this2=(0,_possibleConstructorReturn3.default)(this,(RCTScrollView.__proto__||Object.getPrototypeOf(RCTScrollView)).call(this,bridge));_this2.contentSize={width:0,height:0};_this2.handleScroll=function _callee(e,userData){var scrollLeft,scrollTop,contentOffset,contentInset,contentSize,contentFrame,args;return _regenerator2.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this2.coalescingKey++;scrollLeft=_this2.scrollLeft;scrollTop=_this2.scrollTop;contentOffset={x:scrollLeft,y:scrollTop};_this2.scrollDidChange(scrollLeft,scrollTop);contentInset={top:0,left:0,bottom:0,right:0};contentSize={width:_this2.scrollWidth,height:_this2.scrollHeight};_context.next=9;return _regenerator2.default.awrap(_this2.manager.measure(_this2.reactTag));case 9:contentFrame=_context.sent;args=[_this2.reactTag,contentOffset,contentInset,contentSize,contentFrame,1,_this2.coalescingKey,userData];_this2.debouncedOnScrollEnd.apply(_this2,args);if(_this2.isScrolling){_this2.handleScrollTick.apply(_this2,args);}else{_this2.handleScrollStart.apply(_this2,args);}case 13:case"end":return _context.stop();}}},null,_this3);};_this2.debouncedOnScrollEnd=(0,_debounce2.default)(_this2.handleScrollEnd,100);_this2.manager=bridge.uiManager;_this2.updateHostStyle("contain","strict");if(!_this2.hasScrollParent()){_this2.updateHostStyle("overscrollBehavior","contain");_this2.addEventListener("touchstart",function(){var top=_this2.scrollTop;var totalScroll=_this2.scrollHeight;var currentScroll=top+_this2.offsetHeight;if(top===0){_this2.scrollTop=1;}else if(currentScroll===totalScroll){_this2.scrollTop=top-1;}},false);}_this2.isScrolling=false;_this2.scrollEventThrottle=0;_this2.coalescingKey=0;_this2.cachedChildFrames=[];_this2._horizontal=false;_this2._overflow="scroll";_this2._scrollEnabled=true;_this2.updateTransform();_this2.addEventListener("scroll",_this2.handleScroll,SCROLL_LISTENER_OPTIONS);return _this2;}(0,_createClass3.default)(RCTScrollView,[{key:"hasScrollParent",value:function hasScrollParent(){var currentView=this;while(currentView.reactSuperview){if(currentView instanceof RCTScrollView){return true;}currentView=currentView.reactSuperView;}return false;}},{key:"updateScrollBehavior",value:function updateScrollBehavior(){var styleUpdate={};if(this._overflow==="scroll"&&this._scrollEnabled){styleUpdate.msOverflowStyle="-ms-autohiding-scrollbar";styleUpdate.webkitOverflowScrolling="touch";styleUpdate.scrollBehavior="smooth";styleUpdate.willChange="transform";if(this._horizontal){styleUpdate.overflowX="auto";styleUpdate.overflowY="hidden";}else{styleUpdate.overflowX="hidden";styleUpdate.overflowY="auto";}}else{styleUpdate.msOverflowStyle="auto";styleUpdate.webkitOverflowScrolling="";styleUpdate.willChange="";styleUpdate.overflowX="hidden";styleUpdate.overflowY="hidden";}this.updateHostStyle(styleUpdate);}},{key:"calculateChildFramesData",value:function calculateChildFramesData(){var _this4=this;var updatedChildFrames=[];var contentView=this.reactSubviews[0];(0,_Invariant2.default)(contentView&&contentView instanceof RCTScrollContentView,"RCTScrollView (of ID "+this.reactTag+") has no contentView");contentView.reactSubviews.forEach(function(subview,idx){var newFrame=subview.frame;var frameChanged=false;if(_this4.cachedChildFrames.length<=idx){frameChanged=true;}else if(JSON.stringify(newFrame)!==JSON.stringify(_this4.cachedChildFrames[idx])){frameChanged=true;}if(frameChanged){updatedChildFrames.push({index:idx,x:newFrame.left,y:newFrame.top,width:newFrame.width,height:newFrame.height});}});return updatedChildFrames;}},{key:"connectedCallback",value:function connectedCallback(){if(SHOULD_CORRECT_SCROLL){if(this._horizontal){this.scrollLeft=1;}else{this.scrollTop=1;}}}},{key:"boundsDidChange",value:function boundsDidChange(contentView){this.coalescingKey++;var childFrames=this.calculateChildFramesData();var contentOffset={x:this.scrollLeft,y:this.scrollTop};var contentInset={top:0,left:0,bottom:0,right:0};var contentSize={width:this.scrollWidth,height:this.scrollHeight};var shadowView=this.manager.shadowViewRegistry.get(this.reactTag);(0,_Invariant2.default)(shadowView,"No ShadowView for tag "+this.reactTag);var contentFrame=shadowView.previousLayout;(0,_Invariant2.default)(contentFrame,"ShadowView with tag "+this.reactTag+" has not been layed out");this.contentSize={width:contentFrame.width,height:contentFrame.height};var args=[this.reactTag,contentOffset,contentInset,contentSize,contentFrame,1,this.coalescingKey];this.bridge.eventDispatcher.sendEvent(new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScroll"],args,[{updatedChildFrames:childFrames}])))());}},{key:"scrollDidChange",value:function scrollDidChange(x,y){var _this5=this;setTimeout(function(){var localData=new _RCTScrollViewLocalData2.default(x,y);_this5.bridge.uiManager.setLocalDataForView(localData,_this5);},0);}},{key:"handleScrollStart",value:function handleScrollStart(){this.isScrolling=true;this._scrollLastTick=Date.now();for(var _len=arguments.length,eventArgs=Array(_len),_key=0;_key<_len;_key++){eventArgs[_key]=arguments[_key];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScrollBeginDrag"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);}},{key:"handleScrollEnd",value:function handleScrollEnd(){this.isScrolling=false;for(var _len2=arguments.length,eventArgs=Array(_len2),_key2=0;_key2<_len2;_key2++){eventArgs[_key2]=arguments[_key2];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScrollEndDrag"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);var momentumScrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onMomentumScrollEnd"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(momentumScrollEvent);}},{key:"handleScrollTick",value:function handleScrollTick(){var shouldEmitScrollEvent=this.shouldEmitScrollEvent(this._scrollLastTick,this.scrollEventThrottle);if(shouldEmitScrollEvent){this._scrollLastTick=Date.now();for(var _len3=arguments.length,eventArgs=Array(_len3),_key3=0;_key3<_len3;_key3++){eventArgs[_key3]=arguments[_key3];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScroll"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);}}},{key:"shouldEmitScrollEvent",value:function shouldEmitScrollEvent(lastTick,eventThrottle){var timeSinceLastTick=Date.now()-lastTick;return eventThrottle>0&&timeSinceLastTick>=eventThrottle;}},{key:"scrollEnabled",set:function set(value){this._scrollEnabled=!!value;this.updateScrollBehavior();}},{key:"horizontal",set:function set(value){this._horizontal=!!value;this.updateScrollBehavior();}},{key:"overflow",set:function set(value){if(value!=null){this._overflow=value;}else{this._overflow="hidden";}this.updateScrollBehavior();}},{key:"touchable",get:function get(){return(0,_get3.default)(RCTScrollView.prototype.__proto__||Object.getPrototypeOf(RCTScrollView.prototype),"touchable",this);},set:function set(value){(0,_set3.default)(RCTScrollView.prototype.__proto__||Object.getPrototypeOf(RCTScrollView.prototype),"touchable",value,this);this.updateHostStyle("cursor","auto");}}]);return RCTScrollView;}(_RCTView4.default))||_class2);exports.default=RCTScrollView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL3ZpZXdzL1JDVFNjcm9sbFZpZXcuanMiXSwibmFtZXMiOlsiU0NST0xMX0xJU1RFTkVSX09QVElPTlMiLCJwYXNzaXZlRXZlbnRzIiwicGFzc2l2ZSIsIlNIT1VMRF9DT1JSRUNUX1NDUk9MTCIsIm5hdmlnYXRvciIsInBsYXRmb3JtIiwibWF0Y2giLCJSQ1RTY3JvbGxFdmVudCIsImV2ZW50TmFtZSIsInJlYWN0VGFnIiwiY29udGVudE9mZnNldCIsImNvbnRlbnRJbnNldCIsImNvbnRlbnRTaXplIiwic2Nyb2xsRnJhbWUiLCJ6b29tU2NhbGUiLCJjb2FsZXNjaW5nS2V5IiwidXNlckRhdGEiLCJ2aWV3VGFnIiwic2Nyb2xsVmlld0NvbnRlbnRPZmZzZXQiLCJzY3JvbGxWaWV3Q29udGVudEluc2V0Iiwic2Nyb2xsVmlld0NvbnRlbnRTaXplIiwic2Nyb2xsVmlld0ZyYW1lIiwic2Nyb2xsVmlld1pvb21TY2FsZSIsIm5ld0V2ZW50IiwidXBkYXRlZENoaWxkRnJhbWVzIiwiY29uY2F0IiwibGVuZ3RoIiwiYXJncyIsImJvZHkiLCJsYXlvdXRNZWFzdXJlbWVudCIsIndpZHRoIiwiaGVpZ2h0IiwiUkNUU2Nyb2xsQ29udGVudFZpZXciLCJicmlkZ2UiLCJ1cGRhdGVIb3N0U3R5bGUiLCJwb3NpdGlvbiIsImRpc3BsYXkiLCJvcGFjaXR5Iiwid2lsbENoYW5nZSIsInZhbHVlIiwic3VwZXJWaWV3IiwicmVhY3RTdXBlcnZpZXciLCJzdWJWaWV3IiwicmVhY3RTdWJ2aWV3cyIsIlJDVFNjcm9sbFZpZXciLCJib3VuZHNEaWRDaGFuZ2UiLCJoYW5kbGVTY3JvbGwiLCJlIiwic2Nyb2xsTGVmdCIsInNjcm9sbFRvcCIsIngiLCJ5Iiwic2Nyb2xsRGlkQ2hhbmdlIiwidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0Iiwic2Nyb2xsV2lkdGgiLCJzY3JvbGxIZWlnaHQiLCJtYW5hZ2VyIiwibWVhc3VyZSIsImNvbnRlbnRGcmFtZSIsImRlYm91bmNlZE9uU2Nyb2xsRW5kIiwiaXNTY3JvbGxpbmciLCJoYW5kbGVTY3JvbGxUaWNrIiwiaGFuZGxlU2Nyb2xsU3RhcnQiLCJoYW5kbGVTY3JvbGxFbmQiLCJ1aU1hbmFnZXIiLCJoYXNTY3JvbGxQYXJlbnQiLCJhZGRFdmVudExpc3RlbmVyIiwidG90YWxTY3JvbGwiLCJjdXJyZW50U2Nyb2xsIiwib2Zmc2V0SGVpZ2h0Iiwic2Nyb2xsRXZlbnRUaHJvdHRsZSIsImNhY2hlZENoaWxkRnJhbWVzIiwiX2hvcml6b250YWwiLCJfb3ZlcmZsb3ciLCJfc2Nyb2xsRW5hYmxlZCIsInVwZGF0ZVRyYW5zZm9ybSIsImN1cnJlbnRWaWV3IiwicmVhY3RTdXBlclZpZXciLCJzdHlsZVVwZGF0ZSIsIm1zT3ZlcmZsb3dTdHlsZSIsIndlYmtpdE92ZXJmbG93U2Nyb2xsaW5nIiwic2Nyb2xsQmVoYXZpb3IiLCJvdmVyZmxvd1giLCJvdmVyZmxvd1kiLCJjb250ZW50VmlldyIsImZvckVhY2giLCJzdWJ2aWV3IiwiaWR4IiwibmV3RnJhbWUiLCJmcmFtZSIsImZyYW1lQ2hhbmdlZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwdXNoIiwiaW5kZXgiLCJjaGlsZEZyYW1lcyIsImNhbGN1bGF0ZUNoaWxkRnJhbWVzRGF0YSIsInNoYWRvd1ZpZXciLCJzaGFkb3dWaWV3UmVnaXN0cnkiLCJnZXQiLCJwcmV2aW91c0xheW91dCIsImV2ZW50RGlzcGF0Y2hlciIsInNlbmRFdmVudCIsInNldFRpbWVvdXQiLCJsb2NhbERhdGEiLCJzZXRMb2NhbERhdGFGb3JWaWV3IiwiX3Njcm9sbExhc3RUaWNrIiwiRGF0ZSIsIm5vdyIsImV2ZW50QXJncyIsInNjcm9sbEV2ZW50IiwibW9tZW50dW1TY3JvbGxFdmVudCIsInNob3VsZEVtaXRTY3JvbGxFdmVudCIsImxhc3RUaWNrIiwiZXZlbnRUaHJvdHRsZSIsInRpbWVTaW5jZUxhc3RUaWNrIiwidXBkYXRlU2Nyb2xsQmVoYXZpb3IiXSwibWFwcGluZ3MiOiJtcUNBS0EsbUMs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QUFLZ0Ysb0JBQUwsR0FDRCxDLHFDQUVjaEYsSyxDQUFpQixDQUM5QixLQUFLb0MsV0FBTCxDQUFtQixDQUFDLENBQUNwQyxLQUFyQixDQUNBLEtBQUtnRixvQkFBTCxHQUNELEMsbUNBRVloRixLLENBQWdCLENBQzNCLEdBQUlBLE9BQVMsSUFBYixDQUFtQixDQUNqQixLQUFLcUMsU0FBTCxDQUFpQnJDLEtBQWpCLENBQ0QsQ0FGRCxJQUVPLENBQ0wsS0FBS3FDLFNBQUwsQ0FBaUIsUUFBakIsQ0FDRCxDQUNELEtBQUsyQyxvQkFBTCxHQUNELEMscUNBZ093QixDQUN2Qiw0SEFDRCxDLGtCQUVhaEYsSyxDQUFnQixDQUM1QixnSEFBa0JBLEtBQWxCLE9BQ0EsS0FBS0wsZUFBTCxDQUFxQixRQUFyQixDQUErQixNQUEvQixFQUNELEMseUVBR1lVLGEiLCJmaWxlIjoiUkNUU2Nyb2xsVmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHByb3ZpZGVzTW9kdWxlIFJDVFNjcm9sbFZpZXdcbiAqIEBmbG93XG4gKi9cblxuaW1wb3J0IFJDVFZpZXcgZnJvbSBcIlJDVFZpZXdcIjtcbmltcG9ydCBVSVZpZXcgZnJvbSBcIlVJVmlld1wiO1xuaW1wb3J0IHR5cGUgUkNUQnJpZGdlIGZyb20gXCJSQ1RCcmlkZ2VcIjtcbmltcG9ydCBDdXN0b21FbGVtZW50IGZyb20gXCJDdXN0b21FbGVtZW50XCI7XG5pbXBvcnQgdHlwZSB7IFJDVEV2ZW50IH0gZnJvbSBcIlJDVEV2ZW50RGlzcGF0Y2hlclwiO1xuaW1wb3J0IGRldGVjdEl0IGZyb20gXCJkZXRlY3QtaXRcIjtcbmltcG9ydCBSQ1RTY3JvbGxWaWV3TG9jYWxEYXRhIGZyb20gXCJSQ1RTY3JvbGxWaWV3TG9jYWxEYXRhXCI7XG5cbmltcG9ydCBpbnZhcmlhbnQgZnJvbSBcIkludmFyaWFudFwiO1xuaW1wb3J0IGRlYm91bmNlIGZyb20gXCJkZWJvdW5jZVwiO1xuaW1wb3J0IFJDVEV2ZW50RGlzcGF0Y2hlciwge1xuICBub3JtYWxpemVJbnB1dEV2ZW50TmFtZVxufSBmcm9tIFwiUkNURXZlbnREaXNwYXRjaGVyXCI7XG5cbmNvbnN0IFNDUk9MTF9MSVNURU5FUl9PUFRJT05TID0gZGV0ZWN0SXQucGFzc2l2ZUV2ZW50c1xuICA/IHsgcGFzc2l2ZTogdHJ1ZSB9XG4gIDogZmFsc2U7XG5cbmNvbnN0IFNIT1VMRF9DT1JSRUNUX1NDUk9MTCA9ICEhbmF2aWdhdG9yLnBsYXRmb3JtLm1hdGNoKC9pUGhvbmV8aVBvZHxpUGFkL2cpO1xuXG50eXBlIFNjcm9sbEV2ZW50QXJncyA9IFtcbiAgbnVtYmVyLFxuICBQb3NpdGlvbixcbiAgSW5zZXQsXG4gIFNpemUsXG4gIEZyYW1lLFxuICBudW1iZXIsXG4gIG51bWJlcixcbiAgP09iamVjdFxuXTtcblxuLy8gJEZsb3dGaXhNZSAtIGNvYWxlc2NlV2l0aEV2ZW50IHNob3VsZCBiZSBjb21wYXRpYmxlIGJ1dCBJIHRoaW5rIGZsb3cgaGFzIGEgYnVnXG5jbGFzcyBSQ1RTY3JvbGxFdmVudCBpbXBsZW1lbnRzIFJDVEV2ZW50IHtcbiAgLy8gaW50ZXJmYWNlIHByb3BlcnRpZXNcbiAgdmlld1RhZzogbnVtYmVyO1xuICBldmVudE5hbWU6IHN0cmluZztcbiAgY29hbGVzY2luZ0tleTogbnVtYmVyO1xuXG4gIHNjcm9sbFZpZXdDb250ZW50T2Zmc2V0OiBQb3NpdGlvbjtcbiAgc2Nyb2xsVmlld0NvbnRlbnRJbnNldDogSW5zZXQ7XG4gIHNjcm9sbFZpZXdDb250ZW50U2l6ZTogU2l6ZTtcbiAgc2Nyb2xsVmlld0ZyYW1lOiBGcmFtZTtcbiAgc2Nyb2xsVmlld1pvb21TY2FsZTogbnVtYmVyO1xuICB1c2VyRGF0YTogP09iamVjdDtcblxuICBjb25zdHJ1Y3RvcihcbiAgICBldmVudE5hbWU6IHN0cmluZyxcbiAgICByZWFjdFRhZzogbnVtYmVyLFxuICAgIGNvbnRlbnRPZmZzZXQ6IFBvc2l0aW9uLFxuICAgIGNvbnRlbnRJbnNldDogSW5zZXQsXG4gICAgY29udGVudFNpemU6IFNpemUsXG4gICAgc2Nyb2xsRnJhbWU6IEZyYW1lLFxuICAgIHpvb21TY2FsZTogbnVtYmVyLFxuICAgIGNvYWxlc2NpbmdLZXk6IG51bWJlcixcbiAgICB1c2VyRGF0YTogP09iamVjdFxuICApIHtcbiAgICB0aGlzLmV2ZW50TmFtZSA9IGV2ZW50TmFtZTtcbiAgICB0aGlzLnZpZXdUYWcgPSByZWFjdFRhZztcbiAgICB0aGlzLnNjcm9sbFZpZXdDb250ZW50T2Zmc2V0ID0gY29udGVudE9mZnNldDtcbiAgICB0aGlzLnNjcm9sbFZpZXdDb250ZW50SW5zZXQgPSBjb250ZW50SW5zZXQ7XG4gICAgdGhpcy5zY3JvbGxWaWV3Q29udGVudFNpemUgPSBjb250ZW50U2l6ZTtcbiAgICB0aGlzLnNjcm9sbFZpZXdGcmFtZSA9IHNjcm9sbEZyYW1lO1xuICAgIHRoaXMuc2Nyb2xsVmlld1pvb21TY2FsZSA9IHpvb21TY2FsZTtcbiAgICB0aGlzLnVzZXJEYXRhID0gdXNlckRhdGE7XG4gICAgdGhpcy5jb2FsZXNjaW5nS2V5ID0gY29hbGVzY2luZ0tleTtcbiAgfVxuXG4gIGdldCBib2R5KCkge1xuICAgIGxldCBib2R5ID0ge1xuICAgICAgY29udGVudE9mZnNldDoge1xuICAgICAgICAuLi50aGlzLnNjcm9sbFZpZXdDb250ZW50T2Zmc2V0XG4gICAgICB9LFxuICAgICAgY29udGVudEluc2V0OiB7XG4gICAgICAgIC4uLnRoaXMuc2Nyb2xsVmlld0NvbnRlbnRJbnNldFxuICAgICAgfSxcbiAgICAgIGNvbnRlbnRTaXplOiB7XG4gICAgICAgIC4uLnRoaXMuc2Nyb2xsVmlld0NvbnRlbnRTaXplXG4gICAgICB9LFxuICAgICAgbGF5b3V0TWVhc3VyZW1lbnQ6IHtcbiAgICAgICAgd2lkdGg6IHRoaXMuc2Nyb2xsVmlld0ZyYW1lLndpZHRoLFxuICAgICAgICBoZWlnaHQ6IHRoaXMuc2Nyb2xsVmlld0ZyYW1lLmhlaWdodFxuICAgICAgfSxcbiAgICAgIHpvb21TY2FsZTogdGhpcy5zY3JvbGxWaWV3Wm9vbVNjYWxlXG4gICAgfTtcblxuICAgIGNvbnN0IHVzZXJEYXRhID0gdGhpcy51c2VyRGF0YTtcbiAgICBpZiAodXNlckRhdGEpIHtcbiAgICAgIGJvZHkgPSB7IC4uLmJvZHksIC4uLnVzZXJEYXRhIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIGJvZHk7XG4gIH1cblxuICBjYW5Db2FsZXNjZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gdHJ1ZTtcbiAgfVxuXG4gIGNvYWxlc2NlV2l0aEV2ZW50KG5ld0V2ZW50OiBSQ1RTY3JvbGxFdmVudCk6IFJDVFNjcm9sbEV2ZW50IHtcbiAgICBsZXQgdXBkYXRlZENoaWxkRnJhbWVzID0gW107XG4gICAgaWYgKHRoaXMudXNlckRhdGEgJiYgdGhpcy51c2VyRGF0YS51cGRhdGVkQ2hpbGRGcmFtZXMpXG4gICAgICB1cGRhdGVkQ2hpbGRGcmFtZXMgPSB1cGRhdGVkQ2hpbGRGcmFtZXMuY29uY2F0KFxuICAgICAgICB0aGlzLnVzZXJEYXRhLnVwZGF0ZWRDaGlsZEZyYW1lc1xuICAgICAgKTtcbiAgICBpZiAobmV3RXZlbnQudXNlckRhdGEgJiYgbmV3RXZlbnQudXNlckRhdGEudXBkYXRlZENoaWxkRnJhbWVzKVxuICAgICAgdXBkYXRlZENoaWxkRnJhbWVzID0gdXBkYXRlZENoaWxkRnJhbWVzLmNvbmNhdChcbiAgICAgICAgbmV3RXZlbnQudXNlckRhdGEudXBkYXRlZENoaWxkRnJhbWVzXG4gICAgICApO1xuXG4gICAgaWYgKHVwZGF0ZWRDaGlsZEZyYW1lcy5sZW5ndGggIT09IDApIHtcbiAgICAgIG5ld0V2ZW50LnVzZXJEYXRhID0ge1xuICAgICAgICB1cGRhdGVkQ2hpbGRGcmFtZXNcbiAgICAgIH07XG4gICAgfVxuXG4gICAgcmV0dXJuIG5ld0V2ZW50O1xuICB9XG5cbiAgbW9kdWxlRG90TWV0aG9kKCk6IHN0cmluZyB7XG4gICAgcmV0dXJuIFwiUkNURXZlbnRFbWl0dGVyLnJlY2VpdmVFdmVudFwiO1xuICB9XG4gIGFyZ3VtZW50cygpOiBBcnJheTxhbnk+IHtcbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgdGhpcy52aWV3VGFnLFxuICAgICAgbm9ybWFsaXplSW5wdXRFdmVudE5hbWUodGhpcy5ldmVudE5hbWUpLFxuICAgICAgdGhpcy5ib2R5XG4gICAgXTtcbiAgICByZXR1cm4gYXJncztcbiAgfVxufVxuXG5AQ3VzdG9tRWxlbWVudChcInJjdC1zY3JvbGwtY29udGVudC12aWV3XCIpXG5leHBvcnQgY2xhc3MgUkNUU2Nyb2xsQ29udGVudFZpZXcgZXh0ZW5kcyBSQ1RWaWV3IHtcbiAgY29uc3RydWN0b3IoYnJpZGdlOiBSQ1RCcmlkZ2UpIHtcbiAgICBzdXBlcihicmlkZ2UpO1xuICAgIHRoaXMudXBkYXRlSG9zdFN0eWxlKHtcbiAgICAgIHBvc2l0aW9uOiBcInJlbGF0aXZlXCIsXG4gICAgICBkaXNwbGF5OiBcImJsb2NrXCIsXG4gICAgICBvcGFjaXR5OiBcIjFcIixcbiAgICAgIC8vIHZhc3RseSBpbXByb3ZlcyBzY3JvbGxpbmcgcGVyZm9ybWFuY2UgKGVzcGVjaWFsbHkgb24gc2ZhcmFpKVxuICAgICAgd2lsbENoYW5nZTogXCJ0cmFuc2Zvcm1cIlxuICAgIH0pO1xuICB9XG5cbiAgc2V0IGZyYW1lKHZhbHVlOiBGcmFtZSkge1xuICAgIHN1cGVyLmZyYW1lID0gdmFsdWU7XG5cbiAgICBjb25zdCBzdXBlclZpZXcgPSB0aGlzLnJlYWN0U3VwZXJ2aWV3O1xuICAgIGNvbnN0IHN1YlZpZXcgPSB0aGlzLnJlYWN0U3Vidmlld3NbMF07XG5cbiAgICBpZiAoXG4gICAgICBzdWJWaWV3ICYmXG4gICAgICBzdWJWaWV3IGluc3RhbmNlb2YgUkNUVmlldyAmJlxuICAgICAgc3VwZXJWaWV3ICYmXG4gICAgICBzdXBlclZpZXcgaW5zdGFuY2VvZiBSQ1RTY3JvbGxWaWV3XG4gICAgKSB7XG4gICAgICBzdXBlclZpZXcuYm91bmRzRGlkQ2hhbmdlKHN1YlZpZXcpO1xuICAgIH1cbiAgfVxuXG4gIGdldCBmcmFtZSgpOiBGcmFtZSB7XG4gICAgcmV0dXJuIHN1cGVyLmZyYW1lO1xuICB9XG59XG5cbnR5cGUgQ2hpbGRGcmFtZSA9IHtcbiAgaW5kZXg6IG51bWJlcixcbiAgeDogbnVtYmVyLFxuICB5OiBudW1iZXIsXG4gIHdpZHRoOiBudW1iZXIsXG4gIGhlaWdodDogbnVtYmVyXG59O1xuXG5AQ3VzdG9tRWxlbWVudChcInJjdC1zY3JvbGwtdmlld1wiKVxuY2xhc3MgUkNUU2Nyb2xsVmlldyBleHRlbmRzIFJDVFZpZXcge1xuICBicmlkZ2U6IFJDVEJyaWRnZTtcbiAgbWFuYWdlcjogKjtcblxuICBpc1Njcm9sbGluZzogYm9vbGVhbjtcbiAgc2Nyb2xsRXZlbnRUaHJvdHRsZTogbnVtYmVyO1xuICBfc2Nyb2xsTGFzdFRpY2s6IG51bWJlcjtcblxuICBfaG9yaXpvbnRhbDogYm9vbGVhbjtcbiAgX292ZXJmbG93OiBzdHJpbmc7XG4gIF9zY3JvbGxFbmFibGVkOiBib29sZWFuO1xuXG4gIGNvYWxlc2NpbmdLZXk6IG51bWJlcjtcbiAgY2FjaGVkQ2hpbGRGcmFtZXM6IEFycmF5PEZyYW1lPjtcblxuICBjb250ZW50U2l6ZTogU2l6ZSA9IHsgd2lkdGg6IDAsIGhlaWdodDogMCB9O1xuXG4gIGNvbnN0cnVjdG9yKGJyaWRnZTogUkNUQnJpZGdlKSB7XG4gICAgc3VwZXIoYnJpZGdlKTtcblxuICAgIHRoaXMubWFuYWdlciA9IGJyaWRnZS51aU1hbmFnZXI7XG5cbiAgICB0aGlzLnVwZGF0ZUhvc3RTdHlsZShcImNvbnRhaW5cIiwgXCJzdHJpY3RcIik7XG5cbiAgICBpZiAoIXRoaXMuaGFzU2Nyb2xsUGFyZW50KCkpIHtcbiAgICAgIHRoaXMudXBkYXRlSG9zdFN0eWxlKFwib3ZlcnNjcm9sbEJlaGF2aW9yXCIsIFwiY29udGFpblwiKTtcbiAgICAgIHRoaXMuYWRkRXZlbnRMaXN0ZW5lcihcbiAgICAgICAgXCJ0b3VjaHN0YXJ0XCIsXG4gICAgICAgICgpID0+IHtcbiAgICAgICAgICBjb25zdCB0b3AgPSB0aGlzLnNjcm9sbFRvcDtcbiAgICAgICAgICBjb25zdCB0b3RhbFNjcm9sbCA9IHRoaXMuc2Nyb2xsSGVpZ2h0O1xuICAgICAgICAgIGNvbnN0IGN1cnJlbnRTY3JvbGwgPSB0b3AgKyB0aGlzLm9mZnNldEhlaWdodDtcblxuICAgICAgICAgIGlmICh0b3AgPT09IDApIHtcbiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gMTtcbiAgICAgICAgICB9IGVsc2UgaWYgKGN1cnJlbnRTY3JvbGwgPT09IHRvdGFsU2Nyb2xsKSB7XG4gICAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IHRvcCAtIDE7XG4gICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICBmYWxzZVxuICAgICAgKTtcbiAgICB9XG5cbiAgICB0aGlzLmlzU2Nyb2xsaW5nID0gZmFsc2U7XG4gICAgdGhpcy5zY3JvbGxFdmVudFRocm90dGxlID0gMDtcblxuICAgIHRoaXMuY29hbGVzY2luZ0tleSA9IDA7XG4gICAgdGhpcy5jYWNoZWRDaGlsZEZyYW1lcyA9IFtdO1xuXG4gICAgdGhpcy5faG9yaXpvbnRhbCA9IGZhbHNlO1xuICAgIHRoaXMuX292ZXJmbG93ID0gXCJzY3JvbGxcIjtcbiAgICB0aGlzLl9zY3JvbGxFbmFibGVkID0gdHJ1ZTtcblxuICAgIHRoaXMudXBkYXRlVHJhbnNmb3JtKCk7XG5cbiAgICB0aGlzLmFkZEV2ZW50TGlzdGVuZXIoXCJzY3JvbGxcIiwgdGhpcy5oYW5kbGVTY3JvbGwsIFNDUk9MTF9MSVNURU5FUl9PUFRJT05TKTtcbiAgfVxuXG4gIGhhc1Njcm9sbFBhcmVudCgpIHtcbiAgICBsZXQgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgIHdoaWxlIChjdXJyZW50Vmlldy5yZWFjdFN1cGVydmlldykge1xuICAgICAgaWYgKGN1cnJlbnRWaWV3IGluc3RhbmNlb2YgUkNUU2Nyb2xsVmlldykge1xuICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgIH1cbiAgICAgIGN1cnJlbnRWaWV3ID0gY3VycmVudFZpZXcucmVhY3RTdXBlclZpZXc7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfVxuXG4gIHNldCBzY3JvbGxFbmFibGVkKHZhbHVlOiA/Ym9vbGVhbikge1xuICAgIHRoaXMuX3Njcm9sbEVuYWJsZWQgPSAhIXZhbHVlO1xuICAgIHRoaXMudXBkYXRlU2Nyb2xsQmVoYXZpb3IoKTtcbiAgfVxuXG4gIHNldCBob3Jpem9udGFsKHZhbHVlOiA/Ym9vbGVhbikge1xuICAgIHRoaXMuX2hvcml6b250YWwgPSAhIXZhbHVlO1xuICAgIHRoaXMudXBkYXRlU2Nyb2xsQmVoYXZpb3IoKTtcbiAgfVxuXG4gIHNldCBvdmVyZmxvdyh2YWx1ZTogP3N0cmluZykge1xuICAgIGlmICh2YWx1ZSAhPSBudWxsKSB7XG4gICAgICB0aGlzLl9vdmVyZmxvdyA9IHZhbHVlO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLl9vdmVyZmxvdyA9IFwiaGlkZGVuXCI7XG4gICAgfVxuICAgIHRoaXMudXBkYXRlU2Nyb2xsQmVoYXZpb3IoKTtcbiAgfVxuXG4gIHVwZGF0ZVNjcm9sbEJlaGF2aW9yKCkge1xuICAgIGNvbnN0IHN0eWxlVXBkYXRlID0ge307XG4gICAgaWYgKHRoaXMuX292ZXJmbG93ID09PSBcInNjcm9sbFwiICYmIHRoaXMuX3Njcm9sbEVuYWJsZWQpIHtcbiAgICAgIHN0eWxlVXBkYXRlLm1zT3ZlcmZsb3dTdHlsZSA9IFwiLW1zLWF1dG9oaWRpbmctc2Nyb2xsYmFyXCI7XG4gICAgICBzdHlsZVVwZGF0ZS53ZWJraXRPdmVyZmxvd1Njcm9sbGluZyA9IFwidG91Y2hcIjtcbiAgICAgIHN0eWxlVXBkYXRlLnNjcm9sbEJlaGF2aW9yID0gXCJzbW9vdGhcIjtcbiAgICAgIC8vIFRPRE86IE1ha2UgdGhpcyBjb25kaXRpb25hbCBiYXNlZCBvbiBzY3JlZW4gRFBJXG4gICAgICBzdHlsZVVwZGF0ZS53aWxsQ2hhbmdlID0gXCJ0cmFuc2Zvcm1cIjtcblxuICAgICAgaWYgKHRoaXMuX2hvcml6b250YWwpIHtcbiAgICAgICAgc3R5bGVVcGRhdGUub3ZlcmZsb3dYID0gXCJhdXRvXCI7XG4gICAgICAgIHN0eWxlVXBkYXRlLm92ZXJmbG93WSA9IFwiaGlkZGVuXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBzdHlsZVVwZGF0ZS5vdmVyZmxvd1ggPSBcImhpZGRlblwiO1xuICAgICAgICBzdHlsZVVwZGF0ZS5vdmVyZmxvd1kgPSBcImF1dG9cIjtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgc3R5bGVVcGRhdGUubXNPdmVyZmxvd1N0eWxlID0gXCJhdXRvXCI7XG4gICAgICBzdHlsZVVwZGF0ZS53ZWJraXRPdmVyZmxvd1Njcm9sbGluZyA9IFwiXCI7XG4gICAgICBzdHlsZVVwZGF0ZS53aWxsQ2hhbmdlID0gXCJcIjtcblxuICAgICAgc3R5bGVVcGRhdGUub3ZlcmZsb3dYID0gXCJoaWRkZW5cIjtcbiAgICAgIHN0eWxlVXBkYXRlLm92ZXJmbG93WSA9IFwiaGlkZGVuXCI7XG4gICAgfVxuXG4gICAgdGhpcy51cGRhdGVIb3N0U3R5bGUoc3R5bGVVcGRhdGUpO1xuICB9XG5cbiAgY2FsY3VsYXRlQ2hpbGRGcmFtZXNEYXRhKCkge1xuICAgIGNvbnN0IHVwZGF0ZWRDaGlsZEZyYW1lcyA9IFtdO1xuXG4gICAgY29uc3QgY29udGVudFZpZXcgPSB0aGlzLnJlYWN0U3Vidmlld3NbMF07XG4gICAgaW52YXJpYW50KFxuICAgICAgY29udGVudFZpZXcgJiYgY29udGVudFZpZXcgaW5zdGFuY2VvZiBSQ1RTY3JvbGxDb250ZW50VmlldyxcbiAgICAgIGBSQ1RTY3JvbGxWaWV3IChvZiBJRCAke3RoaXMucmVhY3RUYWd9KSBoYXMgbm8gY29udGVudFZpZXdgXG4gICAgKTtcblxuICAgIGNvbnRlbnRWaWV3LnJlYWN0U3Vidmlld3MuZm9yRWFjaCgoc3VidmlldywgaWR4KSA9PiB7XG4gICAgICBjb25zdCBuZXdGcmFtZSA9IHN1YnZpZXcuZnJhbWU7XG5cbiAgICAgIGxldCBmcmFtZUNoYW5nZWQgPSBmYWxzZTtcbiAgICAgIGlmICh0aGlzLmNhY2hlZENoaWxkRnJhbWVzLmxlbmd0aCA8PSBpZHgpIHtcbiAgICAgICAgZnJhbWVDaGFuZ2VkID0gdHJ1ZTtcbiAgICAgICAgLy8gdGhpcy5jYWNoZWRDaGlsZEZyYW1lcy5wdXNoKG5ld0ZyYW1lKTtcbiAgICAgIH0gZWxzZSBpZiAoXG4gICAgICAgIEpTT04uc3RyaW5naWZ5KG5ld0ZyYW1lKSAhPT0gSlNPTi5zdHJpbmdpZnkodGhpcy5jYWNoZWRDaGlsZEZyYW1lc1tpZHhdKVxuICAgICAgKSB7XG4gICAgICAgIGZyYW1lQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMuY2FjaGVkQ2hpbGRGcmFtZXNbaWR4XSA9IG5ld0ZyYW1lO1xuICAgICAgfVxuXG4gICAgICBpZiAoZnJhbWVDaGFuZ2VkKSB7XG4gICAgICAgIHVwZGF0ZWRDaGlsZEZyYW1lcy5wdXNoKHtcbiAgICAgICAgICBpbmRleDogaWR4LFxuICAgICAgICAgIHg6IG5ld0ZyYW1lLmxlZnQsXG4gICAgICAgICAgeTogbmV3RnJhbWUudG9wLFxuICAgICAgICAgIHdpZHRoOiBuZXdGcmFtZS53aWR0aCxcbiAgICAgICAgICBoZWlnaHQ6IG5ld0ZyYW1lLmhlaWdodFxuICAgICAgICB9KTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHJldHVybiB1cGRhdGVkQ2hpbGRGcmFtZXM7XG4gIH1cblxuICBjb25uZWN0ZWRDYWxsYmFjaygpIHtcbiAgICBpZiAoU0hPVUxEX0NPUlJFQ1RfU0NST0xMKSB7XG4gICAgICBpZiAodGhpcy5faG9yaXpvbnRhbCkge1xuICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSAxO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSAxO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGJvdW5kc0RpZENoYW5nZShjb250ZW50VmlldzogUkNUVmlldykge1xuICAgIHRoaXMuY29hbGVzY2luZ0tleSsrO1xuICAgIGNvbnN0IGNoaWxkRnJhbWVzID0gdGhpcy5jYWxjdWxhdGVDaGlsZEZyYW1lc0RhdGEoKTtcblxuICAgIGNvbnN0IGNvbnRlbnRPZmZzZXQ6IFBvc2l0aW9uID0ge1xuICAgICAgeDogdGhpcy5zY3JvbGxMZWZ0LFxuICAgICAgeTogdGhpcy5zY3JvbGxUb3BcbiAgICB9O1xuXG4gICAgY29uc3QgY29udGVudEluc2V0OiBJbnNldCA9IHtcbiAgICAgIHRvcDogMCxcbiAgICAgIGxlZnQ6IDAsXG4gICAgICBib3R0b206IDAsXG4gICAgICByaWdodDogMFxuICAgIH07XG5cbiAgICBjb25zdCBjb250ZW50U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiB0aGlzLnNjcm9sbFdpZHRoLFxuICAgICAgaGVpZ2h0OiB0aGlzLnNjcm9sbEhlaWdodFxuICAgIH07XG5cbiAgICAvLyBjb25zdCBjb250ZW50RnJhbWUgPSB0aGlzLm1hbmFnZXIubWVhc3VyZSh0aGlzLnJlYWN0VGFnKTtcbiAgICBjb25zdCBzaGFkb3dWaWV3ID0gdGhpcy5tYW5hZ2VyLnNoYWRvd1ZpZXdSZWdpc3RyeS5nZXQodGhpcy5yZWFjdFRhZyk7XG4gICAgaW52YXJpYW50KHNoYWRvd1ZpZXcsIGBObyBTaGFkb3dWaWV3IGZvciB0YWcgJHt0aGlzLnJlYWN0VGFnfWApO1xuICAgIGNvbnN0IGNvbnRlbnRGcmFtZSA9IHNoYWRvd1ZpZXcucHJldmlvdXNMYXlvdXQ7XG4gICAgaW52YXJpYW50KFxuICAgICAgY29udGVudEZyYW1lLFxuICAgICAgYFNoYWRvd1ZpZXcgd2l0aCB0YWcgJHt0aGlzLnJlYWN0VGFnfSBoYXMgbm90IGJlZW4gbGF5ZWQgb3V0YFxuICAgICk7XG5cbiAgICB0aGlzLmNvbnRlbnRTaXplID0ge1xuICAgICAgd2lkdGg6IGNvbnRlbnRGcmFtZS53aWR0aCxcbiAgICAgIGhlaWdodDogY29udGVudEZyYW1lLmhlaWdodFxuICAgIH07XG5cbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgdGhpcy5yZWFjdFRhZyxcbiAgICAgIGNvbnRlbnRPZmZzZXQsXG4gICAgICBjb250ZW50SW5zZXQsXG4gICAgICBjb250ZW50U2l6ZSxcbiAgICAgIGNvbnRlbnRGcmFtZSxcbiAgICAgIDEsXG4gICAgICB0aGlzLmNvYWxlc2NpbmdLZXlcbiAgICBdO1xuXG4gICAgdGhpcy5icmlkZ2UuZXZlbnREaXNwYXRjaGVyLnNlbmRFdmVudChcbiAgICAgIG5ldyBSQ1RTY3JvbGxFdmVudChcIm9uU2Nyb2xsXCIsIC4uLmFyZ3MsIHtcbiAgICAgICAgdXBkYXRlZENoaWxkRnJhbWVzOiBjaGlsZEZyYW1lc1xuICAgICAgfSlcbiAgICApO1xuICB9XG5cbiAgc2Nyb2xsRGlkQ2hhbmdlKHg6IG51bWJlciwgeTogbnVtYmVyKSB7XG4gICAgc2V0VGltZW91dCgoKSA9PiB7XG4gICAgICBjb25zdCBsb2NhbERhdGEgPSBuZXcgUkNUU2Nyb2xsVmlld0xvY2FsRGF0YSh4LCB5KTtcbiAgICAgIHRoaXMuYnJpZGdlLnVpTWFuYWdlci5zZXRMb2NhbERhdGFGb3JWaWV3KGxvY2FsRGF0YSwgdGhpcyk7XG4gICAgfSwgMCk7XG4gIH1cblxuICBoYW5kbGVTY3JvbGwgPSBhc3luYyAoZTogRXZlbnQsIHVzZXJEYXRhOiA/T2JqZWN0KSA9PiB7XG4gICAgdGhpcy5jb2FsZXNjaW5nS2V5Kys7XG5cbiAgICBjb25zdCBzY3JvbGxMZWZ0ID0gdGhpcy5zY3JvbGxMZWZ0O1xuICAgIGNvbnN0IHNjcm9sbFRvcCA9IHRoaXMuc2Nyb2xsVG9wO1xuXG4gICAgY29uc3QgY29udGVudE9mZnNldDogUG9zaXRpb24gPSB7XG4gICAgICB4OiBzY3JvbGxMZWZ0LFxuICAgICAgeTogc2Nyb2xsVG9wXG4gICAgfTtcblxuICAgIHRoaXMuc2Nyb2xsRGlkQ2hhbmdlKHNjcm9sbExlZnQsIHNjcm9sbFRvcCk7XG5cbiAgICBjb25zdCBjb250ZW50SW5zZXQ6IEluc2V0ID0ge1xuICAgICAgdG9wOiAwLFxuICAgICAgbGVmdDogMCxcbiAgICAgIGJvdHRvbTogMCxcbiAgICAgIHJpZ2h0OiAwXG4gICAgfTtcblxuICAgIGNvbnN0IGNvbnRlbnRTaXplID0ge1xuICAgICAgd2lkdGg6IHRoaXMuc2Nyb2xsV2lkdGgsXG4gICAgICBoZWlnaHQ6IHRoaXMuc2Nyb2xsSGVpZ2h0XG4gICAgfTtcblxuICAgIGNvbnN0IGNvbnRlbnRGcmFtZSA9IGF3YWl0IHRoaXMubWFuYWdlci5tZWFzdXJlKHRoaXMucmVhY3RUYWcpO1xuXG4gICAgY29uc3QgYXJncyA9IFtcbiAgICAgIHRoaXMucmVhY3RUYWcsXG4gICAgICBjb250ZW50T2Zmc2V0LFxuICAgICAgY29udGVudEluc2V0LFxuICAgICAgY29udGVudFNpemUsXG4gICAgICBjb250ZW50RnJhbWUsXG4gICAgICAxLFxuICAgICAgdGhpcy5jb2FsZXNjaW5nS2V5LFxuICAgICAgdXNlckRhdGFcbiAgICBdO1xuXG4gICAgdGhpcy5kZWJvdW5jZWRPblNjcm9sbEVuZCguLi5hcmdzKTtcblxuICAgIGlmICh0aGlzLmlzU2Nyb2xsaW5nKSB7XG4gICAgICB0aGlzLmhhbmRsZVNjcm9sbFRpY2soLi4uYXJncyk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGFuZGxlU2Nyb2xsU3RhcnQoLi4uYXJncyk7XG4gICAgfVxuICB9O1xuXG4gIGRlYm91bmNlZE9uU2Nyb2xsRW5kID0gZGVib3VuY2UodGhpcy5oYW5kbGVTY3JvbGxFbmQsIDEwMCk7XG5cbiAgaGFuZGxlU2Nyb2xsU3RhcnQoLi4uZXZlbnRBcmdzOiBTY3JvbGxFdmVudEFyZ3MpIHtcbiAgICB0aGlzLmlzU2Nyb2xsaW5nID0gdHJ1ZTtcbiAgICB0aGlzLl9zY3JvbGxMYXN0VGljayA9IERhdGUubm93KCk7XG5cbiAgICBjb25zdCBzY3JvbGxFdmVudCA9IG5ldyBSQ1RTY3JvbGxFdmVudChcIm9uU2Nyb2xsQmVnaW5EcmFnXCIsIC4uLmV2ZW50QXJncyk7XG4gICAgdGhpcy5icmlkZ2UuZXZlbnREaXNwYXRjaGVyLnNlbmRFdmVudChzY3JvbGxFdmVudCk7XG4gIH1cblxuICBoYW5kbGVTY3JvbGxFbmQoLi4uZXZlbnRBcmdzOiBTY3JvbGxFdmVudEFyZ3MpIHtcbiAgICB0aGlzLmlzU2Nyb2xsaW5nID0gZmFsc2U7XG5cbiAgICBjb25zdCBzY3JvbGxFdmVudCA9IG5ldyBSQ1RTY3JvbGxFdmVudChcIm9uU2Nyb2xsRW5kRHJhZ1wiLCAuLi5ldmVudEFyZ3MpO1xuICAgIHRoaXMuYnJpZGdlLmV2ZW50RGlzcGF0Y2hlci5zZW5kRXZlbnQoc2Nyb2xsRXZlbnQpO1xuXG4gICAgY29uc3QgbW9tZW50dW1TY3JvbGxFdmVudCA9IG5ldyBSQ1RTY3JvbGxFdmVudChcbiAgICAgIFwib25Nb21lbnR1bVNjcm9sbEVuZFwiLFxuICAgICAgLi4uZXZlbnRBcmdzXG4gICAgKTtcbiAgICB0aGlzLmJyaWRnZS5ldmVudERpc3BhdGNoZXIuc2VuZEV2ZW50KG1vbWVudHVtU2Nyb2xsRXZlbnQpO1xuICB9XG5cbiAgaGFuZGxlU2Nyb2xsVGljayguLi5ldmVudEFyZ3M6IFNjcm9sbEV2ZW50QXJncykge1xuICAgIGNvbnN0IHNob3VsZEVtaXRTY3JvbGxFdmVudCA9IHRoaXMuc2hvdWxkRW1pdFNjcm9sbEV2ZW50KFxuICAgICAgdGhpcy5fc2Nyb2xsTGFzdFRpY2ssXG4gICAgICB0aGlzLnNjcm9sbEV2ZW50VGhyb3R0bGVcbiAgICApO1xuXG4gICAgaWYgKHNob3VsZEVtaXRTY3JvbGxFdmVudCkge1xuICAgICAgdGhpcy5fc2Nyb2xsTGFzdFRpY2sgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3Qgc2Nyb2xsRXZlbnQgPSBuZXcgUkNUU2Nyb2xsRXZlbnQoXCJvblNjcm9sbFwiLCAuLi5ldmVudEFyZ3MpO1xuICAgICAgdGhpcy5icmlkZ2UuZXZlbnREaXNwYXRjaGVyLnNlbmRFdmVudChzY3JvbGxFdmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2hvdWxkRW1pdFNjcm9sbEV2ZW50KGxhc3RUaWNrOiBudW1iZXIsIGV2ZW50VGhyb3R0bGU6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RUaWNrID0gRGF0ZS5ub3coKSAtIGxhc3RUaWNrO1xuICAgIHJldHVybiBldmVudFRocm90dGxlID4gMCAmJiB0aW1lU2luY2VMYXN0VGljayA+PSBldmVudFRocm90dGxlO1xuICB9XG5cbiAgZ2V0IHRvdWNoYWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3VwZXIudG91Y2hhYmxlO1xuICB9XG5cbiAgc2V0IHRvdWNoYWJsZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHN1cGVyLnRvdWNoYWJsZSA9IHZhbHVlO1xuICAgIHRoaXMudXBkYXRlSG9zdFN0eWxlKFwiY3Vyc29yXCIsIFwiYXV0b1wiKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RTY3JvbGxWaWV3O1xuIl19