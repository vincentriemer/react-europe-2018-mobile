Object.defineProperty(exports,"__esModule",{value:true});exports.RCTScrollContentView=undefined;var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray");var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _get2=require("babel-runtime/helpers/get");var _get3=_interopRequireDefault(_get2);var _set2=require("babel-runtime/helpers/set");var _set3=_interopRequireDefault(_set2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _extends2=require("babel-runtime/helpers/extends");var _extends3=_interopRequireDefault(_extends2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_class,_dec2,_class2;var _RCTView3=require("./RCTView");var _RCTView4=_interopRequireDefault(_RCTView3);var _UIView=require("./../base/UIView");var _UIView2=_interopRequireDefault(_UIView);var _CustomElement=require("./../utils/CustomElement");var _CustomElement2=_interopRequireDefault(_CustomElement);var _detectIt=require("detect-it");var _detectIt2=_interopRequireDefault(_detectIt);var _RCTScrollViewLocalData=require("./RCTScrollViewLocalData");var _RCTScrollViewLocalData2=_interopRequireDefault(_RCTScrollViewLocalData);var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);var _debounce=require("debounce");var _debounce2=_interopRequireDefault(_debounce);var _RCTEventDispatcher=require("./../bridge/RCTEventDispatcher");var _RCTEventDispatcher2=_interopRequireDefault(_RCTEventDispatcher);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var SCROLL_LISTENER_OPTIONS=_detectIt2.default.passiveEvents?{passive:true}:false;var SHOULD_CORRECT_SCROLL=!!navigator.platform.match(/iPhone|iPod|iPad/g);var RCTScrollEvent=function(){function RCTScrollEvent(eventName,reactTag,contentOffset,contentInset,contentSize,scrollFrame,zoomScale,coalescingKey,userData){(0,_classCallCheck3.default)(this,RCTScrollEvent);this.eventName=eventName;this.viewTag=reactTag;this.scrollViewContentOffset=contentOffset;this.scrollViewContentInset=contentInset;this.scrollViewContentSize=contentSize;this.scrollViewFrame=scrollFrame;this.scrollViewZoomScale=zoomScale;this.userData=userData;this.coalescingKey=coalescingKey;}(0,_createClass3.default)(RCTScrollEvent,[{key:"canCoalesce",value:function canCoalesce(){return true;}},{key:"coalesceWithEvent",value:function coalesceWithEvent(newEvent){var updatedChildFrames=[];if(this.userData&&this.userData.updatedChildFrames)updatedChildFrames=updatedChildFrames.concat(this.userData.updatedChildFrames);if(newEvent.userData&&newEvent.userData.updatedChildFrames)updatedChildFrames=updatedChildFrames.concat(newEvent.userData.updatedChildFrames);if(updatedChildFrames.length!==0){newEvent.userData={updatedChildFrames:updatedChildFrames};}return newEvent;}},{key:"moduleDotMethod",value:function moduleDotMethod(){return"RCTEventEmitter.receiveEvent";}},{key:"arguments",value:function _arguments(){var args=[this.viewTag,(0,_RCTEventDispatcher.normalizeInputEventName)(this.eventName),this.body];return args;}},{key:"body",get:function get(){var body={contentOffset:(0,_extends3.default)({},this.scrollViewContentOffset),contentInset:(0,_extends3.default)({},this.scrollViewContentInset),contentSize:(0,_extends3.default)({},this.scrollViewContentSize),layoutMeasurement:{width:this.scrollViewFrame.width,height:this.scrollViewFrame.height},zoomScale:this.scrollViewZoomScale};var userData=this.userData;if(userData){body=(0,_extends3.default)({},body,userData);}return body;}}]);return RCTScrollEvent;}();var RCTScrollContentView=exports.RCTScrollContentView=(_dec=(0,_CustomElement2.default)("rct-scroll-content-view"),_dec(_class=function(_RCTView){(0,_inherits3.default)(RCTScrollContentView,_RCTView);function RCTScrollContentView(bridge){(0,_classCallCheck3.default)(this,RCTScrollContentView);var _this=(0,_possibleConstructorReturn3.default)(this,(RCTScrollContentView.__proto__||Object.getPrototypeOf(RCTScrollContentView)).call(this,bridge));_this.updateHostStyle({position:"relative",display:"block",opacity:"1",willChange:"transform"});return _this;}(0,_createClass3.default)(RCTScrollContentView,[{key:"frame",set:function set(value){(0,_set3.default)(RCTScrollContentView.prototype.__proto__||Object.getPrototypeOf(RCTScrollContentView.prototype),"frame",value,this);var superView=this.reactSuperview;var subView=this.reactSubviews[0];if(subView&&subView instanceof _RCTView4.default&&superView&&superView instanceof RCTScrollView){superView.boundsDidChange(subView);}},get:function get(){return(0,_get3.default)(RCTScrollContentView.prototype.__proto__||Object.getPrototypeOf(RCTScrollContentView.prototype),"frame",this);}}]);return RCTScrollContentView;}(_RCTView4.default))||_class);var RCTScrollView=(_dec2=(0,_CustomElement2.default)("rct-scroll-view"),_dec2(_class2=function(_RCTView2){(0,_inherits3.default)(RCTScrollView,_RCTView2);function RCTScrollView(bridge){var _this3=this;(0,_classCallCheck3.default)(this,RCTScrollView);var _this2=(0,_possibleConstructorReturn3.default)(this,(RCTScrollView.__proto__||Object.getPrototypeOf(RCTScrollView)).call(this,bridge));_this2.contentSize={width:0,height:0};_this2.handleScroll=function _callee(e,userData){var scrollLeft,scrollTop,contentOffset,contentInset,contentSize,contentFrame,args;return _regenerator2.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:_this2.coalescingKey++;scrollLeft=_this2.scrollLeft;scrollTop=_this2.scrollTop;contentOffset={x:scrollLeft,y:scrollTop};_this2.scrollDidChange(scrollLeft,scrollTop);contentInset={top:0,left:0,bottom:0,right:0};contentSize={width:_this2.scrollWidth,height:_this2.scrollHeight};_context.next=9;return _regenerator2.default.awrap(_this2.manager.measure(_this2.reactTag));case 9:contentFrame=_context.sent;args=[_this2.reactTag,contentOffset,contentInset,contentSize,contentFrame,1,_this2.coalescingKey,userData];_this2.debouncedOnScrollEnd.apply(_this2,args);if(_this2.isScrolling){_this2.handleScrollTick.apply(_this2,args);}else{_this2.handleScrollStart.apply(_this2,args);}case 13:case"end":return _context.stop();}}},null,_this3);};_this2.debouncedOnScrollEnd=(0,_debounce2.default)(_this2.handleScrollEnd,100);_this2.manager=bridge.uiManager;_this2.updateHostStyle("contain","strict");if(!_this2.hasScrollParent()){_this2.updateHostStyle("overscrollBehavior","contain");}_this2.isScrolling=false;_this2.scrollEventThrottle=0;_this2.coalescingKey=0;_this2.cachedChildFrames=[];_this2._horizontal=false;_this2._overflow="scroll";_this2._scrollEnabled=true;_this2.updateTransform();_this2.addEventListener("scroll",_this2.handleScroll,SCROLL_LISTENER_OPTIONS);return _this2;}(0,_createClass3.default)(RCTScrollView,[{key:"hasScrollParent",value:function hasScrollParent(){var currentView=this;while(currentView.reactSuperview){if(currentView instanceof RCTScrollView){return true;}currentView=currentView.reactSuperView;}return false;}},{key:"updateScrollBehavior",value:function updateScrollBehavior(){var styleUpdate={};if(this._overflow==="scroll"&&this._scrollEnabled){styleUpdate.msOverflowStyle="-ms-autohiding-scrollbar";styleUpdate.webkitOverflowScrolling="touch";styleUpdate.scrollBehavior="smooth";styleUpdate.willChange="transform";if(this._horizontal){styleUpdate.overflowX="auto";styleUpdate.overflowY="hidden";}else{styleUpdate.overflowX="hidden";styleUpdate.overflowY="auto";}}else{styleUpdate.msOverflowStyle="auto";styleUpdate.webkitOverflowScrolling="";styleUpdate.willChange="";styleUpdate.overflowX="hidden";styleUpdate.overflowY="hidden";}this.updateHostStyle(styleUpdate);}},{key:"calculateChildFramesData",value:function calculateChildFramesData(){var _this4=this;var updatedChildFrames=[];var contentView=this.reactSubviews[0];(0,_Invariant2.default)(contentView&&contentView instanceof RCTScrollContentView,"RCTScrollView (of ID "+this.reactTag+") has no contentView");contentView.reactSubviews.forEach(function(subview,idx){var newFrame=subview.frame;var frameChanged=false;if(_this4.cachedChildFrames.length<=idx){frameChanged=true;}else if(JSON.stringify(newFrame)!==JSON.stringify(_this4.cachedChildFrames[idx])){frameChanged=true;}if(frameChanged){updatedChildFrames.push({index:idx,x:newFrame.left,y:newFrame.top,width:newFrame.width,height:newFrame.height});}});return updatedChildFrames;}},{key:"connectedCallback",value:function connectedCallback(){if(SHOULD_CORRECT_SCROLL){if(this._horizontal){this.scrollLeft=1;}else{this.scrollTop=1;}}}},{key:"boundsDidChange",value:function boundsDidChange(contentView){this.coalescingKey++;var childFrames=this.calculateChildFramesData();var contentOffset={x:this.scrollLeft,y:this.scrollTop};var contentInset={top:0,left:0,bottom:0,right:0};var contentSize={width:this.scrollWidth,height:this.scrollHeight};var shadowView=this.manager.shadowViewRegistry.get(this.reactTag);(0,_Invariant2.default)(shadowView,"No ShadowView for tag "+this.reactTag);var contentFrame=shadowView.previousLayout;(0,_Invariant2.default)(contentFrame,"ShadowView with tag "+this.reactTag+" has not been layed out");this.contentSize={width:contentFrame.width,height:contentFrame.height};this.correctScrollPosition();var args=[this.reactTag,contentOffset,contentInset,contentSize,contentFrame,1,this.coalescingKey];this.bridge.eventDispatcher.sendEvent(new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScroll"],args,[{updatedChildFrames:childFrames}])))());}},{key:"scrollDidChange",value:function scrollDidChange(x,y){var _this5=this;setTimeout(function(){var localData=new _RCTScrollViewLocalData2.default(x,y);_this5.bridge.uiManager.setLocalDataForView(localData,_this5);},0);}},{key:"handleScrollStart",value:function handleScrollStart(){this.isScrolling=true;this._scrollLastTick=Date.now();for(var _len=arguments.length,eventArgs=Array(_len),_key=0;_key<_len;_key++){eventArgs[_key]=arguments[_key];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScrollBeginDrag"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);}},{key:"handleScrollEnd",value:function handleScrollEnd(){this.isScrolling=false;for(var _len2=arguments.length,eventArgs=Array(_len2),_key2=0;_key2<_len2;_key2++){eventArgs[_key2]=arguments[_key2];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScrollEndDrag"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);var momentumScrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onMomentumScrollEnd"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(momentumScrollEvent);this.correctScrollPosition();}},{key:"correctScrollPosition",value:function correctScrollPosition(){var scrollNudge=1;if(SHOULD_CORRECT_SCROLL){if(!this._horizontal){var endTopPosition=this.scrollTop+this.contentSize.height;if(this.scrollTop<=0&&this.scrollTop>=-0.1){this.scrollTop=scrollNudge;}else if(endTopPosition>=this.scrollHeight&&endTopPosition<=this.scrollHeight+0.1){this.scrollTop=this.scrollTop-scrollNudge;}}else{var endLeftPosition=this.scrollLeft+this.contentSize.width;if(this.scrollLeft<=0&&this.scrollLeft>=-0.1){this.scrollLeft=scrollNudge;}else if(endLeftPosition>=this.scrollWidth&&endLeftPosition<=this.scrollWidth+0.1){this.scrollLeft=this.scrollLeft-scrollNudge;}}}}},{key:"handleScrollTick",value:function handleScrollTick(){var shouldEmitScrollEvent=this.shouldEmitScrollEvent(this._scrollLastTick,this.scrollEventThrottle);if(shouldEmitScrollEvent){this._scrollLastTick=Date.now();for(var _len3=arguments.length,eventArgs=Array(_len3),_key3=0;_key3<_len3;_key3++){eventArgs[_key3]=arguments[_key3];}var scrollEvent=new(Function.prototype.bind.apply(RCTScrollEvent,[null].concat(["onScroll"],(0,_toConsumableArray3.default)(eventArgs))))();this.bridge.eventDispatcher.sendEvent(scrollEvent);}}},{key:"shouldEmitScrollEvent",value:function shouldEmitScrollEvent(lastTick,eventThrottle){var timeSinceLastTick=Date.now()-lastTick;return eventThrottle>0&&timeSinceLastTick>=eventThrottle;}},{key:"scrollEnabled",set:function set(value){this._scrollEnabled=!!value;this.updateScrollBehavior();}},{key:"horizontal",set:function set(value){this._horizontal=!!value;this.updateScrollBehavior();}},{key:"overflow",set:function set(value){if(value!=null){this._overflow=value;}else{this._overflow="hidden";}this.updateScrollBehavior();}},{key:"touchable",get:function get(){return(0,_get3.default)(RCTScrollView.prototype.__proto__||Object.getPrototypeOf(RCTScrollView.prototype),"touchable",this);},set:function set(value){(0,_set3.default)(RCTScrollView.prototype.__proto__||Object.getPrototypeOf(RCTScrollView.prototype),"touchable",value,this);this.updateHostStyle("cursor","auto");}}]);return RCTScrollView;}(_RCTView4.default))||_class2);exports.default=RCTScrollView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL3ZpZXdzL1JDVFNjcm9sbFZpZXcuanMiXSwibmFtZXMiOlsiU0NST0xMX0xJU1RFTkVSX09QVElPTlMiLCJwYXNzaXZlRXZlbnRzIiwicGFzc2l2ZSIsIlNIT1VMRF9DT1JSRUNUX1NDUk9MTCIsIm5hdmlnYXRvciIsInBsYXRmb3JtIiwibWF0Y2giLCJSQ1RTY3JvbGxFdmVudCIsImV2ZW50TmFtZSIsInJlYWN0VGFnIiwiY29udGVudE9mZnNldCIsImNvbnRlbnRJbnNldCIsImNvbnRlbnRTaXplIiwic2Nyb2xsRnJhbWUiLCJ6b29tU2NhbGUiLCJjb2FsZXNjaW5nS2V5IiwidXNlckRhdGEiLCJ2aWV3VGFnIiwic2Nyb2xsVmlld0NvbnRlbnRPZmZzZXQiLCJzY3JvbGxWaWV3Q29udGVudEluc2V0Iiwic2Nyb2xsVmlld0NvbnRlbnRTaXplIiwic2Nyb2xsVmlld0ZyYW1lIiwic2Nyb2xsVmlld1pvb21TY2FsZSIsIm5ld0V2ZW50IiwidXBkYXRlZENoaWxkRnJhbWVzIiwiY29uY2F0IiwibGVuZ3RoIiwiYXJncyIsImJvZHkiLCJsYXlvdXRNZWFzdXJlbWVudCIsIndpZHRoIiwiaGVpZ2h0IiwiUkNUU2Nyb2xsQ29udGVudFZpZXciLCJicmlkZ2UiLCJ1cGRhdGVIb3N0U3R5bGUiLCJwb3NpdGlvbiIsImRpc3BsYXkiLCJvcGFjaXR5Iiwid2lsbENoYW5nZSIsInZhbHVlIiwic3VwZXJWaWV3IiwicmVhY3RTdXBlcnZpZXciLCJzdWJWaWV3IiwicmVhY3RTdWJ2aWV3cyIsIlJDVFNjcm9sbFZpZXciLCJib3VuZHNEaWRDaGFuZ2UiLCJoYW5kbGVTY3JvbGwiLCJlIiwic2Nyb2xsTGVmdCIsInNjcm9sbFRvcCIsIngiLCJ5Iiwic2Nyb2xsRGlkQ2hhbmdlIiwidG9wIiwibGVmdCIsImJvdHRvbSIsInJpZ2h0Iiwic2Nyb2xsV2lkdGgiLCJzY3JvbGxIZWlnaHQiLCJtYW5hZ2VyIiwibWVhc3VyZSIsImNvbnRlbnRGcmFtZSIsImRlYm91bmNlZE9uU2Nyb2xsRW5kIiwiaXNTY3JvbGxpbmciLCJoYW5kbGVTY3JvbGxUaWNrIiwiaGFuZGxlU2Nyb2xsU3RhcnQiLCJoYW5kbGVTY3JvbGxFbmQiLCJ1aU1hbmFnZXIiLCJoYXNTY3JvbGxQYXJlbnQiLCJzY3JvbGxFdmVudFRocm90dGxlIiwiY2FjaGVkQ2hpbGRGcmFtZXMiLCJfaG9yaXpvbnRhbCIsIl9vdmVyZmxvdyIsIl9zY3JvbGxFbmFibGVkIiwidXBkYXRlVHJhbnNmb3JtIiwiYWRkRXZlbnRMaXN0ZW5lciIsImN1cnJlbnRWaWV3IiwicmVhY3RTdXBlclZpZXciLCJzdHlsZVVwZGF0ZSIsIm1zT3ZlcmZsb3dTdHlsZSIsIndlYmtpdE92ZXJmbG93U2Nyb2xsaW5nIiwic2Nyb2xsQmVoYXZpb3IiLCJvdmVyZmxvd1giLCJvdmVyZmxvd1kiLCJjb250ZW50VmlldyIsImZvckVhY2giLCJzdWJ2aWV3IiwiaWR4IiwibmV3RnJhbWUiLCJmcmFtZSIsImZyYW1lQ2hhbmdlZCIsIkpTT04iLCJzdHJpbmdpZnkiLCJwdXNoIiwiaW5kZXgiLCJjaGlsZEZyYW1lcyIsImNhbGN1bGF0ZUNoaWxkRnJhbWVzRGF0YSIsInNoYWRvd1ZpZXciLCJzaGFkb3dWaWV3UmVnaXN0cnkiLCJnZXQiLCJwcmV2aW91c0xheW91dCIsImNvcnJlY3RTY3JvbGxQb3NpdGlvbiIsImV2ZW50RGlzcGF0Y2hlciIsInNlbmRFdmVudCIsInNldFRpbWVvdXQiLCJsb2NhbERhdGEiLCJzZXRMb2NhbERhdGFGb3JWaWV3IiwiX3Njcm9sbExhc3RUaWNrIiwiRGF0ZSIsIm5vdyIsImV2ZW50QXJncyIsInNjcm9sbEV2ZW50IiwibW9tZW50dW1TY3JvbGxFdmVudCIsInNjcm9sbE51ZGdlIiwiZW5kVG9wUG9zaXRpb24iLCJlbmRMZWZ0UG9zaXRpb24iLCJzaG91bGRFbWl0U2Nyb2xsRXZlbnQiLCJsYXN0VGljayIsImV2ZW50VGhyb3R0bGUiLCJ0aW1lU2luY2VMYXN0VGljayIsInVwZGF0ZVNjcm9sbEJlaGF2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Y2VzQ29udGVudCI6WyIvKipcbiAqIEBwcm92aWRlc01vZHVsZSBSQ1RTY3JvbGxWaWV3XG4gKiBAZmxvd1xuICovXG5cbmltcG9ydCBSQ1RWaWV3IGZyb20gXCJSQ1RWaWV3XCI7XG5pbXBvcnQgVUlWaWV3IGZyb20gXCJVSVZpZXdcIjtcbmltcG9ydCB0eXBlIFJDVEJyaWRnZSBmcm9tIFwiUkNUQnJpZGdlXCI7XG5pbXBvcnQgQ3VzdG9tRWxlbWVudCBmcm9tIFwiQ3VzdG9tRWxlbWVudFwiO1xuaW1wb3J0IHR5cGUgeyBSQ1RFdmVudCB9IGZyb20gXCJSQ1RFdmVudERpc3BhdGNoZXJcIjtcbmltcG9ydCBkZXRlY3RJdCBmcm9tIFwiZGV0ZWN0LWl0XCI7XG5pbXBvcnQgUkNUU2Nyb2xsVmlld0xvY2FsRGF0YSBmcm9tIFwiUkNUU2Nyb2xsVmlld0xvY2FsRGF0YVwiO1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gXCJJbnZhcmlhbnRcIjtcbmltcG9ydCBkZWJvdW5jZSBmcm9tIFwiZGVib3VuY2VcIjtcbmltcG9ydCBSQ1RFdmVudERpc3BhdGNoZXIsIHtcbiAgbm9ybWFsaXplSW5wdXRFdmVudE5hbWVcbn0gZnJvbSBcIlJDVEV2ZW50RGlzcGF0Y2hlclwiO1xuXG5jb25zdCBTQ1JPTExfTElTVEVORVJfT1BUSU9OUyA9IGRldGVjdEl0LnBhc3NpdmVFdmVudHNcbiAgPyB7IHBhc3NpdmU6IHRydWUgfVxuICA6IGZhbHNlO1xuXG5jb25zdCBTSE9VTERfQ09SUkVDVF9TQ1JPTEwgPSAhIW5hdmlnYXRvci5wbGF0Zm9ybS5tYXRjaCgvaVBob25lfGlQb2R8aVBhZC9nKTtcblxudHlwZSBTY3JvbGxFdmVudEFyZ3MgPSBbXG4gIG51bWJlcixcbiAgUG9zaXRpb24sXG4gIEluc2V0LFxuICBTaXplLFxuICBGcmFtZSxcbiAgbnVtYmVyLFxuICBudW1iZXIsXG4gID9PYmplY3Rcbl07XG5cbi8vICRGbG93Rml4TWUgLSBjb2FsZXNjZVdpdGhFdmVudCBzaG91bGQgYmUgY29tcGF0aWJsZSBidXQgSSB0aGluayBmbG93IGhhcyBhIGJ1Z1xuY2xhc3MgUkNUU2Nyb2xsRXZlbnQgaW1wbGVtZW50cyBSQ1RFdmVudCB7XG4gIC8vIGludGVyZmFjZSBwcm9wZXJ0aWVzXG4gIHZpZXdUYWc6IG51bWJlcjtcbiAgZXZlbnROYW1lOiBzdHJpbmc7XG4gIGNvYWxlc2NpbmdLZXk6IG51bWJlcjtcblxuICBzY3JvbGxWaWV3Q29udGVudE9mZnNldDogUG9zaXRpb247XG4gIHNjcm9sbFZpZXdDb250ZW50SW5zZXQ6IEluc2V0O1xuICBzY3JvbGxWaWV3Q29udGVudFNpemU6IFNpemU7XG4gIHNjcm9sbFZpZXdGcmFtZTogRnJhbWU7XG4gIHNjcm9sbFZpZXdab29tU2NhbGU6IG51bWJlcjtcbiAgdXNlckRhdGE6ID9PYmplY3Q7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgZXZlbnROYW1lOiBzdHJpbmcsXG4gICAgcmVhY3RUYWc6IG51bWJlcixcbiAgICBjb250ZW50T2Zmc2V0OiBQb3NpdGlvbixcbiAgICBjb250ZW50SW5zZXQ6IEluc2V0LFxuICAgIGNvbnRlbnRTaXplOiBTaXplLFxuICAgIHNjcm9sbEZyYW1lOiBGcmFtZSxcbiAgICB6b29tU2NhbGU6IG51bWJlcixcbiAgICBjb2FsZXNjaW5nS2V5OiBudW1iZXIsXG4gICAgdXNlckRhdGE6ID9PYmplY3RcbiAgKSB7XG4gICAgdGhpcy5ldmVudE5hbWUgPSBldmVudE5hbWU7XG4gICAgdGhpcy52aWV3VGFnID0gcmVhY3RUYWc7XG4gICAgdGhpcy5zY3JvbGxWaWV3Q29udGVudE9mZnNldCA9IGNvbnRlbnRPZmZzZXQ7XG4gICAgdGhpcy5zY3JvbGxWaWV3Q29udGVudEluc2V0ID0gY29udGVudEluc2V0O1xuICAgIHRoaXMuc2Nyb2xsVmlld0NvbnRlbnRTaXplID0gY29udGVudFNpemU7XG4gICAgdGhpcy5zY3JvbGxWaWV3RnJhbWUgPSBzY3JvbGxGcmFtZTtcbiAgICB0aGlzLnNjcm9sbFZpZXdab29tU2NhbGUgPSB6b29tU2NhbGU7XG4gICAgdGhpcy51c2VyRGF0YSA9IHVzZXJEYXRhO1xuICAgIHRoaXMuY29hbGVzY2luZ0tleSA9IGNvYWxlc2NpbmdLZXk7XG4gIH1cblxuICBnZXQgYm9keSgpIHtcbiAgICBsZXQgYm9keSA9IHtcbiAgICAgIGNvbnRlbnRPZmZzZXQ6IHtcbiAgICAgICAgLi4udGhpcy5zY3JvbGxWaWV3Q29udGVudE9mZnNldFxuICAgICAgfSxcbiAgICAgIGNvbnRlbnRJbnNldDoge1xuICAgICAgICAuLi50aGlzLnNjcm9sbFZpZXdDb250ZW50SW5zZXRcbiAgICAgIH0sXG4gICAgICBjb250ZW50U2l6ZToge1xuICAgICAgICAuLi50aGlzLnNjcm9sbFZpZXdDb250ZW50U2l6ZVxuICAgICAgfSxcbiAgICAgIGxheW91dE1lYXN1cmVtZW50OiB7XG4gICAgICAgIHdpZHRoOiB0aGlzLnNjcm9sbFZpZXdGcmFtZS53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiB0aGlzLnNjcm9sbFZpZXdGcmFtZS5oZWlnaHRcbiAgICAgIH0sXG4gICAgICB6b29tU2NhbGU6IHRoaXMuc2Nyb2xsVmlld1pvb21TY2FsZVxuICAgIH07XG5cbiAgICBjb25zdCB1c2VyRGF0YSA9IHRoaXMudXNlckRhdGE7XG4gICAgaWYgKHVzZXJEYXRhKSB7XG4gICAgICBib2R5ID0geyAuLi5ib2R5LCAuLi51c2VyRGF0YSB9O1xuICAgIH1cblxuICAgIHJldHVybiBib2R5O1xuICB9XG5cbiAgY2FuQ29hbGVzY2UoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICBjb2FsZXNjZVdpdGhFdmVudChuZXdFdmVudDogUkNUU2Nyb2xsRXZlbnQpOiBSQ1RTY3JvbGxFdmVudCB7XG4gICAgbGV0IHVwZGF0ZWRDaGlsZEZyYW1lcyA9IFtdO1xuICAgIGlmICh0aGlzLnVzZXJEYXRhICYmIHRoaXMudXNlckRhdGEudXBkYXRlZENoaWxkRnJhbWVzKVxuICAgICAgdXBkYXRlZENoaWxkRnJhbWVzID0gdXBkYXRlZENoaWxkRnJhbWVzLmNvbmNhdChcbiAgICAgICAgdGhpcy51c2VyRGF0YS51cGRhdGVkQ2hpbGRGcmFtZXNcbiAgICAgICk7XG4gICAgaWYgKG5ld0V2ZW50LnVzZXJEYXRhICYmIG5ld0V2ZW50LnVzZXJEYXRhLnVwZGF0ZWRDaGlsZEZyYW1lcylcbiAgICAgIHVwZGF0ZWRDaGlsZEZyYW1lcyA9IHVwZGF0ZWRDaGlsZEZyYW1lcy5jb25jYXQoXG4gICAgICAgIG5ld0V2ZW50LnVzZXJEYXRhLnVwZGF0ZWRDaGlsZEZyYW1lc1xuICAgICAgKTtcblxuICAgIGlmICh1cGRhdGVkQ2hpbGRGcmFtZXMubGVuZ3RoICE9PSAwKSB7XG4gICAgICBuZXdFdmVudC51c2VyRGF0YSA9IHtcbiAgICAgICAgdXBkYXRlZENoaWxkRnJhbWVzXG4gICAgICB9O1xuICAgIH1cblxuICAgIHJldHVybiBuZXdFdmVudDtcbiAgfVxuXG4gIG1vZHVsZURvdE1ldGhvZCgpOiBzdHJpbmcge1xuICAgIHJldHVybiBcIlJDVEV2ZW50RW1pdHRlci5yZWNlaXZlRXZlbnRcIjtcbiAgfVxuICBhcmd1bWVudHMoKTogQXJyYXk8YW55PiB7XG4gICAgY29uc3QgYXJncyA9IFtcbiAgICAgIHRoaXMudmlld1RhZyxcbiAgICAgIG5vcm1hbGl6ZUlucHV0RXZlbnROYW1lKHRoaXMuZXZlbnROYW1lKSxcbiAgICAgIHRoaXMuYm9keVxuICAgIF07XG4gICAgcmV0dXJuIGFyZ3M7XG4gIH1cbn1cblxuQEN1c3RvbUVsZW1lbnQoXCJyY3Qtc2Nyb2xsLWNvbnRlbnQtdmlld1wiKVxuZXhwb3J0IGNsYXNzIFJDVFNjcm9sbENvbnRlbnRWaWV3IGV4dGVuZHMgUkNUVmlldyB7XG4gIGNvbnN0cnVjdG9yKGJyaWRnZTogUkNUQnJpZGdlKSB7XG4gICAgc3VwZXIoYnJpZGdlKTtcbiAgICB0aGlzLnVwZGF0ZUhvc3RTdHlsZSh7XG4gICAgICBwb3NpdGlvbjogXCJyZWxhdGl2ZVwiLFxuICAgICAgZGlzcGxheTogXCJibG9ja1wiLFxuICAgICAgb3BhY2l0eTogXCIxXCIsXG4gICAgICAvLyB2YXN0bHkgaW1wcm92ZXMgc2Nyb2xsaW5nIHBlcmZvcm1hbmNlIChlc3BlY2lhbGx5IG9uIHNmYXJhaSlcbiAgICAgIHdpbGxDaGFuZ2U6IFwidHJhbnNmb3JtXCJcbiAgICB9KTtcbiAgfVxuXG4gIHNldCBmcmFtZSh2YWx1ZTogRnJhbWUpIHtcbiAgICBzdXBlci5mcmFtZSA9IHZhbHVlO1xuXG4gICAgY29uc3Qgc3VwZXJWaWV3ID0gdGhpcy5yZWFjdFN1cGVydmlldztcbiAgICBjb25zdCBzdWJWaWV3ID0gdGhpcy5yZWFjdFN1YnZpZXdzWzBdO1xuXG4gICAgaWYgKFxuICAgICAgc3ViVmlldyAmJlxuICAgICAgc3ViVmlldyBpbnN0YW5jZW9mIFJDVFZpZXcgJiZcbiAgICAgIHN1cGVyVmlldyAmJlxuICAgICAgc3VwZXJWaWV3IGluc3RhbmNlb2YgUkNUU2Nyb2xsVmlld1xuICAgICkge1xuICAgICAgc3VwZXJWaWV3LmJvdW5kc0RpZENoYW5nZShzdWJWaWV3KTtcbiAgICB9XG4gIH1cblxuICBnZXQgZnJhbWUoKTogRnJhbWUge1xuICAgIHJldHVybiBzdXBlci5mcmFtZTtcbiAgfVxufVxuXG50eXBlIENoaWxkRnJhbWUgPSB7XG4gIGluZGV4OiBudW1iZXIsXG4gIHg6IG51bWJlcixcbiAgeTogbnVtYmVyLFxuICB3aWR0aDogbnVtYmVyLFxuICBoZWlnaHQ6IG51bWJlclxufTtcblxuQEN1c3RvbUVsZW1lbnQoXCJyY3Qtc2Nyb2xsLXZpZXdcIilcbmNsYXNzIFJDVFNjcm9sbFZpZXcgZXh0ZW5kcyBSQ1RWaWV3IHtcbiAgYnJpZGdlOiBSQ1RCcmlkZ2U7XG4gIG1hbmFnZXI6ICo7XG5cbiAgaXNTY3JvbGxpbmc6IGJvb2xlYW47XG4gIHNjcm9sbEV2ZW50VGhyb3R0bGU6IG51bWJlcjtcbiAgX3Njcm9sbExhc3RUaWNrOiBudW1iZXI7XG5cbiAgX2hvcml6b250YWw6IGJvb2xlYW47XG4gIF9vdmVyZmxvdzogc3RyaW5nO1xuICBfc2Nyb2xsRW5hYmxlZDogYm9vbGVhbjtcblxuICBjb2FsZXNjaW5nS2V5OiBudW1iZXI7XG4gIGNhY2hlZENoaWxkRnJhbWVzOiBBcnJheTxGcmFtZT47XG5cbiAgY29udGVudFNpemU6IFNpemUgPSB7IHdpZHRoOiAwLCBoZWlnaHQ6IDAgfTtcblxuICBjb25zdHJ1Y3RvcihicmlkZ2U6IFJDVEJyaWRnZSkge1xuICAgIHN1cGVyKGJyaWRnZSk7XG5cbiAgICB0aGlzLm1hbmFnZXIgPSBicmlkZ2UudWlNYW5hZ2VyO1xuXG4gICAgdGhpcy51cGRhdGVIb3N0U3R5bGUoXCJjb250YWluXCIsIFwic3RyaWN0XCIpO1xuXG4gICAgaWYgKCF0aGlzLmhhc1Njcm9sbFBhcmVudCgpKSB7XG4gICAgICB0aGlzLnVwZGF0ZUhvc3RTdHlsZShcIm92ZXJzY3JvbGxCZWhhdmlvclwiLCBcImNvbnRhaW5cIik7XG4gICAgfVxuXG4gICAgdGhpcy5pc1Njcm9sbGluZyA9IGZhbHNlO1xuICAgIHRoaXMuc2Nyb2xsRXZlbnRUaHJvdHRsZSA9IDA7XG5cbiAgICB0aGlzLmNvYWxlc2NpbmdLZXkgPSAwO1xuICAgIHRoaXMuY2FjaGVkQ2hpbGRGcmFtZXMgPSBbXTtcblxuICAgIHRoaXMuX2hvcml6b250YWwgPSBmYWxzZTtcbiAgICB0aGlzLl9vdmVyZmxvdyA9IFwic2Nyb2xsXCI7XG4gICAgdGhpcy5fc2Nyb2xsRW5hYmxlZCA9IHRydWU7XG5cbiAgICB0aGlzLnVwZGF0ZVRyYW5zZm9ybSgpO1xuXG4gICAgdGhpcy5hZGRFdmVudExpc3RlbmVyKFwic2Nyb2xsXCIsIHRoaXMuaGFuZGxlU2Nyb2xsLCBTQ1JPTExfTElTVEVORVJfT1BUSU9OUyk7XG4gIH1cblxuICBoYXNTY3JvbGxQYXJlbnQoKSB7XG4gICAgbGV0IGN1cnJlbnRWaWV3ID0gdGhpcztcbiAgICB3aGlsZSAoY3VycmVudFZpZXcucmVhY3RTdXBlcnZpZXcpIHtcbiAgICAgIGlmIChjdXJyZW50VmlldyBpbnN0YW5jZW9mIFJDVFNjcm9sbFZpZXcpIHtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgICBjdXJyZW50VmlldyA9IGN1cnJlbnRWaWV3LnJlYWN0U3VwZXJWaWV3O1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBzZXQgc2Nyb2xsRW5hYmxlZCh2YWx1ZTogP2Jvb2xlYW4pIHtcbiAgICB0aGlzLl9zY3JvbGxFbmFibGVkID0gISF2YWx1ZTtcbiAgICB0aGlzLnVwZGF0ZVNjcm9sbEJlaGF2aW9yKCk7XG4gIH1cblxuICBzZXQgaG9yaXpvbnRhbCh2YWx1ZTogP2Jvb2xlYW4pIHtcbiAgICB0aGlzLl9ob3Jpem9udGFsID0gISF2YWx1ZTtcbiAgICB0aGlzLnVwZGF0ZVNjcm9sbEJlaGF2aW9yKCk7XG4gIH1cblxuICBzZXQgb3ZlcmZsb3codmFsdWU6ID9zdHJpbmcpIHtcbiAgICBpZiAodmFsdWUgIT0gbnVsbCkge1xuICAgICAgdGhpcy5fb3ZlcmZsb3cgPSB2YWx1ZTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fb3ZlcmZsb3cgPSBcImhpZGRlblwiO1xuICAgIH1cbiAgICB0aGlzLnVwZGF0ZVNjcm9sbEJlaGF2aW9yKCk7XG4gIH1cblxuICB1cGRhdGVTY3JvbGxCZWhhdmlvcigpIHtcbiAgICBjb25zdCBzdHlsZVVwZGF0ZSA9IHt9O1xuICAgIGlmICh0aGlzLl9vdmVyZmxvdyA9PT0gXCJzY3JvbGxcIiAmJiB0aGlzLl9zY3JvbGxFbmFibGVkKSB7XG4gICAgICBzdHlsZVVwZGF0ZS5tc092ZXJmbG93U3R5bGUgPSBcIi1tcy1hdXRvaGlkaW5nLXNjcm9sbGJhclwiO1xuICAgICAgc3R5bGVVcGRhdGUud2Via2l0T3ZlcmZsb3dTY3JvbGxpbmcgPSBcInRvdWNoXCI7XG4gICAgICBzdHlsZVVwZGF0ZS5zY3JvbGxCZWhhdmlvciA9IFwic21vb3RoXCI7XG4gICAgICAvLyBUT0RPOiBNYWtlIHRoaXMgY29uZGl0aW9uYWwgYmFzZWQgb24gc2NyZWVuIERQSVxuICAgICAgc3R5bGVVcGRhdGUud2lsbENoYW5nZSA9IFwidHJhbnNmb3JtXCI7XG5cbiAgICAgIGlmICh0aGlzLl9ob3Jpem9udGFsKSB7XG4gICAgICAgIHN0eWxlVXBkYXRlLm92ZXJmbG93WCA9IFwiYXV0b1wiO1xuICAgICAgICBzdHlsZVVwZGF0ZS5vdmVyZmxvd1kgPSBcImhpZGRlblwiO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgc3R5bGVVcGRhdGUub3ZlcmZsb3dYID0gXCJoaWRkZW5cIjtcbiAgICAgICAgc3R5bGVVcGRhdGUub3ZlcmZsb3dZID0gXCJhdXRvXCI7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHN0eWxlVXBkYXRlLm1zT3ZlcmZsb3dTdHlsZSA9IFwiYXV0b1wiO1xuICAgICAgc3R5bGVVcGRhdGUud2Via2l0T3ZlcmZsb3dTY3JvbGxpbmcgPSBcIlwiO1xuICAgICAgc3R5bGVVcGRhdGUud2lsbENoYW5nZSA9IFwiXCI7XG5cbiAgICAgIHN0eWxlVXBkYXRlLm92ZXJmbG93WCA9IFwiaGlkZGVuXCI7XG4gICAgICBzdHlsZVVwZGF0ZS5vdmVyZmxvd1kgPSBcImhpZGRlblwiO1xuICAgIH1cblxuICAgIHRoaXMudXBkYXRlSG9zdFN0eWxlKHN0eWxlVXBkYXRlKTtcbiAgfVxuXG4gIGNhbGN1bGF0ZUNoaWxkRnJhbWVzRGF0YSgpIHtcbiAgICBjb25zdCB1cGRhdGVkQ2hpbGRGcmFtZXMgPSBbXTtcblxuICAgIGNvbnN0IGNvbnRlbnRWaWV3ID0gdGhpcy5yZWFjdFN1YnZpZXdzWzBdO1xuICAgIGludmFyaWFudChcbiAgICAgIGNvbnRlbnRWaWV3ICYmIGNvbnRlbnRWaWV3IGluc3RhbmNlb2YgUkNUU2Nyb2xsQ29udGVudFZpZXcsXG4gICAgICBgUkNUU2Nyb2xsVmlldyAob2YgSUQgJHt0aGlzLnJlYWN0VGFnfSkgaGFzIG5vIGNvbnRlbnRWaWV3YFxuICAgICk7XG5cbiAgICBjb250ZW50Vmlldy5yZWFjdFN1YnZpZXdzLmZvckVhY2goKHN1YnZpZXcsIGlkeCkgPT4ge1xuICAgICAgY29uc3QgbmV3RnJhbWUgPSBzdWJ2aWV3LmZyYW1lO1xuXG4gICAgICBsZXQgZnJhbWVDaGFuZ2VkID0gZmFsc2U7XG4gICAgICBpZiAodGhpcy5jYWNoZWRDaGlsZEZyYW1lcy5sZW5ndGggPD0gaWR4KSB7XG4gICAgICAgIGZyYW1lQ2hhbmdlZCA9IHRydWU7XG4gICAgICAgIC8vIHRoaXMuY2FjaGVkQ2hpbGRGcmFtZXMucHVzaChuZXdGcmFtZSk7XG4gICAgICB9IGVsc2UgaWYgKFxuICAgICAgICBKU09OLnN0cmluZ2lmeShuZXdGcmFtZSkgIT09IEpTT04uc3RyaW5naWZ5KHRoaXMuY2FjaGVkQ2hpbGRGcmFtZXNbaWR4XSlcbiAgICAgICkge1xuICAgICAgICBmcmFtZUNoYW5nZWQgPSB0cnVlO1xuICAgICAgICAvLyB0aGlzLmNhY2hlZENoaWxkRnJhbWVzW2lkeF0gPSBuZXdGcmFtZTtcbiAgICAgIH1cblxuICAgICAgaWYgKGZyYW1lQ2hhbmdlZCkge1xuICAgICAgICB1cGRhdGVkQ2hpbGRGcmFtZXMucHVzaCh7XG4gICAgICAgICAgaW5kZXg6IGlkeCxcbiAgICAgICAgICB4OiBuZXdGcmFtZS5sZWZ0LFxuICAgICAgICAgIHk6IG5ld0ZyYW1lLnRvcCxcbiAgICAgICAgICB3aWR0aDogbmV3RnJhbWUud2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBuZXdGcmFtZS5oZWlnaHRcbiAgICAgICAgfSk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4gdXBkYXRlZENoaWxkRnJhbWVzO1xuICB9XG5cbiAgY29ubmVjdGVkQ2FsbGJhY2soKSB7XG4gICAgaWYgKFNIT1VMRF9DT1JSRUNUX1NDUk9MTCkge1xuICAgICAgaWYgKHRoaXMuX2hvcml6b250YWwpIHtcbiAgICAgICAgdGhpcy5zY3JvbGxMZWZ0ID0gMTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuc2Nyb2xsVG9wID0gMTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBib3VuZHNEaWRDaGFuZ2UoY29udGVudFZpZXc6IFJDVFZpZXcpIHtcbiAgICB0aGlzLmNvYWxlc2NpbmdLZXkrKztcbiAgICBjb25zdCBjaGlsZEZyYW1lcyA9IHRoaXMuY2FsY3VsYXRlQ2hpbGRGcmFtZXNEYXRhKCk7XG5cbiAgICBjb25zdCBjb250ZW50T2Zmc2V0OiBQb3NpdGlvbiA9IHtcbiAgICAgIHg6IHRoaXMuc2Nyb2xsTGVmdCxcbiAgICAgIHk6IHRoaXMuc2Nyb2xsVG9wXG4gICAgfTtcblxuICAgIGNvbnN0IGNvbnRlbnRJbnNldDogSW5zZXQgPSB7XG4gICAgICB0b3A6IDAsXG4gICAgICBsZWZ0OiAwLFxuICAgICAgYm90dG9tOiAwLFxuICAgICAgcmlnaHQ6IDBcbiAgICB9O1xuXG4gICAgY29uc3QgY29udGVudFNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5zY3JvbGxXaWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5zY3JvbGxIZWlnaHRcbiAgICB9O1xuXG4gICAgLy8gY29uc3QgY29udGVudEZyYW1lID0gdGhpcy5tYW5hZ2VyLm1lYXN1cmUodGhpcy5yZWFjdFRhZyk7XG4gICAgY29uc3Qgc2hhZG93VmlldyA9IHRoaXMubWFuYWdlci5zaGFkb3dWaWV3UmVnaXN0cnkuZ2V0KHRoaXMucmVhY3RUYWcpO1xuICAgIGludmFyaWFudChzaGFkb3dWaWV3LCBgTm8gU2hhZG93VmlldyBmb3IgdGFnICR7dGhpcy5yZWFjdFRhZ31gKTtcbiAgICBjb25zdCBjb250ZW50RnJhbWUgPSBzaGFkb3dWaWV3LnByZXZpb3VzTGF5b3V0O1xuICAgIGludmFyaWFudChcbiAgICAgIGNvbnRlbnRGcmFtZSxcbiAgICAgIGBTaGFkb3dWaWV3IHdpdGggdGFnICR7dGhpcy5yZWFjdFRhZ30gaGFzIG5vdCBiZWVuIGxheWVkIG91dGBcbiAgICApO1xuXG4gICAgdGhpcy5jb250ZW50U2l6ZSA9IHtcbiAgICAgIHdpZHRoOiBjb250ZW50RnJhbWUud2lkdGgsXG4gICAgICBoZWlnaHQ6IGNvbnRlbnRGcmFtZS5oZWlnaHRcbiAgICB9O1xuXG4gICAgdGhpcy5jb3JyZWN0U2Nyb2xsUG9zaXRpb24oKTtcblxuICAgIGNvbnN0IGFyZ3MgPSBbXG4gICAgICB0aGlzLnJlYWN0VGFnLFxuICAgICAgY29udGVudE9mZnNldCxcbiAgICAgIGNvbnRlbnRJbnNldCxcbiAgICAgIGNvbnRlbnRTaXplLFxuICAgICAgY29udGVudEZyYW1lLFxuICAgICAgMSxcbiAgICAgIHRoaXMuY29hbGVzY2luZ0tleVxuICAgIF07XG5cbiAgICB0aGlzLmJyaWRnZS5ldmVudERpc3BhdGNoZXIuc2VuZEV2ZW50KFxuICAgICAgbmV3IFJDVFNjcm9sbEV2ZW50KFwib25TY3JvbGxcIiwgLi4uYXJncywge1xuICAgICAgICB1cGRhdGVkQ2hpbGRGcmFtZXM6IGNoaWxkRnJhbWVzXG4gICAgICB9KVxuICAgICk7XG4gIH1cblxuICBzY3JvbGxEaWRDaGFuZ2UoeDogbnVtYmVyLCB5OiBudW1iZXIpIHtcbiAgICBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgIGNvbnN0IGxvY2FsRGF0YSA9IG5ldyBSQ1RTY3JvbGxWaWV3TG9jYWxEYXRhKHgsIHkpO1xuICAgICAgdGhpcy5icmlkZ2UudWlNYW5hZ2VyLnNldExvY2FsRGF0YUZvclZpZXcobG9jYWxEYXRhLCB0aGlzKTtcbiAgICB9LCAwKTtcbiAgfVxuXG4gIGhhbmRsZVNjcm9sbCA9IGFzeW5jIChlOiBFdmVudCwgdXNlckRhdGE6ID9PYmplY3QpID0+IHtcbiAgICB0aGlzLmNvYWxlc2NpbmdLZXkrKztcblxuICAgIGNvbnN0IHNjcm9sbExlZnQgPSB0aGlzLnNjcm9sbExlZnQ7XG4gICAgY29uc3Qgc2Nyb2xsVG9wID0gdGhpcy5zY3JvbGxUb3A7XG5cbiAgICBjb25zdCBjb250ZW50T2Zmc2V0OiBQb3NpdGlvbiA9IHtcbiAgICAgIHg6IHNjcm9sbExlZnQsXG4gICAgICB5OiBzY3JvbGxUb3BcbiAgICB9O1xuXG4gICAgdGhpcy5zY3JvbGxEaWRDaGFuZ2Uoc2Nyb2xsTGVmdCwgc2Nyb2xsVG9wKTtcblxuICAgIGNvbnN0IGNvbnRlbnRJbnNldDogSW5zZXQgPSB7XG4gICAgICB0b3A6IDAsXG4gICAgICBsZWZ0OiAwLFxuICAgICAgYm90dG9tOiAwLFxuICAgICAgcmlnaHQ6IDBcbiAgICB9O1xuXG4gICAgY29uc3QgY29udGVudFNpemUgPSB7XG4gICAgICB3aWR0aDogdGhpcy5zY3JvbGxXaWR0aCxcbiAgICAgIGhlaWdodDogdGhpcy5zY3JvbGxIZWlnaHRcbiAgICB9O1xuXG4gICAgY29uc3QgY29udGVudEZyYW1lID0gYXdhaXQgdGhpcy5tYW5hZ2VyLm1lYXN1cmUodGhpcy5yZWFjdFRhZyk7XG5cbiAgICBjb25zdCBhcmdzID0gW1xuICAgICAgdGhpcy5yZWFjdFRhZyxcbiAgICAgIGNvbnRlbnRPZmZzZXQsXG4gICAgICBjb250ZW50SW5zZXQsXG4gICAgICBjb250ZW50U2l6ZSxcbiAgICAgIGNvbnRlbnRGcmFtZSxcbiAgICAgIDEsXG4gICAgICB0aGlzLmNvYWxlc2NpbmdLZXksXG4gICAgICB1c2VyRGF0YVxuICAgIF07XG5cbiAgICB0aGlzLmRlYm91bmNlZE9uU2Nyb2xsRW5kKC4uLmFyZ3MpO1xuXG4gICAgaWYgKHRoaXMuaXNTY3JvbGxpbmcpIHtcbiAgICAgIHRoaXMuaGFuZGxlU2Nyb2xsVGljayguLi5hcmdzKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5oYW5kbGVTY3JvbGxTdGFydCguLi5hcmdzKTtcbiAgICB9XG4gIH07XG5cbiAgZGVib3VuY2VkT25TY3JvbGxFbmQgPSBkZWJvdW5jZSh0aGlzLmhhbmRsZVNjcm9sbEVuZCwgMTAwKTtcblxuICBoYW5kbGVTY3JvbGxTdGFydCguLi5ldmVudEFyZ3M6IFNjcm9sbEV2ZW50QXJncykge1xuICAgIHRoaXMuaXNTY3JvbGxpbmcgPSB0cnVlO1xuICAgIHRoaXMuX3Njcm9sbExhc3RUaWNrID0gRGF0ZS5ub3coKTtcblxuICAgIGNvbnN0IHNjcm9sbEV2ZW50ID0gbmV3IFJDVFNjcm9sbEV2ZW50KFwib25TY3JvbGxCZWdpbkRyYWdcIiwgLi4uZXZlbnRBcmdzKTtcbiAgICB0aGlzLmJyaWRnZS5ldmVudERpc3BhdGNoZXIuc2VuZEV2ZW50KHNjcm9sbEV2ZW50KTtcbiAgfVxuXG4gIGhhbmRsZVNjcm9sbEVuZCguLi5ldmVudEFyZ3M6IFNjcm9sbEV2ZW50QXJncykge1xuICAgIHRoaXMuaXNTY3JvbGxpbmcgPSBmYWxzZTtcblxuICAgIGNvbnN0IHNjcm9sbEV2ZW50ID0gbmV3IFJDVFNjcm9sbEV2ZW50KFwib25TY3JvbGxFbmREcmFnXCIsIC4uLmV2ZW50QXJncyk7XG4gICAgdGhpcy5icmlkZ2UuZXZlbnREaXNwYXRjaGVyLnNlbmRFdmVudChzY3JvbGxFdmVudCk7XG5cbiAgICBjb25zdCBtb21lbnR1bVNjcm9sbEV2ZW50ID0gbmV3IFJDVFNjcm9sbEV2ZW50KFxuICAgICAgXCJvbk1vbWVudHVtU2Nyb2xsRW5kXCIsXG4gICAgICAuLi5ldmVudEFyZ3NcbiAgICApO1xuICAgIHRoaXMuYnJpZGdlLmV2ZW50RGlzcGF0Y2hlci5zZW5kRXZlbnQobW9tZW50dW1TY3JvbGxFdmVudCk7XG5cbiAgICB0aGlzLmNvcnJlY3RTY3JvbGxQb3NpdGlvbigpO1xuICB9XG5cbiAgY29ycmVjdFNjcm9sbFBvc2l0aW9uKCkge1xuICAgIGNvbnN0IHNjcm9sbE51ZGdlID0gMTtcblxuICAgIGlmIChTSE9VTERfQ09SUkVDVF9TQ1JPTEwpIHtcbiAgICAgIGlmICghdGhpcy5faG9yaXpvbnRhbCkge1xuICAgICAgICBjb25zdCBlbmRUb3BQb3NpdGlvbiA9IHRoaXMuc2Nyb2xsVG9wICsgdGhpcy5jb250ZW50U2l6ZS5oZWlnaHQ7XG4gICAgICAgIGlmICh0aGlzLnNjcm9sbFRvcCA8PSAwICYmIHRoaXMuc2Nyb2xsVG9wID49IC0wLjEpIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbFRvcCA9IHNjcm9sbE51ZGdlO1xuICAgICAgICB9IGVsc2UgaWYgKFxuICAgICAgICAgIGVuZFRvcFBvc2l0aW9uID49IHRoaXMuc2Nyb2xsSGVpZ2h0ICYmXG4gICAgICAgICAgZW5kVG9wUG9zaXRpb24gPD0gdGhpcy5zY3JvbGxIZWlnaHQgKyAwLjFcbiAgICAgICAgKSB7XG4gICAgICAgICAgdGhpcy5zY3JvbGxUb3AgPSB0aGlzLnNjcm9sbFRvcCAtIHNjcm9sbE51ZGdlO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBjb25zdCBlbmRMZWZ0UG9zaXRpb24gPSB0aGlzLnNjcm9sbExlZnQgKyB0aGlzLmNvbnRlbnRTaXplLndpZHRoO1xuICAgICAgICBpZiAodGhpcy5zY3JvbGxMZWZ0IDw9IDAgJiYgdGhpcy5zY3JvbGxMZWZ0ID49IC0wLjEpIHtcbiAgICAgICAgICB0aGlzLnNjcm9sbExlZnQgPSBzY3JvbGxOdWRnZTtcbiAgICAgICAgfSBlbHNlIGlmIChcbiAgICAgICAgICBlbmRMZWZ0UG9zaXRpb24gPj0gdGhpcy5zY3JvbGxXaWR0aCAmJlxuICAgICAgICAgIGVuZExlZnRQb3NpdGlvbiA8PSB0aGlzLnNjcm9sbFdpZHRoICsgMC4xXG4gICAgICAgICkge1xuICAgICAgICAgIHRoaXMuc2Nyb2xsTGVmdCA9IHRoaXMuc2Nyb2xsTGVmdCAtIHNjcm9sbE51ZGdlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgaGFuZGxlU2Nyb2xsVGljayguLi5ldmVudEFyZ3M6IFNjcm9sbEV2ZW50QXJncykge1xuICAgIGNvbnN0IHNob3VsZEVtaXRTY3JvbGxFdmVudCA9IHRoaXMuc2hvdWxkRW1pdFNjcm9sbEV2ZW50KFxuICAgICAgdGhpcy5fc2Nyb2xsTGFzdFRpY2ssXG4gICAgICB0aGlzLnNjcm9sbEV2ZW50VGhyb3R0bGVcbiAgICApO1xuXG4gICAgaWYgKHNob3VsZEVtaXRTY3JvbGxFdmVudCkge1xuICAgICAgdGhpcy5fc2Nyb2xsTGFzdFRpY2sgPSBEYXRlLm5vdygpO1xuICAgICAgY29uc3Qgc2Nyb2xsRXZlbnQgPSBuZXcgUkNUU2Nyb2xsRXZlbnQoXCJvblNjcm9sbFwiLCAuLi5ldmVudEFyZ3MpO1xuICAgICAgdGhpcy5icmlkZ2UuZXZlbnREaXNwYXRjaGVyLnNlbmRFdmVudChzY3JvbGxFdmVudCk7XG4gICAgfVxuICB9XG5cbiAgc2hvdWxkRW1pdFNjcm9sbEV2ZW50KGxhc3RUaWNrOiBudW1iZXIsIGV2ZW50VGhyb3R0bGU6IG51bWJlcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IHRpbWVTaW5jZUxhc3RUaWNrID0gRGF0ZS5ub3coKSAtIGxhc3RUaWNrO1xuICAgIHJldHVybiBldmVudFRocm90dGxlID4gMCAmJiB0aW1lU2luY2VMYXN0VGljayA+PSBldmVudFRocm90dGxlO1xuICB9XG5cbiAgZ2V0IHRvdWNoYWJsZSgpOiBib29sZWFuIHtcbiAgICByZXR1cm4gc3VwZXIudG91Y2hhYmxlO1xuICB9XG5cbiAgc2V0IHRvdWNoYWJsZSh2YWx1ZTogYm9vbGVhbikge1xuICAgIHN1cGVyLnRvdWNoYWJsZSA9IHZhbHVlO1xuICAgIHRoaXMudXBkYXRlSG9zdFN0eWxlKFwiY3Vyc29yXCIsIFwiYXV0b1wiKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RTY3JvbGxWaWV3O1xuIl19