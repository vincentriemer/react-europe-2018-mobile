Object.defineProperty(exports,"__esModule",{value:true});var _defineProperty2=require("babel-runtime/helpers/defineProperty");var _defineProperty3=_interopRequireDefault(_defineProperty2);var _extends3=require("babel-runtime/helpers/extends");var _extends4=_interopRequireDefault(_extends3);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);var _RCTBridge=require("./../bridge/RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _RCTUIManager=require("./../modules/RCTUIManager");var _RCTUIManager2=_interopRequireDefault(_RCTUIManager);var _UIView=require("./../base/UIView");var _UIView2=_interopRequireDefault(_UIView);var _RCTEventDispatcher=require("./../bridge/RCTEventDispatcher");var _RCTText=require("./Text/RCTText");var _RCTText2=_interopRequireDefault(_RCTText);var _RCTRawText=require("./Text/RCTRawText");var _RCTRawText2=_interopRequireDefault(_RCTRawText);var _RCTTextInput=require("./Text/RCTTextInput");var _RCTTextInput2=_interopRequireDefault(_RCTTextInput);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function moduleNameForClass(cls){var name=cls.__moduleName;if(name!=null){if(name.startsWith("RK")){name="RCT"+name.substring(2);}if(name.endsWith("Manager")){name=name.substring(0,name.length-"Manager".length);}return name;}return"";}var RCTComponentData=function(){function RCTComponentData(managerClass,bridge){(0,_classCallCheck3.default)(this,RCTComponentData);this.bridge=bridge;this.managerClass=managerClass;this.viewPropBlocks={};this.shadowPropBlocks={};this.name=moduleNameForClass(managerClass);}(0,_createClass3.default)(RCTComponentData,[{key:"generatePropConfig",value:function generatePropConfig(rawPropConfig){return rawPropConfig.reduce(function(propConfig,raw){return(0,_extends4.default)({},propConfig,(0,_defineProperty3.default)({},raw.name,{type:raw.type,setter:raw.setter?raw.setter:function(view,value){view[raw.name]=value;}}));},{});}},{key:"createView",value:function createView(tag){var view=this.manager.view();view.reactTag=tag;return view;}},{key:"createShadowView",value:function createShadowView(tag){var shadowView=this.manager.shadowView();shadowView.reactTag=tag;return shadowView;}},{key:"setPropsForView",value:function setPropsForView(props,view){var _this=this;if(props){Object.keys(props).forEach(function(propName){if(_this.propConfig.hasOwnProperty(propName)){var propConfig=_this.propConfig[propName];var propValue=props[propName];var _setter=propConfig.setter;_setter(view,propValue);}});}}},{key:"setPropsForShadowView",value:function setPropsForShadowView(props,shadowView){var _this2=this;if(props){Object.keys(props).forEach(function(propName){if(_this2.shadowPropConfig.hasOwnProperty(propName)){var propConfig=_this2.shadowPropConfig[propName];var propValue=props[propName];var _setter2=propConfig.setter;_setter2(shadowView,propValue);}});}}},{key:"manager",get:function get(){if(this._manager==null){this._manager=this.bridge.moduleForClass(this.managerClass);}(0,_Invariant2.default)(this._manager,"RCTComponentData's view manager must be set");return this._manager;}},{key:"viewConfig",get:function get(){var count=0;var propTypes={};var bubblingEvents=[];var directEvents=[];if(this.manager.customBubblingEventTypes){var events=this.manager.customBubblingEventTypes();for(var _iterator=events,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var event=_ref;bubblingEvents.push((0,_RCTEventDispatcher.normalizeInputEventName)(event));}}this.manager.__props.forEach(function(_ref2){var name=_ref2.name,type=_ref2.type,exported=_ref2.exported;if(exported){if(type==="RCTBubblingEventBlock"){bubblingEvents.push((0,_RCTEventDispatcher.normalizeInputEventName)(name));propTypes[name]="BOOL";}else if(type==="RCTDirectEventBlock"){directEvents.push((0,_RCTEventDispatcher.normalizeInputEventName)(name));propTypes[name]="BOOL";}else{propTypes[name]=type;}}});return{propTypes:propTypes,bubblingEvents:bubblingEvents,directEvents:directEvents,baseModuleName:null};}},{key:"propConfig",get:function get(){if(this._propConfig==null){this._propConfig=this.generatePropConfig(this.manager.__props);}return this._propConfig;}},{key:"shadowPropConfig",get:function get(){if(this._shadowPropConfig==null){this._shadowPropConfig=this.generatePropConfig(this.manager.__shadowProps);}return this._shadowPropConfig;}}]);return RCTComponentData;}();exports.default=RCTComponentData;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL3ZpZXdzL1JDVENvbXBvbmVudERhdGEuanMiXSwibmFtZXMiOlsibW9kdWxlTmFtZUZvckNsYXNzIiwiY2xzIiwibmFtZSIsIl9fbW9kdWxlTmFtZSIsInN0YXJ0c1dpdGgiLCJzdWJzdHJpbmciLCJlbmRzV2l0aCIsImxlbmd0aCIsIlJDVENvbXBvbmVudERhdGEiLCJtYW5hZ2VyQ2xhc3MiLCJicmlkZ2UiLCJ2aWV3UHJvcEJsb2NrcyIsInNoYWRvd1Byb3BCbG9ja3MiLCJyYXdQcm9wQ29uZmlnIiwicmVkdWNlIiwicHJvcENvbmZpZyIsInJhdyIsInR5cGUiLCJzZXR0ZXIiLCJ2aWV3IiwidmFsdWUiLCJ0YWciLCJtYW5hZ2VyIiwicmVhY3RUYWciLCJzaGFkb3dWaWV3IiwicHJvcHMiLCJPYmplY3QiLCJrZXlzIiwiZm9yRWFjaCIsInByb3BOYW1lIiwiaGFzT3duUHJvcGVydHkiLCJwcm9wVmFsdWUiLCJzaGFkb3dQcm9wQ29uZmlnIiwiX21hbmFnZXIiLCJtb2R1bGVGb3JDbGFzcyIsImNvdW50IiwicHJvcFR5cGVzIiwiYnViYmxpbmdFdmVudHMiLCJkaXJlY3RFdmVudHMiLCJjdXN0b21CdWJibGluZ0V2ZW50VHlwZXMiLCJldmVudHMiLCJldmVudCIsInB1c2giLCJfX3Byb3BzIiwiZXhwb3J0ZWQiLCJiYXNlTW9kdWxlTmFtZSIsIl9wcm9wQ29uZmlnIiwiZ2VuZXJhdGVQcm9wQ29uZmlnIiwiX3NoYWRvd1Byb3BDb25maWciLCJfX3NoYWRvd1Byb3BzIl0sIm1hcHBpbmdzIjoiNmhCQUtBLCtDLG1EQUNBLGdELG1EQUlBLHVELHlEQUdBLHdDLDZDQUNBLGtFQUNBLHVDLCtDQUNBLDZDLHFEQUVBLGlELDRJQXFCQSxRQUFTQSxtQkFBVCxDQUE0QkMsR0FBNUIsQ0FBd0QsQ0FDdEQsR0FBSUMsTUFBT0QsSUFBSUUsWUFBZixDQUNBLEdBQUlELE1BQVEsSUFBWixDQUFrQixDQUNoQixHQUFJQSxLQUFLRSxVQUFMLENB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TCxDQUFhcUIsT0FBckMsQ0FBbkIsQ0FDRCxDQUVELE1BQU8sTUFBS0csV0FBWixDQUNELEMsNENBRXdFLENBQ3ZFLEdBQUksS0FBS0UsaUJBQUwsRUFBMEIsSUFBOUIsQ0FBb0MsQ0FDbEMsS0FBS0EsaUJBQUwsQ0FBeUIsS0FBS0Qsa0JBQUwsQ0FDdkIsS0FBS3pCLE9BQUwsQ0FBYTJCLGFBRFUsQ0FBekIsQ0FHRCxDQUVELE1BQU8sTUFBS0QsaUJBQVosQ0FDRCxDLGdEQTJDWXhDLGdCIiwiZmlsZSI6IlJDVENvbXBvbmVudERhdGEuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcm92aWRlc01vZHVsZSBSQ1RDb21wb25lbnREYXRhXG4gKiBAZmxvd1xuICovXG5cbmltcG9ydCBpbnZhcmlhbnQgZnJvbSBcIkludmFyaWFudFwiO1xuaW1wb3J0IFJDVEJyaWRnZSwge1xuICBnZXRQcm9wZXJ0eU5hbWVzLFxuICBicmlkZ2VNb2R1bGVOYW1lRm9yQ2xhc3Ncbn0gZnJvbSBcIlJDVEJyaWRnZVwiO1xuaW1wb3J0IFJDVFVJTWFuYWdlciBmcm9tIFwiUkNUVUlNYW5hZ2VyXCI7XG5cbmltcG9ydCB0eXBlIHsgUkNUQ29tcG9uZW50IH0gZnJvbSBcIlJDVENvbXBvbmVudFwiO1xuaW1wb3J0IFVJVmlldyBmcm9tIFwiVUlWaWV3XCI7XG5pbXBvcnQgeyBub3JtYWxpemVJbnB1dEV2ZW50TmFtZSB9IGZyb20gXCJSQ1RFdmVudERpc3BhdGNoZXJcIjtcbmltcG9ydCBSQ1RUZXh0IGZyb20gXCJSQ1RUZXh0XCI7XG5pbXBvcnQgUkNUUmF3VGV4dCBmcm9tIFwiUkNUUmF3VGV4dFwiO1xuaW1wb3J0IHR5cGUgUkNUVmlldyBmcm9tIFwiUkNUVmlld1wiO1xuaW1wb3J0IFJDVFRleHRJbnB1dCBmcm9tIFwiUkNUVGV4dElucHV0XCI7XG5cbmltcG9ydCB0eXBlb2YgX1JDVFNoYWRvd1ZpZXcgZnJvbSBcIlJDVFNoYWRvd1ZpZXdcIjtcbmltcG9ydCB0eXBlb2YgX1JDVFZpZXdNYW5hZ2VyIGZyb20gXCJSQ1RWaWV3TWFuYWdlclwiO1xuXG50eXBlIFJDVFZpZXdNYW5hZ2VyID0gJENhbGw8JGF3YWl0PF9SQ1RWaWV3TWFuYWdlcj4+O1xudHlwZSBSQ1RTaGFkb3dWaWV3ID0gJENhbGw8JGF3YWl0PF9SQ1RTaGFkb3dWaWV3Pj47XG5cbnR5cGUgUHJvcHMgPSB7IFtzdHJpbmddOiBhbnkgfTtcblxudHlwZSBWaWV3Q29uZmlnID0ge1xuICBwcm9wVHlwZXM6IFByb3BzLFxuICBidWJibGluZ0V2ZW50czogQXJyYXk8c3RyaW5nPixcbiAgZGlyZWN0RXZlbnRzOiBBcnJheTxzdHJpbmc+LFxuICBiYXNlTW9kdWxlTmFtZTogP3N0cmluZ1xuICAvLyB1aUNsYXNzVmlld05hbWU6IHN0cmluZ1xufTtcblxudHlwZSBSQ1RQcm9wQmxvY2sgPSAodmlldzogUkNUQ29tcG9uZW50LCB7IFtzdHJpbmddOiBhbnkgfSkgPT4gdm9pZDtcbnR5cGUgUkNUUHJvcEJsb2NrRGljdGlvbmFyeSA9IHsgW3N0cmluZ106IFJDVFByb3BCbG9jayB9O1xuXG5mdW5jdGlvbiBtb2R1bGVOYW1lRm9yQ2xhc3MoY2xzOiBDbGFzczxSQ1RWaWV3TWFuYWdlcj4pIHtcbiAgbGV0IG5hbWUgPSBjbHMuX19tb2R1bGVOYW1lO1xuICBpZiAobmFtZSAhPSBudWxsKSB7XG4gICAgaWYgKG5hbWUuc3RhcnRzV2l0aChcIlJLXCIpKSB7XG4gICAgICBuYW1lID0gYFJDVCR7bmFtZS5zdWJzdHJpbmcoMil9YDtcbiAgICB9XG4gICAgaWYgKG5hbWUuZW5kc1dpdGgoXCJNYW5hZ2VyXCIpKSB7XG4gICAgICBuYW1lID0gbmFtZS5zdWJzdHJpbmcoMCwgbmFtZS5sZW5ndGggLSBcIk1hbmFnZXJcIi5sZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gbmFtZTtcbiAgfVxuICByZXR1cm4gXCJcIjtcbn1cblxuY2xhc3MgUkNUQ29tcG9uZW50RGF0YSB7XG4gIG1hbmFnZXJDbGFzczogQ2xhc3M8UkNUVmlld01hbmFnZXI+O1xuICBuYW1lOiBzdHJpbmc7XG4gIF9tYW5hZ2VyOiA/UkNUVmlld01hbmFnZXI7XG4gIHZpZXdDb25maWc6IHsgW3N0cmluZ106IGFueSB9O1xuICBicmlkZ2U6IFJDVEJyaWRnZTtcbiAgX3Byb3BDb25maWc6ID9PYmplY3Q7XG4gIF9zaGFkb3dQcm9wQ29uZmlnOiA/T2JqZWN0O1xuXG4gIHZpZXdQcm9wQmxvY2tzOiBSQ1RQcm9wQmxvY2tEaWN0aW9uYXJ5O1xuICBzaGFkb3dQcm9wQmxvY2tzOiBSQ1RQcm9wQmxvY2tEaWN0aW9uYXJ5O1xuXG4gIGNvbnN0cnVjdG9yKG1hbmFnZXJDbGFzczogQ2xhc3M8UkNUVmlld01hbmFnZXI+LCBicmlkZ2U6IFJDVEJyaWRnZSkge1xuICAgIHRoaXMuYnJpZGdlID0gYnJpZGdlO1xuICAgIHRoaXMubWFuYWdlckNsYXNzID0gbWFuYWdlckNsYXNzO1xuICAgIHRoaXMudmlld1Byb3BCbG9ja3MgPSB7fTtcbiAgICB0aGlzLnNoYWRvd1Byb3BCbG9ja3MgPSB7fTtcbiAgICB0aGlzLm5hbWUgPSBtb2R1bGVOYW1lRm9yQ2xhc3MobWFuYWdlckNsYXNzKTtcbiAgfVxuXG4gIGdldCBtYW5hZ2VyKCk6IFJDVFZpZXdNYW5hZ2VyIHtcbiAgICBpZiAodGhpcy5fbWFuYWdlciA9PSBudWxsKSB7XG4gICAgICB0aGlzLl9tYW5hZ2VyID0gKHRoaXMuYnJpZGdlLm1vZHVsZUZvckNsYXNzKHRoaXMubWFuYWdlckNsYXNzKTogYW55KTtcbiAgICB9XG4gICAgaW52YXJpYW50KHRoaXMuX21hbmFnZXIsIFwiUkNUQ29tcG9uZW50RGF0YSdzIHZpZXcgbWFuYWdlciBtdXN0IGJlIHNldFwiKTtcbiAgICByZXR1cm4gdGhpcy5fbWFuYWdlcjtcbiAgfVxuXG4gIGdldCB2aWV3Q29uZmlnKCk6IFZpZXdDb25maWcge1xuICAgIGNvbnN0IGNvdW50ID0gMDtcbiAgICBjb25zdCBwcm9wVHlwZXMgPSB7fTtcbiAgICBjb25zdCBidWJibGluZ0V2ZW50cyA9IFtdO1xuICAgIGNvbnN0IGRpcmVjdEV2ZW50cyA9IFtdO1xuXG4gICAgaWYgKHRoaXMubWFuYWdlci5jdXN0b21CdWJibGluZ0V2ZW50VHlwZXMpIHtcbiAgICAgIGNvbnN0IGV2ZW50cyA9IHRoaXMubWFuYWdlci5jdXN0b21CdWJibGluZ0V2ZW50VHlwZXMoKTtcbiAgICAgIGZvciAobGV0IGV2ZW50IG9mIGV2ZW50cykge1xuICAgICAgICBidWJibGluZ0V2ZW50cy5wdXNoKG5vcm1hbGl6ZUlucHV0RXZlbnROYW1lKGV2ZW50KSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgdGhpcy5tYW5hZ2VyLl9fcHJvcHMuZm9yRWFjaCgoeyBuYW1lLCB0eXBlLCBleHBvcnRlZCB9KSA9PiB7XG4gICAgICBpZiAoZXhwb3J0ZWQpIHtcbiAgICAgICAgaWYgKHR5cGUgPT09IFwiUkNUQnViYmxpbmdFdmVudEJsb2NrXCIpIHtcbiAgICAgICAgICBidWJibGluZ0V2ZW50cy5wdXNoKG5vcm1hbGl6ZUlucHV0RXZlbnROYW1lKG5hbWUpKTtcbiAgICAgICAgICBwcm9wVHlwZXNbbmFtZV0gPSBcIkJPT0xcIjtcbiAgICAgICAgfSBlbHNlIGlmICh0eXBlID09PSBcIlJDVERpcmVjdEV2ZW50QmxvY2tcIikge1xuICAgICAgICAgIGRpcmVjdEV2ZW50cy5wdXNoKG5vcm1hbGl6ZUlucHV0RXZlbnROYW1lKG5hbWUpKTtcbiAgICAgICAgICBwcm9wVHlwZXNbbmFtZV0gPSBcIkJPT0xcIjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICBwcm9wVHlwZXNbbmFtZV0gPSB0eXBlO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICByZXR1cm4ge1xuICAgICAgcHJvcFR5cGVzLFxuICAgICAgYnViYmxpbmdFdmVudHMsXG4gICAgICBkaXJlY3RFdmVudHMsXG4gICAgICBiYXNlTW9kdWxlTmFtZTogbnVsbFxuICAgIH07XG4gIH1cblxuICBnZW5lcmF0ZVByb3BDb25maWcoXG4gICAgcmF3UHJvcENvbmZpZzogQXJyYXk8YW55PlxuICApOiB7IFtzdHJpbmddOiB7IHR5cGU6IHN0cmluZywgc2V0dGVyOiBGdW5jdGlvbiB9IH0ge1xuICAgIHJldHVybiByYXdQcm9wQ29uZmlnLnJlZHVjZShcbiAgICAgIChwcm9wQ29uZmlnLCByYXcpID0+ICh7XG4gICAgICAgIC4uLnByb3BDb25maWcsXG4gICAgICAgIFtyYXcubmFtZV06IHtcbiAgICAgICAgICB0eXBlOiByYXcudHlwZSxcbiAgICAgICAgICBzZXR0ZXI6IHJhdy5zZXR0ZXJcbiAgICAgICAgICAgID8gcmF3LnNldHRlclxuICAgICAgICAgICAgOiAodmlldywgdmFsdWUpID0+IHtcbiAgICAgICAgICAgICAgICB2aWV3W3Jhdy5uYW1lXSA9IHZhbHVlO1xuICAgICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pLFxuICAgICAge31cbiAgICApO1xuICB9XG5cbiAgZ2V0IHByb3BDb25maWcoKTogeyBbc3RyaW5nXTogeyB0eXBlOiBzdHJpbmcsIHNldHRlcjogRnVuY3Rpb24gfSB9IHtcbiAgICBpZiAodGhpcy5fcHJvcENvbmZpZyA9PSBudWxsKSB7XG4gICAgICB0aGlzLl9wcm9wQ29uZmlnID0gdGhpcy5nZW5lcmF0ZVByb3BDb25maWcodGhpcy5tYW5hZ2VyLl9fcHJvcHMpO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9wcm9wQ29uZmlnO1xuICB9XG5cbiAgZ2V0IHNoYWRvd1Byb3BDb25maWcoKTogeyBbc3RyaW5nXTogeyB0eXBlOiBzdHJpbmcsIHNldHRlcjogRnVuY3Rpb24gfSB9IHtcbiAgICBpZiAodGhpcy5fc2hhZG93UHJvcENvbmZpZyA9PSBudWxsKSB7XG4gICAgICB0aGlzLl9zaGFkb3dQcm9wQ29uZmlnID0gdGhpcy5nZW5lcmF0ZVByb3BDb25maWcoXG4gICAgICAgIHRoaXMubWFuYWdlci5fX3NoYWRvd1Byb3BzXG4gICAgICApO1xuICAgIH1cblxuICAgIHJldHVybiB0aGlzLl9zaGFkb3dQcm9wQ29uZmlnO1xuICB9XG5cbiAgY3JlYXRlVmlldyh0YWc6IG51bWJlcik6IFVJVmlldyB7XG4gICAgY29uc3QgdmlldzogVUlWaWV3ID0gKHRoaXMubWFuYWdlci52aWV3KCk6IGFueSk7XG4gICAgdmlldy5yZWFjdFRhZyA9IHRhZztcbiAgICByZXR1cm4gdmlldztcbiAgfVxuXG4gIGNyZWF0ZVNoYWRvd1ZpZXcodGFnOiBudW1iZXIpOiBSQ1RTaGFkb3dWaWV3IHtcbiAgICBjb25zdCBzaGFkb3dWaWV3OiBSQ1RTaGFkb3dWaWV3ID0gdGhpcy5tYW5hZ2VyLnNoYWRvd1ZpZXcoKTtcbiAgICBzaGFkb3dWaWV3LnJlYWN0VGFnID0gdGFnO1xuICAgIHJldHVybiBzaGFkb3dWaWV3O1xuICB9XG5cbiAgc2V0UHJvcHNGb3JWaWV3KHByb3BzOiBQcm9wcywgdmlldzogUkNUQ29tcG9uZW50KSB7XG4gICAgaWYgKHByb3BzKSB7XG4gICAgICBPYmplY3Qua2V5cyhwcm9wcykuZm9yRWFjaCgocHJvcE5hbWUpID0+IHtcbiAgICAgICAgaWYgKHRoaXMucHJvcENvbmZpZy5oYXNPd25Qcm9wZXJ0eShwcm9wTmFtZSkpIHtcbiAgICAgICAgICBjb25zdCBwcm9wQ29uZmlnID0gdGhpcy5wcm9wQ29uZmlnW3Byb3BOYW1lXTtcbiAgICAgICAgICBjb25zdCBwcm9wVmFsdWUgPSBwcm9wc1twcm9wTmFtZV07XG4gICAgICAgICAgY29uc3Qgc2V0dGVyID0gcHJvcENvbmZpZy5zZXR0ZXI7XG5cbiAgICAgICAgICBzZXR0ZXIodmlldywgcHJvcFZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgc2V0UHJvcHNGb3JTaGFkb3dWaWV3KHByb3BzOiBQcm9wcywgc2hhZG93VmlldzogUkNUU2hhZG93Vmlldykge1xuICAgIGlmIChwcm9wcykge1xuICAgICAgT2JqZWN0LmtleXMocHJvcHMpLmZvckVhY2goKHByb3BOYW1lKSA9PiB7XG4gICAgICAgIGlmICh0aGlzLnNoYWRvd1Byb3BDb25maWcuaGFzT3duUHJvcGVydHkocHJvcE5hbWUpKSB7XG4gICAgICAgICAgY29uc3QgcHJvcENvbmZpZyA9IHRoaXMuc2hhZG93UHJvcENvbmZpZ1twcm9wTmFtZV07XG4gICAgICAgICAgY29uc3QgcHJvcFZhbHVlID0gcHJvcHNbcHJvcE5hbWVdO1xuICAgICAgICAgIGNvbnN0IHNldHRlciA9IHByb3BDb25maWcuc2V0dGVyO1xuXG4gICAgICAgICAgc2V0dGVyKHNoYWRvd1ZpZXcsIHByb3BWYWx1ZSk7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RDb21wb25lbnREYXRhO1xuIl19