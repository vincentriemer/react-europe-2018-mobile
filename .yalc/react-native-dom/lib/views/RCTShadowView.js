var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _extends2=require("babel-runtime/helpers/extends");var _extends3=_interopRequireDefault(_extends2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _slicedToArray2=require("babel-runtime/helpers/slicedToArray");var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _this2=this;var _yogaDom=require("yoga-dom");var YG=_interopRequireWildcard(_yogaDom);var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var LAYOUT_PROPS=["top","left","width","height"];module.exports=function _callee(){var Yoga,propAlias,convertToYogaValue,setEnumProp,bindEnumProps,bindUnitProps,bindNumberProps,EDGES,bindEdgeProps,RCTShadowView;return _regenerator2.default.async(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:bindEdgeProps=function bindEdgeProps(instance,propDefs,bindingFunc){propDefs.forEach(function(propName){bindingFunc.call(null,instance,EDGES.map(function(edge){return""+propName+edge;}).concat([propName]));});};bindNumberProps=function bindNumberProps(instance,propDefs){propDefs.forEach(function(propName){Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){this.yogaNode[propName]=value;this.makeDirty();return true;}});});};bindUnitProps=function bindUnitProps(instance,propDefs){propDefs.forEach(function(propName){Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){this.yogaNode[propName]=convertToYogaValue(value,Yoga.Constants.unit);this.makeDirty();return true;}});});};bindEnumProps=function bindEnumProps(instance,propDefs){propDefs.forEach(function(_ref){var _ref2=(0,_slicedToArray3.default)(_ref,2),propName=_ref2[0],enumMap=_ref2[1];Object.defineProperty(instance,propName,{configurable:true,get:function get(){return this.yogaNode[propName];},set:function set(value){setEnumProp(this.yogaNode,propName,enumMap,value);this.makeDirty();return true;}});});};setEnumProp=function setEnumProp(yogaNode,propName,enumMap,value){if(value==null){yogaNode[propName]=NaN;}else{var enumValue=enumMap[value];if(enumValue!=null){yogaNode[propName]=enumValue;}else if(__DEV__){console.warn("No such value '"+value+"' found for prop '"+propName+"'");}}};convertToYogaValue=function convertToYogaValue(input,units){if(typeof input==="number"){return{value:input,unit:units.point};}else if(input==null){return{value:NaN,unit:units.undefined};}else{if(input==="auto"){return{value:NaN,unit:units.auto};}else{return{value:parseFloat(input),unit:input.endsWith("%")?units.percent:units.point};}}};propAlias=function propAlias(target,targetProp,sourceProp){Object.defineProperty(target,targetProp,{configurable:true,get:function get(){return this[sourceProp];},set:function set(value){this[sourceProp]=value;return true;}});};_context.next=9;return _regenerator2.default.awrap(require("yoga-dom"));case 9:Yoga=_context.sent;EDGES=["Left","Right","Top","Bottom","Start","End","Horizontal","Vertical"];RCTShadowView=function(){function RCTShadowView(){(0,_classCallCheck3.default)(this,RCTShadowView);this.isDirty=true;this.reactSubviews=[];this.yogaNode=new Yoga.Node();this.previousLayout=undefined;this.measurement=undefined;}(0,_createClass3.default)(RCTShadowView,[{key:"measureGlobal",value:function measureGlobal(){var globalX=0,globalY=0;var currentView=this;while(currentView){var _layout=currentView.previousLayout;if(_layout){globalX+=_layout.left;globalY+=_layout.top;if(currentView.hasOwnProperty("scrollOffset")){globalX-=currentView.scrollOffset.left;globalY-=currentView.scrollOffset.top;}currentView=currentView.reactSuperview;}else{currentView=null;}}return{globalX:globalX,globalY:globalY};}},{key:"getLayoutChanges",value:function getLayoutChanges(previousPosition){var _this=this;var layoutChanges=[];var newLayout=this.yogaNode.getComputedLayout();var currentPosition={top:previousPosition.top+newLayout.top,left:previousPosition.left+newLayout.left};var previousMeasurement=this.measurement?(0,_extends3.default)({},this.measurement):null;var nextMeasurement=(0,_extends3.default)({},currentPosition,{width:newLayout.width,height:newLayout.height});if(JSON.stringify(newLayout)!==JSON.stringify(this.previousLayout)){layoutChanges.push({reactTag:this.reactTag,layout:newLayout,previousMeasurement:previousMeasurement,nextMeasurement:nextMeasurement});this.previousLayout=newLayout;this.reactSubviews.forEach(function(subView){layoutChanges=layoutChanges.concat(subView.getLayoutChanges(currentPosition));});}else{var shouldUpdateChildren=function(){var result=false;_this.reactSubviews.forEach(function(subView){if(subView.isDirty){result=true;}});return result;}();if(shouldUpdateChildren){this.reactSubviews.forEach(function(subView){layoutChanges=layoutChanges.concat(subView.getLayoutChanges(currentPosition));});}}this.measurement=(0,_extends3.default)({},nextMeasurement);this.isDirty=false;return layoutChanges;}},{key:"makeDirty",value:function makeDirty(){this.isDirty=true;var view=this;while(view.reactSuperview){view=view.reactSuperview;view.isDirty=true;}}},{key:"makeDirtyRecursive",value:function makeDirtyRecursive(){this.reactSubviews.forEach(function(subView){subView.makeDirtyRecursive();});this.isDirty=true;}},{key:"insertReactSubviewAtIndex",value:function insertReactSubviewAtIndex(subview,index){subview.reactSuperview=this;this.reactSubviews.splice(index,0,subview);this.yogaNode.insertChild(subview.yogaNode,index);this.makeDirty();}},{key:"removeReactSubview",value:function removeReactSubview(subview){subview.reactSuperview=undefined;this.reactSubviews=this.reactSubviews.filter(function(s){return s!==subview;});this.yogaNode.removeChild(subview.yogaNode);this.makeDirty();}},{key:"purge",value:function purge(){this.reactSubviews.forEach(function(subView){return subView.purge();});this.yogaNode.free();}},{key:"didSetProps",value:function didSetProps(changedProps){}},{key:"didUpdateReactSubviews",value:function didUpdateReactSubviews(){}},{key:"reactTagAtPoint",value:function reactTagAtPoint(point){return 0;}},{key:"localData",set:function set(value){}},{key:"backgroundColor",get:function get(){return this._backgroundColor;},set:function set(value){this._backgroundColor=value;}}]);return RCTShadowView;}();bindEnumProps(RCTShadowView.prototype,[["direction",Yoga.Constants.direction],["flexDirection",Yoga.Constants.flexDirection],["justifyContent",Yoga.Constants.justify],["alignContent",Yoga.Constants.align],["alignItems",Yoga.Constants.align],["alignSelf",Yoga.Constants.align],["position",Yoga.Constants.position],["flexWrap",Yoga.Constants.wrap],["overflow",Yoga.Constants.overflow],["display",Yoga.Constants.display]]);bindUnitProps(RCTShadowView.prototype,["width","height","minWidth","minHeight","maxWidth","maxHeight","left","right","top","bottom","start","end","horizontal","vertical"]);bindNumberProps(RCTShadowView.prototype,["flex","flexGrow","flexShrink","aspectRatio"]);bindEdgeProps(RCTShadowView.prototype,["margin","padding"],bindUnitProps);bindEdgeProps(RCTShadowView.prototype,["border"],bindNumberProps);["borderTop","borderLeft","borderRight","borderBottom","borderStart","borderEnd"].forEach(function(propName){propAlias(RCTShadowView.prototype,propName+"Width",propName);});return _context.abrupt("return",RCTShadowView);case 19:case"end":return _context.stop();}}},null,_this2);}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL3ZpZXdzL1JDVFNoYWRvd1ZpZXcuanMiXSwibmFtZXMiOlsiWUciLCJMQVlPVVRfUFJPUFMiLCJtb2R1bGUiLCJleHBvcnRzIiwicHJvcEFsaWFzIiwiY29udmVydFRvWW9nYVZhbHVlIiwic2V0RW51bVByb3AiLCJiaW5kRW51bVByb3BzIiwiYmluZFVuaXRQcm9wcyIsImJpbmROdW1iZXJQcm9wcyIsImJpbmRFZGdlUHJvcHMiLCJpbnN0YW5jZSIsInByb3BEZWZzIiwiYmluZGluZ0Z1bmMiLCJmb3JFYWNoIiwicHJvcE5hbWUiLCJjYWxsIiwiRURHRVMiLCJtYXAiLCJlZGdlIiwiY29uY2F0IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJjb25maWd1cmFibGUiLCJnZXQiLCJ5b2dhTm9kZSIsInNldCIsInZhbHVlIiwibWFrZURpcnR5IiwiWW9nYSIsIkNvbnN0YW50cyIsInVuaXQiLCJlbnVtTWFwIiwiTmFOIiwiZW51bVZhbHVlIiwiX19ERVZfXyIsImNvbnNvbGUiLCJ3YXJuIiwiaW5wdXQiLCJ1bml0cyIsInBvaW50IiwidW5kZWZpbmVkIiwiYXV0byIsInBhcnNlRmxvYXQiLCJlbmRzV2l0aCIsInBlcmNlbnQiLCJ0YXJnZXQiLCJ0YXJnZXRQcm9wIiwic291cmNlUHJvcCIsInJlcXVpcmUiLCJSQ1RTaGFkb3dWaWV3IiwiaXNEaXJ0eSIsInJlYWN0U3Vidmlld3MiLCJOb2RlIiwicHJldmlvdXNMYXlvdXQiLCJtZWFzdXJlbWVudCIsImdsb2JhbFgiLCJnbG9iYWxZIiwiY3VycmVudFZpZXciLCJsYXlvdXQiLCJsZWZ0IiwidG9wIiwiaGFzT3duUHJvcGVydHkiLCJzY3JvbGxPZmZzZXQiLCJyZWFjdFN1cGVydmlldyIsInByZXZpb3VzUG9zaXRpb24iLCJsYXlvdXRDaGFuZ2VzIiwibmV3TGF5b3V0IiwiZ2V0Q29tcHV0ZWRMYXlvdXQiLCJjdXJyZW50UG9zaXRpb24iLCJwcmV2aW91c01lYXN1cmVtZW50IiwibmV4dE1lYXN1cmVtZW50Iiwid2lkdGgiLCJoZWlnaHQiLCJKU09OIiwic3RyaW5naWZ5IiwicHVzaCIsInJlYWN0VGFnIiwic3ViVmlldyIsImdldExheW91dENoYW5nZXMiLCJzaG91bGRVcGRhdGVDaGlsZHJlbiIsInJlc3VsdCIsInZpZXciLCJtYWtlRGlydHlSZWN1cnNpdmUiLCJzdWJ2aWV3IiwiaW5kZXgiLCJzcGxpY2UiLCJpbnNlcnRDaGlsZCIsImZpbHRlciIsInMiLCJyZW1vdmVDaGlsZCIsInB1cmdlIiwiZnJlZSIsImNoYW5nZWRQcm9wcyIsIl9iYWNrZ3JvdW5kQ29sb3IiLCJwcm90b3R5cGUiLCJkaXJlY3Rpb24iLCJmbGV4RGlyZWN0aW9uIiwianVzdGlmeSIsImFsaWduIiwicG9zaXRpb24iLCJ3cmFwIiwib3ZlcmZsb3ciLCJkaXNwbGF5Il0sIm1hcHBpbmdzIjoiNmxCQUtBLGlDLEdBQVlBLEcsbUNBQ1osK0MsZ1hBSUEsR0FBTUMsY0FBZSxDQUFDLEtBQUQsQ0FBUSxNQUFSLENBQWdCLE9BQWhCLENBQXlCLFFBQXpCLENBQXJCLENBU0FDLE9BQU9DLE9BQVAsQ0FBa0IsNEJBR1BDLFNBSE8sQ0FvQlBDLGtCQXBCTyxDQXdDUEMsV0F4Q08sQ0EwRFBDLGFBMURPLENBNkVQQyxhQTdFTyxDQW1HUEMsZUFuR08sT0FpSVBDLGFBaklPLGtJQWlJUEEsYUFqSU8sU0FpSVBBLGNBaklPLENBa0lkQyxRQWxJYyxDQW1JZEMsUUFuSWMsQ0FvSWRDLFdBcEljLENBd0lkLENBQ0FELFNBQVNFLE9BQVQsQ0FBaUIsU0FBQ0MsUUFBRCxDQUFjLENBQzdCRixZQUFZRyxJQUFaLENBQ0UsSUFERixDQUVFTCxRQUZGLENBR0VNLE1BQU1DLEdBQU4sQ0FBVSxTQUFDQyxJQUFELFdBQWFKLFFBQWIsQ0FBd0JJLElBQXhCLEVBQVYsRUFBMENDLE1BQTFDLENBQWlELENBQUNMLFFBQUQsQ0FBakQsQ0FIRixFQUtELENBTkQsRUFPRCxDQWhKZSxDQW1HUE4sZUFuR08sU0FtR1BBLGdCQW5HTyxDQW9H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QXVDLENBQUMsUUFBRCxDQUF2QyxDQUFtRHRGLGVBQW5ELEVBRUEsQ0FDRSxXQURGLENBRUUsWUFGRixDQUdFLGFBSEYsQ0FJRSxjQUpGLENBS0UsYUFMRixDQU1FLFdBTkYsRUFPRUssT0FQRixDQU9VLFNBQUNDLFFBQUQsQ0FBYyxDQUN0QlgsVUFBVThDLGNBQWM2QyxTQUF4QixDQUFtQ2hGLFNBQVcsT0FBOUMsQ0FBdURBLFFBQXZELEVBQ0QsQ0FURCxFQTlWZ0IsZ0NBeVdUbUMsYUF6V1MsNkRBQUQsRUFBakIiLCJmaWxlIjoiUkNUU2hhZG93Vmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHByb3ZpZGVzTW9kdWxlIFJDVFNoYWRvd1ZpZXdcbiAqIEBmbG93XG4gKi9cblxuaW1wb3J0ICogYXMgWUcgZnJvbSBcInlvZ2EtZG9tXCI7XG5pbXBvcnQgaW52YXJpYW50IGZyb20gXCJJbnZhcmlhbnRcIjtcblxuaW1wb3J0IHR5cGUgeyBSQ1RDb21wb25lbnQgfSBmcm9tIFwiUkNUQ29tcG9uZW50XCI7XG5cbmNvbnN0IExBWU9VVF9QUk9QUyA9IFtcInRvcFwiLCBcImxlZnRcIiwgXCJ3aWR0aFwiLCBcImhlaWdodFwiXTtcblxuZXhwb3J0IHR5cGUgTGF5b3V0Q2hhbmdlID0ge1xuICByZWFjdFRhZzogbnVtYmVyLFxuICBsYXlvdXQ6IEZyYW1lLFxuICBwcmV2aW91c01lYXN1cmVtZW50OiA/RnJhbWUsXG4gIG5leHRNZWFzdXJlbWVudDogRnJhbWVcbn07XG5cbm1vZHVsZS5leHBvcnRzID0gKGFzeW5jICgpID0+IHtcbiAgY29uc3QgWW9nYTogWUcuTW9kdWxlID0gKGF3YWl0IHJlcXVpcmUoXCJ5b2dhLWRvbVwiKTogYW55KTtcblxuICBmdW5jdGlvbiBwcm9wQWxpYXMoXG4gICAgdGFyZ2V0OiB0eXBlb2YgUkNUU2hhZG93Vmlldy5wcm90b3R5cGUsXG4gICAgdGFyZ2V0UHJvcDogc3RyaW5nLFxuICAgIHNvdXJjZVByb3A6IHN0cmluZ1xuICApIHtcbiAgICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCB0YXJnZXRQcm9wLCB7XG4gICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICBnZXQoKSB7XG4gICAgICAgIHJldHVybiB0aGlzW3NvdXJjZVByb3BdO1xuICAgICAgfSxcbiAgICAgIHNldCh2YWx1ZTogYW55KSB7XG4gICAgICAgIHRoaXNbc291cmNlUHJvcF0gPSB2YWx1ZTtcbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICB9XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBjb252ZXJ0VG9Zb2dhVmFsdWUoXG4gICAgaW5wdXQ6ID8obnVtYmVyIHwgc3RyaW5nKSxcbiAgICB1bml0czogJFByb3BlcnR5VHlwZTxZRy5Db25zdGFudHMsIFwidW5pdFwiPlxuICApOiBZRy5WYWx1ZSB7XG4gICAgaWYgKHR5cGVvZiBpbnB1dCA9PT0gXCJudW1iZXJcIikge1xuICAgICAgcmV0dXJuIHsgdmFsdWU6IGlucHV0LCB1bml0OiB1bml0cy5wb2ludCB9O1xuICAgIH0gZWxzZSBpZiAoaW5wdXQgPT0gbnVsbCkge1xuICAgICAgcmV0dXJuIHsgdmFsdWU6IE5hTiwgdW5pdDogdW5pdHMudW5kZWZpbmVkIH07XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChpbnB1dCA9PT0gXCJhdXRvXCIpIHtcbiAgICAgICAgcmV0dXJuIHsgdmFsdWU6IE5hTiwgdW5pdDogdW5pdHMuYXV0byB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICB2YWx1ZTogcGFyc2VGbG9hdChpbnB1dCksXG4gICAgICAgICAgdW5pdDogaW5wdXQuZW5kc1dpdGgoXCIlXCIpID8gdW5pdHMucGVyY2VudCA6IHVuaXRzLnBvaW50XG4gICAgICAgIH07XG4gICAgICB9XG4gICAgfVxuICB9XG5cbiAgZnVuY3Rpb24gc2V0RW51bVByb3A8VDogWUcuUHJvcEVudW1NYXA+KFxuICAgIHlvZ2FOb2RlOiBZRy5Ob2RlLFxuICAgIHByb3BOYW1lOiBzdHJpbmcsXG4gICAgZW51bU1hcDogVCxcbiAgICB2YWx1ZTogP3N0cmluZ1xuICApIHtcbiAgICBpZiAodmFsdWUgPT0gbnVsbCkge1xuICAgICAgeW9nYU5vZGVbcHJvcE5hbWVdID0gTmFOO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBlbnVtVmFsdWUgPSBlbnVtTWFwW3ZhbHVlXTtcbiAgICAgIGlmIChlbnVtVmFsdWUgIT0gbnVsbCkge1xuICAgICAgICB5b2dhTm9kZVtwcm9wTmFtZV0gPSBlbnVtVmFsdWU7XG4gICAgICB9IGVsc2UgaWYgKF9fREVWX18pIHtcbiAgICAgICAgY29uc29sZS53YXJuKGBObyBzdWNoIHZhbHVlICcke3ZhbHVlfScgZm91bmQgZm9yIHByb3AgJyR7cHJvcE5hbWV9J2ApO1xuICAgICAgfVxuICAgIH1cbiAgfVxuXG4gIGZ1bmN0aW9uIGJpbmRFbnVtUHJvcHMoXG4gICAgaW5zdGFuY2U6IHR5cGVvZiBSQ1RTaGFkb3dWaWV3LnByb3RvdHlwZSxcbiAgICBwcm9wRGVmczogW3N0cmluZywgWUcuUHJvcEVudW1NYXBdW11cbiAgKSB7XG4gICAgcHJvcERlZnMuZm9yRWFjaCgoW3Byb3BOYW1lLCBlbnVtTWFwXSkgPT4ge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGluc3RhbmNlLCBwcm9wTmFtZSwge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMueW9nYU5vZGVbcHJvcE5hbWVdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgICAgICBzZXRFbnVtUHJvcCh0aGlzLnlvZ2FOb2RlLCBwcm9wTmFtZSwgZW51bU1hcCwgdmFsdWUpO1xuICAgICAgICAgIHRoaXMubWFrZURpcnR5KCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0pO1xuICAgIH0pO1xuICB9XG5cbiAgZnVuY3Rpb24gYmluZFVuaXRQcm9wcyhcbiAgICBpbnN0YW5jZTogdHlwZW9mIFJDVFNoYWRvd1ZpZXcucHJvdG90eXBlLFxuICAgIHByb3BEZWZzOiBzdHJpbmdbXVxuICApIHtcbiAgICBwcm9wRGVmcy5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xuICAgICAgT2JqZWN0LmRlZmluZVByb3BlcnR5KGluc3RhbmNlLCBwcm9wTmFtZSwge1xuICAgICAgICBjb25maWd1cmFibGU6IHRydWUsXG4gICAgICAgIGdldDogZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIHRoaXMueW9nYU5vZGVbcHJvcE5hbWVdO1xuICAgICAgICB9LFxuICAgICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlOiBzdHJpbmcgfCBudW1iZXIpIHtcbiAgICAgICAgICB0aGlzLnlvZ2FOb2RlW3Byb3BOYW1lXSA9IGNvbnZlcnRUb1lvZ2FWYWx1ZShcbiAgICAgICAgICAgIHZhbHVlLFxuICAgICAgICAgICAgWW9nYS5Db25zdGFudHMudW5pdFxuICAgICAgICAgICk7XG4gICAgICAgICAgdGhpcy5tYWtlRGlydHkoKTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxuICBmdW5jdGlvbiBiaW5kTnVtYmVyUHJvcHMoXG4gICAgaW5zdGFuY2U6IHR5cGVvZiBSQ1RTaGFkb3dWaWV3LnByb3RvdHlwZSxcbiAgICBwcm9wRGVmczogc3RyaW5nW11cbiAgKSB7XG4gICAgcHJvcERlZnMuZm9yRWFjaCgocHJvcE5hbWUpID0+IHtcbiAgICAgIE9iamVjdC5kZWZpbmVQcm9wZXJ0eShpbnN0YW5jZSwgcHJvcE5hbWUsIHtcbiAgICAgICAgY29uZmlndXJhYmxlOiB0cnVlLFxuICAgICAgICBnZXQ6IGZ1bmN0aW9uKCkge1xuICAgICAgICAgIHJldHVybiB0aGlzLnlvZ2FOb2RlW3Byb3BOYW1lXTtcbiAgICAgICAgfSxcbiAgICAgICAgc2V0OiBmdW5jdGlvbih2YWx1ZTogbnVtYmVyKSB7XG4gICAgICAgICAgdGhpcy55b2dhTm9kZVtwcm9wTmFtZV0gPSB2YWx1ZTtcbiAgICAgICAgICB0aGlzLm1ha2VEaXJ0eSgpO1xuICAgICAgICAgIHJldHVybiB0cnVlO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICB9KTtcbiAgfVxuXG4gIGNvbnN0IEVER0VTID0gW1xuICAgIFwiTGVmdFwiLFxuICAgIFwiUmlnaHRcIixcbiAgICBcIlRvcFwiLFxuICAgIFwiQm90dG9tXCIsXG4gICAgXCJTdGFydFwiLFxuICAgIFwiRW5kXCIsXG4gICAgXCJIb3Jpem9udGFsXCIsXG4gICAgXCJWZXJ0aWNhbFwiXG4gIF07XG5cbiAgZnVuY3Rpb24gYmluZEVkZ2VQcm9wcyhcbiAgICBpbnN0YW5jZTogdHlwZW9mIFJDVFNoYWRvd1ZpZXcucHJvdG90eXBlLFxuICAgIHByb3BEZWZzOiBzdHJpbmdbXSxcbiAgICBiaW5kaW5nRnVuYzogKFxuICAgICAgaW5zdGFuY2U6IHR5cGVvZiBSQ1RTaGFkb3dWaWV3LnByb3RvdHlwZSxcbiAgICAgIHByb3BEZWZzOiBzdHJpbmdbXVxuICAgICkgPT4gdm9pZFxuICApIHtcbiAgICBwcm9wRGVmcy5mb3JFYWNoKChwcm9wTmFtZSkgPT4ge1xuICAgICAgYmluZGluZ0Z1bmMuY2FsbChcbiAgICAgICAgbnVsbCxcbiAgICAgICAgaW5zdGFuY2UsXG4gICAgICAgIEVER0VTLm1hcCgoZWRnZSkgPT4gYCR7cHJvcE5hbWV9JHtlZGdlfWApLmNvbmNhdChbcHJvcE5hbWVdKVxuICAgICAgKTtcbiAgICB9KTtcbiAgfVxuXG4gIGNsYXNzIFJDVFNoYWRvd1ZpZXcgaW1wbGVtZW50cyBSQ1RDb21wb25lbnQge1xuICAgIF9iYWNrZ3JvdW5kQ29sb3I6IHN0cmluZztcbiAgICBfdHJhbnNmb3JtOiBBcnJheTxudW1iZXI+O1xuXG4gICAgdmlld05hbWU6IHN0cmluZztcblxuICAgIHlvZ2FOb2RlOiBZb2dhLk5vZGU7XG4gICAgcHJldmlvdXNMYXlvdXQ6ID9GcmFtZTtcbiAgICBpc05ld1ZpZXc6IGJvb2xlYW47XG4gICAgaXNIaWRkZW46IGJvb2xlYW47XG4gICAgaXNEaXJ0eTogYm9vbGVhbiA9IHRydWU7XG5cbiAgICByZWFjdFRhZzogbnVtYmVyO1xuICAgIHJlYWN0U3Vidmlld3M6IEFycmF5PFJDVFNoYWRvd1ZpZXc+ID0gW107XG4gICAgcmVhY3RTdXBlcnZpZXc6ID9SQ1RTaGFkb3dWaWV3O1xuXG4gICAgbWVhc3VyZW1lbnQ6ID9GcmFtZTtcblxuICAgIGNvbnN0cnVjdG9yKCkge1xuICAgICAgdGhpcy55b2dhTm9kZSA9IG5ldyBZb2dhLk5vZGUoKTtcblxuICAgICAgdGhpcy5wcmV2aW91c0xheW91dCA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMubWVhc3VyZW1lbnQgPSB1bmRlZmluZWQ7XG4gICAgfVxuXG4gICAgc2V0IGxvY2FsRGF0YSh2YWx1ZTogYW55KSB7fVxuXG4gICAgZ2V0IGJhY2tncm91bmRDb2xvcigpOiBzdHJpbmcge1xuICAgICAgcmV0dXJuIHRoaXMuX2JhY2tncm91bmRDb2xvcjtcbiAgICB9XG5cbiAgICBzZXQgYmFja2dyb3VuZENvbG9yKHZhbHVlOiBzdHJpbmcpIHtcbiAgICAgIHRoaXMuX2JhY2tncm91bmRDb2xvciA9IHZhbHVlO1xuICAgIH1cblxuICAgIG1lYXN1cmVHbG9iYWwoKSB7XG4gICAgICBsZXQgZ2xvYmFsWCA9IDAsXG4gICAgICAgIGdsb2JhbFkgPSAwO1xuXG4gICAgICBsZXQgY3VycmVudFZpZXcgPSB0aGlzO1xuICAgICAgd2hpbGUgKGN1cnJlbnRWaWV3KSB7XG4gICAgICAgIGNvbnN0IGxheW91dCA9IGN1cnJlbnRWaWV3LnByZXZpb3VzTGF5b3V0O1xuICAgICAgICBpZiAobGF5b3V0KSB7XG4gICAgICAgICAgZ2xvYmFsWCArPSBsYXlvdXQubGVmdDtcbiAgICAgICAgICBnbG9iYWxZICs9IGxheW91dC50b3A7XG5cbiAgICAgICAgICBpZiAoY3VycmVudFZpZXcuaGFzT3duUHJvcGVydHkoXCJzY3JvbGxPZmZzZXRcIikpIHtcbiAgICAgICAgICAgIGdsb2JhbFggLT0gKGN1cnJlbnRWaWV3OiBhbnkpLnNjcm9sbE9mZnNldC5sZWZ0O1xuICAgICAgICAgICAgZ2xvYmFsWSAtPSAoY3VycmVudFZpZXc6IGFueSkuc2Nyb2xsT2Zmc2V0LnRvcDtcbiAgICAgICAgICB9XG5cbiAgICAgICAgICBjdXJyZW50VmlldyA9IGN1cnJlbnRWaWV3LnJlYWN0U3VwZXJ2aWV3O1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGN1cnJlbnRWaWV3ID0gbnVsbDtcbiAgICAgICAgfVxuICAgICAgfVxuXG4gICAgICByZXR1cm4geyBnbG9iYWxYLCBnbG9iYWxZIH07XG4gICAgfVxuXG4gICAgZ2V0TGF5b3V0Q2hhbmdlcyhwcmV2aW91c1Bvc2l0aW9uOiB7XG4gICAgICB0b3A6IG51bWJlcixcbiAgICAgIGxlZnQ6IG51bWJlclxuICAgIH0pOiBBcnJheTxMYXlvdXRDaGFuZ2U+IHtcbiAgICAgIGxldCBsYXlvdXRDaGFuZ2VzID0gW107XG5cbiAgICAgIGNvbnN0IG5ld0xheW91dCA9IHRoaXMueW9nYU5vZGUuZ2V0Q29tcHV0ZWRMYXlvdXQoKTtcblxuICAgICAgY29uc3QgY3VycmVudFBvc2l0aW9uID0ge1xuICAgICAgICB0b3A6IHByZXZpb3VzUG9zaXRpb24udG9wICsgbmV3TGF5b3V0LnRvcCxcbiAgICAgICAgbGVmdDogcHJldmlvdXNQb3NpdGlvbi5sZWZ0ICsgbmV3TGF5b3V0LmxlZnRcbiAgICAgIH07XG5cbiAgICAgIGNvbnN0IHByZXZpb3VzTWVhc3VyZW1lbnQgPSB0aGlzLm1lYXN1cmVtZW50XG4gICAgICAgID8geyAuLi50aGlzLm1lYXN1cmVtZW50IH1cbiAgICAgICAgOiBudWxsO1xuXG4gICAgICBjb25zdCBuZXh0TWVhc3VyZW1lbnQgPSB7XG4gICAgICAgIC4uLmN1cnJlbnRQb3NpdGlvbixcbiAgICAgICAgd2lkdGg6IG5ld0xheW91dC53aWR0aCxcbiAgICAgICAgaGVpZ2h0OiBuZXdMYXlvdXQuaGVpZ2h0XG4gICAgICB9O1xuXG4gICAgICBpZiAoSlNPTi5zdHJpbmdpZnkobmV3TGF5b3V0KSAhPT0gSlNPTi5zdHJpbmdpZnkodGhpcy5wcmV2aW91c0xheW91dCkpIHtcbiAgICAgICAgbGF5b3V0Q2hhbmdlcy5wdXNoKHtcbiAgICAgICAgICByZWFjdFRhZzogdGhpcy5yZWFjdFRhZyxcbiAgICAgICAgICBsYXlvdXQ6IG5ld0xheW91dCxcbiAgICAgICAgICBwcmV2aW91c01lYXN1cmVtZW50LFxuICAgICAgICAgIG5leHRNZWFzdXJlbWVudFxuICAgICAgICB9KTtcblxuICAgICAgICB0aGlzLnByZXZpb3VzTGF5b3V0ID0gbmV3TGF5b3V0O1xuXG4gICAgICAgIHRoaXMucmVhY3RTdWJ2aWV3cy5mb3JFYWNoKChzdWJWaWV3KSA9PiB7XG4gICAgICAgICAgbGF5b3V0Q2hhbmdlcyA9IGxheW91dENoYW5nZXMuY29uY2F0KFxuICAgICAgICAgICAgc3ViVmlldy5nZXRMYXlvdXRDaGFuZ2VzKGN1cnJlbnRQb3NpdGlvbilcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGNvbnN0IHNob3VsZFVwZGF0ZUNoaWxkcmVuOiBib29sZWFuID0gKCgpID0+IHtcbiAgICAgICAgICBsZXQgcmVzdWx0ID0gZmFsc2U7XG4gICAgICAgICAgdGhpcy5yZWFjdFN1YnZpZXdzLmZvckVhY2goKHN1YlZpZXcpID0+IHtcbiAgICAgICAgICAgIGlmIChzdWJWaWV3LmlzRGlydHkpIHtcbiAgICAgICAgICAgICAgcmVzdWx0ID0gdHJ1ZTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9KTtcbiAgICAgICAgICByZXR1cm4gcmVzdWx0O1xuICAgICAgICB9KSgpO1xuXG4gICAgICAgIGlmIChzaG91bGRVcGRhdGVDaGlsZHJlbikge1xuICAgICAgICAgIHRoaXMucmVhY3RTdWJ2aWV3cy5mb3JFYWNoKChzdWJWaWV3KSA9PiB7XG4gICAgICAgICAgICBsYXlvdXRDaGFuZ2VzID0gbGF5b3V0Q2hhbmdlcy5jb25jYXQoXG4gICAgICAgICAgICAgIHN1YlZpZXcuZ2V0TGF5b3V0Q2hhbmdlcyhjdXJyZW50UG9zaXRpb24pXG4gICAgICAgICAgICApO1xuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIHRoaXMubWVhc3VyZW1lbnQgPSB7IC4uLm5leHRNZWFzdXJlbWVudCB9O1xuICAgICAgdGhpcy5pc0RpcnR5ID0gZmFsc2U7XG4gICAgICByZXR1cm4gbGF5b3V0Q2hhbmdlcztcbiAgICB9XG5cbiAgICBtYWtlRGlydHkoKTogdm9pZCB7XG4gICAgICB0aGlzLmlzRGlydHkgPSB0cnVlO1xuXG4gICAgICBsZXQgdmlldyA9IHRoaXM7XG4gICAgICB3aGlsZSAodmlldy5yZWFjdFN1cGVydmlldykge1xuICAgICAgICB2aWV3ID0gdmlldy5yZWFjdFN1cGVydmlldztcbiAgICAgICAgdmlldy5pc0RpcnR5ID0gdHJ1ZTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBtYWtlRGlydHlSZWN1cnNpdmUoKTogdm9pZCB7XG4gICAgICB0aGlzLnJlYWN0U3Vidmlld3MuZm9yRWFjaCgoc3ViVmlldykgPT4ge1xuICAgICAgICBzdWJWaWV3Lm1ha2VEaXJ0eVJlY3Vyc2l2ZSgpO1xuICAgICAgfSk7XG4gICAgICB0aGlzLmlzRGlydHkgPSB0cnVlO1xuICAgIH1cblxuICAgIGluc2VydFJlYWN0U3Vidmlld0F0SW5kZXgoc3VidmlldzogUkNUU2hhZG93VmlldywgaW5kZXg6IG51bWJlcikge1xuICAgICAgc3Vidmlldy5yZWFjdFN1cGVydmlldyA9IHRoaXM7XG4gICAgICB0aGlzLnJlYWN0U3Vidmlld3Muc3BsaWNlKGluZGV4LCAwLCBzdWJ2aWV3KTtcbiAgICAgIHRoaXMueW9nYU5vZGUuaW5zZXJ0Q2hpbGQoc3Vidmlldy55b2dhTm9kZSwgaW5kZXgpO1xuICAgICAgdGhpcy5tYWtlRGlydHkoKTtcbiAgICB9XG5cbiAgICByZW1vdmVSZWFjdFN1YnZpZXcoc3VidmlldzogUkNUU2hhZG93Vmlldykge1xuICAgICAgc3Vidmlldy5yZWFjdFN1cGVydmlldyA9IHVuZGVmaW5lZDtcbiAgICAgIHRoaXMucmVhY3RTdWJ2aWV3cyA9IHRoaXMucmVhY3RTdWJ2aWV3cy5maWx0ZXIoKHMpID0+IHMgIT09IHN1YnZpZXcpO1xuICAgICAgdGhpcy55b2dhTm9kZS5yZW1vdmVDaGlsZChzdWJ2aWV3LnlvZ2FOb2RlKTtcbiAgICAgIHRoaXMubWFrZURpcnR5KCk7XG4gICAgfVxuXG4gICAgcHVyZ2UoKSB7XG4gICAgICB0aGlzLnJlYWN0U3Vidmlld3MuZm9yRWFjaCgoc3ViVmlldykgPT4gc3ViVmlldy5wdXJnZSgpKTtcbiAgICAgIHRoaXMueW9nYU5vZGUuZnJlZSgpO1xuICAgIH1cblxuICAgIC8vIFRPRE86IEltcGxlbWVudCA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09XG4gICAgZGlkU2V0UHJvcHMoY2hhbmdlZFByb3BzOiBBcnJheTxzdHJpbmc+KSB7fVxuICAgIGRpZFVwZGF0ZVJlYWN0U3Vidmlld3MoKSB7fVxuICAgIHJlYWN0VGFnQXRQb2ludChwb2ludDogeyB4OiBudW1iZXIsIHk6IG51bWJlciB9KTogbnVtYmVyIHtcbiAgICAgIHJldHVybiAwO1xuICAgIH1cbiAgfVxuXG4gIGJpbmRFbnVtUHJvcHMoUkNUU2hhZG93Vmlldy5wcm90b3R5cGUsIFtcbiAgICBbXCJkaXJlY3Rpb25cIiwgWW9nYS5Db25zdGFudHMuZGlyZWN0aW9uXSxcbiAgICBbXCJmbGV4RGlyZWN0aW9uXCIsIFlvZ2EuQ29uc3RhbnRzLmZsZXhEaXJlY3Rpb25dLFxuICAgIFtcImp1c3RpZnlDb250ZW50XCIsIFlvZ2EuQ29uc3RhbnRzLmp1c3RpZnldLFxuICAgIFtcImFsaWduQ29udGVudFwiLCBZb2dhLkNvbnN0YW50cy5hbGlnbl0sXG4gICAgW1wiYWxpZ25JdGVtc1wiLCBZb2dhLkNvbnN0YW50cy5hbGlnbl0sXG4gICAgW1wiYWxpZ25TZWxmXCIsIFlvZ2EuQ29uc3RhbnRzLmFsaWduXSxcbiAgICBbXCJwb3NpdGlvblwiLCBZb2dhLkNvbnN0YW50cy5wb3NpdGlvbl0sXG4gICAgW1wiZmxleFdyYXBcIiwgWW9nYS5Db25zdGFudHMud3JhcF0sXG4gICAgW1wib3ZlcmZsb3dcIiwgWW9nYS5Db25zdGFudHMub3ZlcmZsb3ddLFxuICAgIFtcImRpc3BsYXlcIiwgWW9nYS5Db25zdGFudHMuZGlzcGxheV1cbiAgXSk7XG4gIGJpbmRVbml0UHJvcHMoUkNUU2hhZG93Vmlldy5wcm90b3R5cGUsIFtcbiAgICBcIndpZHRoXCIsXG4gICAgXCJoZWlnaHRcIixcbiAgICBcIm1pbldpZHRoXCIsXG4gICAgXCJtaW5IZWlnaHRcIixcbiAgICBcIm1heFdpZHRoXCIsXG4gICAgXCJtYXhIZWlnaHRcIixcbiAgICBcImxlZnRcIixcbiAgICBcInJpZ2h0XCIsXG4gICAgXCJ0b3BcIixcbiAgICBcImJvdHRvbVwiLFxuICAgIFwic3RhcnRcIixcbiAgICBcImVuZFwiLFxuICAgIFwiaG9yaXpvbnRhbFwiLFxuICAgIFwidmVydGljYWxcIlxuICBdKTtcbiAgYmluZE51bWJlclByb3BzKFJDVFNoYWRvd1ZpZXcucHJvdG90eXBlLCBbXG4gICAgXCJmbGV4XCIsXG4gICAgXCJmbGV4R3Jvd1wiLFxuICAgIFwiZmxleFNocmlua1wiLFxuICAgIFwiYXNwZWN0UmF0aW9cIlxuICBdKTtcbiAgYmluZEVkZ2VQcm9wcyhSQ1RTaGFkb3dWaWV3LnByb3RvdHlwZSwgW1wibWFyZ2luXCIsIFwicGFkZGluZ1wiXSwgYmluZFVuaXRQcm9wcyk7XG4gIGJpbmRFZGdlUHJvcHMoUkNUU2hhZG93Vmlldy5wcm90b3R5cGUsIFtcImJvcmRlclwiXSwgYmluZE51bWJlclByb3BzKTtcblxuICBbXG4gICAgXCJib3JkZXJUb3BcIixcbiAgICBcImJvcmRlckxlZnRcIixcbiAgICBcImJvcmRlclJpZ2h0XCIsXG4gICAgXCJib3JkZXJCb3R0b21cIixcbiAgICBcImJvcmRlclN0YXJ0XCIsXG4gICAgXCJib3JkZXJFbmRcIlxuICBdLmZvckVhY2goKHByb3BOYW1lKSA9PiB7XG4gICAgcHJvcEFsaWFzKFJDVFNoYWRvd1ZpZXcucHJvdG90eXBlLCBwcm9wTmFtZSArIFwiV2lkdGhcIiwgcHJvcE5hbWUpO1xuICB9KTtcblxuICByZXR1cm4gUkNUU2hhZG93Vmlldztcbn0pKCk7XG4iXX0=