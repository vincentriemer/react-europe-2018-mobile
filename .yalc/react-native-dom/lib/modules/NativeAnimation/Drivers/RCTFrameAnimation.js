Object.defineProperty(exports,"__esModule",{value:true});var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray");var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _RCTAnimationDriver=require("./RCTAnimationDriver");var _RCTAnimationUtils=require("./../RCTAnimationUtils");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var RCTFrameAnimation=function(){function RCTFrameAnimation(animationId,config,valueNode,callback){(0,_classCallCheck3.default)(this,RCTFrameAnimation);this.animationId=animationId;this.toValue=config.toValue!=null?config.toValue:1;this.fromValue=valueNode.value;this.valueNode=valueNode;this.frames=[].concat((0,_toConsumableArray3.default)(config.frames));this.callback=callback;this.iterations=config.iterations!=null?config.iterations:1;this.currentLoop=1;this.animationHasBegun=false;this.animationHasFinished=this.iterations===0;return this;}(0,_createClass3.default)(RCTFrameAnimation,[{key:"startAnimation",value:function startAnimation(){this.animationStartTime=this.animationCurrentTIme=-1;this.animationHasBegun=true;}},{key:"stopAnimation",value:function stopAnimation(){if(this.callback){this.callback({finished:this.animationHasFinished});}}},{key:"stepAnimationWithTime",value:function stepAnimationWithTime(currentTime){if(!this.animationHasBegun||this.animationHasFinished||this.frames.length===0){return;}if(this.animationStartTime===-1){this.animationStartTime=this.animationCurrentTIme=currentTime;}this.animationCurrentTIme=currentTime;var currentDuration=this.animationCurrentTIme-this.animationStartTime;var startIndex=Math.floor(currentDuration/_RCTAnimationDriver.RCTSingleFrameInterval);var nextIndex=startIndex+1;if(nextIndex>=this.frames.length){if(this.iterations==-1||this.currentLoop<this.iterations){this.animationStartTime=currentTime;this.currentLoop++;var firstValue=this.frames[0];this.updateOutputWithFrameOutput(firstValue);}else{this.animationHasFinished=true;var finalValue=this.frames[this.frames.length-1];this.updateOutputWithFrameOutput(finalValue);}return;}var fromFrameValue=this.frames[startIndex];var toFrameValue=this.frames[nextIndex];var fromInterval=startIndex*_RCTAnimationDriver.RCTSingleFrameInterval;var toInterval=nextIndex*_RCTAnimationDriver.RCTSingleFrameInterval;var frameOutput=(0,_RCTAnimationUtils.RCTInterpolateValue)(currentDuration,fromInterval,toInterval,fromFrameValue,toFrameValue,"extend","extend");this.updateOutputWithFrameOutput(frameOutput);}},{key:"updateOutputWithFrameOutput",value:function updateOutputWithFrameOutput(frameOutput){var outputValue=(0,_RCTAnimationUtils.RCTInterpolateValue)(frameOutput,0,1,this.fromValue,this.toValue,"extend","extend");var valueNode=this.valueNode;if(valueNode){valueNode.value=outputValue;valueNode.setNeedsUpdate();}}}]);return RCTFrameAnimation;}();exports.default=RCTFrameAnimation;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uL1JlYWN0RG9tL21vZHVsZXMvTmF0aXZlQW5pbWF0aW9uL0RyaXZlcnMvUkNURnJhbWVBbmltYXRpb24uanMiXSwibmFtZXMiOlsiUkNURnJhbWVBbmltYXRpb24iLCJhbmltYXRpb25JZCIsImNvbmZpZyIsInZhbHVlTm9kZSIsImNhbGxiYWNrIiwidG9WYWx1ZSIsImZyb21WYWx1ZSIsInZhbHVlIiwiZnJhbWVzIiwiaXRlcmF0aW9ucyIsImN1cnJlbnRMb29wIiwiYW5pbWF0aW9uSGFzQmVndW4iLCJhbmltYXRpb25IYXNGaW5pc2hlZCIsImFuaW1hdGlvblN0YXJ0VGltZSIsImFuaW1hdGlvbkN1cnJlbnRUSW1lIiwiZmluaXNoZWQiLCJjdXJyZW50VGltZSIsImxlbmd0aCIsImN1cnJlbnREdXJhdGlvbiIsInN0YXJ0SW5kZXgiLCJNYXRoIiwiZmxvb3IiLCJuZXh0SW5kZXgiLCJmaXJzdFZhbHVlIiwidXBkYXRlT3V0cHV0V2l0aEZyYW1lT3V0cHV0IiwiZmluYWxWYWx1ZSIsImZyb21GcmFtZVZhbHVlIiwidG9GcmFtZVZhbHVlIiwiZnJvbUludGVydmFsIiwidG9JbnRlcnZhbCIsImZyYW1lT3V0cHV0Iiwib3V0cHV0VmFsdWUiLCJzZXROZWVkc1VwZGF0ZSJdLCJtYXBwaW5ncyI6ImtjQVNBLHdEQUNBLHlELHNGQUVNQSxrQixZQWdCSiwyQkFDRUMsV0FERixDQUVFQyxNQUZGLENBR0VDLFNBSEYsQ0FJRUMsUUFKRixDQUtFLHNEQUNBLEtBQUtILFdBQUwsQ0FBbUJBLFdBQW5CLENBQ0EsS0FBS0ksT0FBTCxDQUFlSCxPQUFPRyxPQUFQLEVBQWtCLElBQWxCLENBQXlCSCxPQUFPRyxPQUFoQyxDQUEwQyxDQUF6RCxDQUNBLEtBQUtDLFNBQUwsQ0FBaUJILFVBQVVJLEtBQTNCLENBQ0EsS0FBS0osU0FBTCxDQUFpQkEsU0FBakIsQ0FDQSxLQUFLSyxNQUFMLDJDQUFrQk4sT0FBT00sTUFBekIsR0FDQSxLQUFLSixRQUFMLENBQWdCQSxRQUFoQixDQUNBLEtBQUtLLFVBQUwsQ0FBa0JQLE9BQU9PLFVBQVAsRUFBcUIsSUFBckIsQ0FBNEJQLE9BQU9PLFVBQW5DLENBQWdELENBQWxFLENBQ0EsS0FBS0MsV0FBTCxDQUFtQixDQUFuQixDQUNBLEtBQUtDLGlCQUFMLENBQXlCLEtBQXpCLENBQ0EsS0FBS0Msb0JBQUwsQ0FBNEIsS0FBS0gsVUFBTCxHQUFvQixDQUFoRCxDQUNBLE1BQU8sS0FBUCxDQUNELEMsa0dBRWdCLENBQ2YsS0FBS0ksa0JBQUwsQ0FBMEIsS0FBS0Msb0JBQUwsQ0FBNEIsQ0FBQyxDQUF2RCxDQUNBLEtBQUtILGlCQUFMLENBQXlCLElBQXpCLENBQ0QsQyxxREFFZSxDQUVkLEdBQUksS0FBS1AsUUFBVCxDQUFtQixDQUNqQixLQUFLQSxRQUFMLENBQWMsQ0FDWlcsU0FBVSxLQUFLSCxvQkFESCxDQUFkLEVBR0QsQ0FDRixDLG9FQUVxQkksVyxDQUFxQixDQUN6QyxHQUNFLENBQUMsS0FBS0wsaUJBQU4sRUFDQSxLQUFLQyxvQkFETCxFQUVBLEtBQUtKLE1BQUwsQ0FBWVMsTUFBWixHQUF1QixDQUh6QixDQUlFLENBRUEsT0FDRCxDQUVELEdBQUksS0FBS0osa0JBQUwsR0FBNEIsQ0FBQyxDQUFqQyxDQUFvQyxDQUNsQyxLQUFLQSxrQkFBTCxDQUEwQixLQUFLQyxvQkFBTCxDQUE0QkUsV0FBdEQsQ0FDRCxDQUVELEtBQUtGLG9CQUFMLENBQTRCRSxXQUE1QixDQUNBLEdBQU1FLGlCQUFrQixLQUFLSixvQkFBTCxDQUE0QixLQUFLRCxrQkFBekQsQ0FJQSxHQUFNTSxZQUFhQyxLQUFLQyxLQUFMLENBQVdILDBEQUFYLENBQW5CLENBQ0EsR0FBTUksV0FBWUgsV0FBYSxDQUEvQixDQUVBLEdBQUlHLFdBQWEsS0FBS2QsTUFBTCxDQUFZUyxNQUE3QixDQUFxQyxDQUNuQyxHQUFJLEtBQUtSLFVBQUwsRUFBbUIsQ0FBQyxDQUFwQixFQUF5QixLQUFLQyxXQUFMLENBQW1CLEtBQUtELFVBQXJELENBQWlFLENBRS9ELEtBQUtJLGtCQUFMLENBQTBCRyxXQUExQixDQUNBLEtBQUtOLFdBQUwsR0FDQSxHQUFNYSxZQUFhLEtBQUtmLE1BQUwsQ0FBWSxDQUFaLENBQW5CLENBQ0EsS0FBS2dCLDJCQUFMLENBQWlDRCxVQUFqQyxFQUNELENBTkQsSUFNTyxDQUNMLEtBQUtYLG9CQUFMLENBQTRCLElBQTVCLENBR0EsR0FBTWEsWUFBYSxLQUFLakIsTUFBTCxDQUFZLEtBQUtBLE1BQUwsQ0FBWVMsTUFBWixDQUFxQixDQUFqQyxDQUFuQixDQUNBLEtBQUtPLDJCQUFMLENBQWlDQyxVQUFqQyxFQUNELENBQ0QsT0FDRCxDQUdELEdBQU1DLGdCQUFpQixLQUFLbEIsTUFBTCxDQUFZVyxVQUFaLENBQXZCLENBQ0EsR0FBTVEsY0FBZSxLQUFLbkIsTUFBTCxDQUFZYyxTQUFaLENBQXJCLENBQ0EsR0FBTU0sY0FBZVQscURBQXJCLENBQ0EsR0FBTVUsWUFBYVAsb0RBQW5CLENBSUEsR0FBTVEsYUFBYywyQ0FDbEJaLGVBRGtCLENBRWxCVSxZQUZrQixDQUdsQkMsVUFIa0IsQ0FJbEJILGNBSmtCLENBS2xCQyxZQUxrQixDQU1sQixRQU5rQixDQU9sQixRQVBrQixDQUFwQixDQVVBLEtBQUtILDJCQUFMLENBQWlDTSxXQUFqQyxFQUNELEMsZ0ZBRTJCQSxXLENBQXFCLENBQy9DLEdBQU1DLGFBQWMsMkNBQ2xCRCxXQURrQixDQUVsQixDQUZrQixDQUdsQixDQUhrQixDQUlsQixLQUFLeEIsU0FKYSxDQUtsQixLQUFLRCxPQUxhLENBTWxCLFFBTmtCLENBT2xCLFFBUGtCLENBQXBCLENBVUEsR0FBTUYsV0FBWSxLQUFLQSxTQUF2QixDQUNBLEdBQUlBLFNBQUosQ0FBZSxDQUNiQSxVQUFVSSxLQUFWLENBQWtCd0IsV0FBbEIsQ0FDQTVCLFVBQVU2QixjQUFWLEdBQ0QsQ0FDRixDLGlEQUdZaEMsaUIiLCJmaWxlIjoiUkNURnJhbWVBbmltYXRpb24uanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcm92aWRlc01vZHVsZSBSQ1RGcmFtZUFuaW1hdGlvblxuICogQGZsb3dcbiAqL1xuXG5pbXBvcnQgdHlwZSB7IENvbmZpZyB9IGZyb20gXCJSQ1ROYXRpdmVBbmltYXRlZE1vZHVsZVwiO1xuaW1wb3J0IHR5cGUgeyBSQ1RBbmltYXRpb25Ecml2ZXIgfSBmcm9tIFwiUkNUQW5pbWF0aW9uRHJpdmVyXCI7XG5pbXBvcnQgdHlwZSBSQ1RWYWx1ZUFuaW1hdGVkTm9kZSBmcm9tIFwiUkNUVmFsdWVBbmltYXRlZE5vZGVcIjtcblxuaW1wb3J0IHsgUkNUU2luZ2xlRnJhbWVJbnRlcnZhbCB9IGZyb20gXCJSQ1RBbmltYXRpb25Ecml2ZXJcIjtcbmltcG9ydCB7IFJDVEludGVycG9sYXRlVmFsdWUgfSBmcm9tIFwiUkNUQW5pbWF0aW9uVXRpbHNcIjtcblxuY2xhc3MgUkNURnJhbWVBbmltYXRpb24gaW1wbGVtZW50cyBSQ1RBbmltYXRpb25Ecml2ZXIge1xuICBhbmltYXRpb25JZDogbnVtYmVyO1xuICB2YWx1ZU5vZGU6IFJDVFZhbHVlQW5pbWF0ZWROb2RlO1xuICBhbmltYXRpb25IYXNCZWd1bjogYm9vbGVhbjtcbiAgYW5pbWF0aW9uSGFzRmluaXNoZWQ6IGJvb2xlYW47XG5cbiAgYW5pbWF0aW9uU3RhcnRUaW1lOiBudW1iZXI7XG4gIGFuaW1hdGlvbkN1cnJlbnRUSW1lOiBudW1iZXI7XG5cbiAgZnJhbWVzOiBudW1iZXJbXTtcbiAgdG9WYWx1ZTogbnVtYmVyO1xuICBmcm9tVmFsdWU6IG51bWJlcjtcbiAgY2FsbGJhY2s6IEZ1bmN0aW9uO1xuICBpdGVyYXRpb25zOiBudW1iZXI7XG4gIGN1cnJlbnRMb29wOiBudW1iZXI7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYW5pbWF0aW9uSWQ6IG51bWJlcixcbiAgICBjb25maWc6IENvbmZpZyxcbiAgICB2YWx1ZU5vZGU6IFJDVFZhbHVlQW5pbWF0ZWROb2RlLFxuICAgIGNhbGxiYWNrOiBGdW5jdGlvblxuICApIHtcbiAgICB0aGlzLmFuaW1hdGlvbklkID0gYW5pbWF0aW9uSWQ7XG4gICAgdGhpcy50b1ZhbHVlID0gY29uZmlnLnRvVmFsdWUgIT0gbnVsbCA/IGNvbmZpZy50b1ZhbHVlIDogMTtcbiAgICB0aGlzLmZyb21WYWx1ZSA9IHZhbHVlTm9kZS52YWx1ZTtcbiAgICB0aGlzLnZhbHVlTm9kZSA9IHZhbHVlTm9kZTtcbiAgICB0aGlzLmZyYW1lcyA9IFsuLi5jb25maWcuZnJhbWVzXTtcbiAgICB0aGlzLmNhbGxiYWNrID0gY2FsbGJhY2s7XG4gICAgdGhpcy5pdGVyYXRpb25zID0gY29uZmlnLml0ZXJhdGlvbnMgIT0gbnVsbCA/IGNvbmZpZy5pdGVyYXRpb25zIDogMTtcbiAgICB0aGlzLmN1cnJlbnRMb29wID0gMTtcbiAgICB0aGlzLmFuaW1hdGlvbkhhc0JlZ3VuID0gZmFsc2U7XG4gICAgdGhpcy5hbmltYXRpb25IYXNGaW5pc2hlZCA9IHRoaXMuaXRlcmF0aW9ucyA9PT0gMDtcbiAgICByZXR1cm4gdGhpcztcbiAgfVxuXG4gIHN0YXJ0QW5pbWF0aW9uKCkge1xuICAgIHRoaXMuYW5pbWF0aW9uU3RhcnRUaW1lID0gdGhpcy5hbmltYXRpb25DdXJyZW50VEltZSA9IC0xO1xuICAgIHRoaXMuYW5pbWF0aW9uSGFzQmVndW4gPSB0cnVlO1xuICB9XG5cbiAgc3RvcEFuaW1hdGlvbigpIHtcbiAgICAvLyB0aGlzLnZhbHVlTm9kZSA9IG51bGw7XG4gICAgaWYgKHRoaXMuY2FsbGJhY2spIHtcbiAgICAgIHRoaXMuY2FsbGJhY2soe1xuICAgICAgICBmaW5pc2hlZDogdGhpcy5hbmltYXRpb25IYXNGaW5pc2hlZFxuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgc3RlcEFuaW1hdGlvbldpdGhUaW1lKGN1cnJlbnRUaW1lOiBudW1iZXIpIHtcbiAgICBpZiAoXG4gICAgICAhdGhpcy5hbmltYXRpb25IYXNCZWd1biB8fFxuICAgICAgdGhpcy5hbmltYXRpb25IYXNGaW5pc2hlZCB8fFxuICAgICAgdGhpcy5mcmFtZXMubGVuZ3RoID09PSAwXG4gICAgKSB7XG4gICAgICAvLyBBbmltYXRpb24gaGFzIG5vdCBiZWd1biBvciBhbmltYXRpb24gaGFzIGFscmVhZHkgZmluaXNoZWQuXG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuYW5pbWF0aW9uU3RhcnRUaW1lID09PSAtMSkge1xuICAgICAgdGhpcy5hbmltYXRpb25TdGFydFRpbWUgPSB0aGlzLmFuaW1hdGlvbkN1cnJlbnRUSW1lID0gY3VycmVudFRpbWU7XG4gICAgfVxuXG4gICAgdGhpcy5hbmltYXRpb25DdXJyZW50VEltZSA9IGN1cnJlbnRUaW1lO1xuICAgIGNvbnN0IGN1cnJlbnREdXJhdGlvbiA9IHRoaXMuYW5pbWF0aW9uQ3VycmVudFRJbWUgLSB0aGlzLmFuaW1hdGlvblN0YXJ0VGltZTtcblxuICAgIC8vIERldGVybWluZSBob3cgbWFueSBmcmFtZXMgaGF2ZSBwYXNzZWQgc2luY2UgbGFzdCB1cGRhdGUuXG4gICAgLy8gR2V0IGluZGV4IG9mIGZyYW1lcyB0aGF0IHN1cnJvdW5kIHRoZSBjdXJyZW50IGludGVydmFsXG4gICAgY29uc3Qgc3RhcnRJbmRleCA9IE1hdGguZmxvb3IoY3VycmVudER1cmF0aW9uIC8gUkNUU2luZ2xlRnJhbWVJbnRlcnZhbCk7XG4gICAgY29uc3QgbmV4dEluZGV4ID0gc3RhcnRJbmRleCArIDE7XG5cbiAgICBpZiAobmV4dEluZGV4ID49IHRoaXMuZnJhbWVzLmxlbmd0aCkge1xuICAgICAgaWYgKHRoaXMuaXRlcmF0aW9ucyA9PSAtMSB8fCB0aGlzLmN1cnJlbnRMb29wIDwgdGhpcy5pdGVyYXRpb25zKSB7XG4gICAgICAgIC8vIExvb3BpbmcsIHJlc2V0IHRvIHRoZSBmaXJzdCBmcmFtZSB2YWx1ZS5cbiAgICAgICAgdGhpcy5hbmltYXRpb25TdGFydFRpbWUgPSBjdXJyZW50VGltZTtcbiAgICAgICAgdGhpcy5jdXJyZW50TG9vcCsrO1xuICAgICAgICBjb25zdCBmaXJzdFZhbHVlID0gdGhpcy5mcmFtZXNbMF07XG4gICAgICAgIHRoaXMudXBkYXRlT3V0cHV0V2l0aEZyYW1lT3V0cHV0KGZpcnN0VmFsdWUpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy5hbmltYXRpb25IYXNGaW5pc2hlZCA9IHRydWU7XG4gICAgICAgIC8vIFdlIGFyZSBhdCB0aGUgZW5kIG9mIHRoZSBhbmltYXRpb25cbiAgICAgICAgLy8gVXBkYXRlIHZhbHVlIGFuZCBmbGFnIGFuaW1hdGlvbiBoYXMgZW5kZWQuXG4gICAgICAgIGNvbnN0IGZpbmFsVmFsdWUgPSB0aGlzLmZyYW1lc1t0aGlzLmZyYW1lcy5sZW5ndGggLSAxXTtcbiAgICAgICAgdGhpcy51cGRhdGVPdXRwdXRXaXRoRnJhbWVPdXRwdXQoZmluYWxWYWx1ZSk7XG4gICAgICB9XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgLy8gRG8gYSBsaW5lYXIgcmVtYXAgb2YgdGhlIHR3byBmcmFtZXMgdG8gc2FmZWdhdXJkIGFnYWluc3QgdmFyaWFibGUgZnJhbWVyYXRlc1xuICAgIGNvbnN0IGZyb21GcmFtZVZhbHVlID0gdGhpcy5mcmFtZXNbc3RhcnRJbmRleF07XG4gICAgY29uc3QgdG9GcmFtZVZhbHVlID0gdGhpcy5mcmFtZXNbbmV4dEluZGV4XTtcbiAgICBjb25zdCBmcm9tSW50ZXJ2YWwgPSBzdGFydEluZGV4ICogUkNUU2luZ2xlRnJhbWVJbnRlcnZhbDtcbiAgICBjb25zdCB0b0ludGVydmFsID0gbmV4dEluZGV4ICogUkNUU2luZ2xlRnJhbWVJbnRlcnZhbDtcblxuICAgIC8vIEludGVycG9sYXRlIGJldHdlZW4gdGhlIGluZGl2aWR1YWwgZnJhbWVzIHRvIGVuc3VyZSB0aGUgYW5pbWF0aW9ucyBhcmVcbiAgICAvL3Ntb290aCBhbmQgb2YgdGhlIHByb3BlciBkdXJhdGlvbiByZWdhcmRsZXNzIG9mIHRoZSBmcmFtZXJhdGUuXG4gICAgY29uc3QgZnJhbWVPdXRwdXQgPSBSQ1RJbnRlcnBvbGF0ZVZhbHVlKFxuICAgICAgY3VycmVudER1cmF0aW9uLFxuICAgICAgZnJvbUludGVydmFsLFxuICAgICAgdG9JbnRlcnZhbCxcbiAgICAgIGZyb21GcmFtZVZhbHVlLFxuICAgICAgdG9GcmFtZVZhbHVlLFxuICAgICAgXCJleHRlbmRcIixcbiAgICAgIFwiZXh0ZW5kXCJcbiAgICApO1xuXG4gICAgdGhpcy51cGRhdGVPdXRwdXRXaXRoRnJhbWVPdXRwdXQoZnJhbWVPdXRwdXQpO1xuICB9XG5cbiAgdXBkYXRlT3V0cHV0V2l0aEZyYW1lT3V0cHV0KGZyYW1lT3V0cHV0OiBudW1iZXIpIHtcbiAgICBjb25zdCBvdXRwdXRWYWx1ZSA9IFJDVEludGVycG9sYXRlVmFsdWUoXG4gICAgICBmcmFtZU91dHB1dCxcbiAgICAgIDAsXG4gICAgICAxLFxuICAgICAgdGhpcy5mcm9tVmFsdWUsXG4gICAgICB0aGlzLnRvVmFsdWUsXG4gICAgICBcImV4dGVuZFwiLFxuICAgICAgXCJleHRlbmRcIlxuICAgICk7XG5cbiAgICBjb25zdCB2YWx1ZU5vZGUgPSB0aGlzLnZhbHVlTm9kZTtcbiAgICBpZiAodmFsdWVOb2RlKSB7XG4gICAgICB2YWx1ZU5vZGUudmFsdWUgPSBvdXRwdXRWYWx1ZTtcbiAgICAgIHZhbHVlTm9kZS5zZXROZWVkc1VwZGF0ZSgpO1xuICAgIH1cbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RGcmFtZUFuaW1hdGlvbjtcbiJdfQ==