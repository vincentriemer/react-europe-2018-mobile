{"version":3,"sources":["../../../ReactDom/modules/LayoutAnimation/RTCKeyframeGenerator.js"],"names":["timestepCoefficient","staticEasingFunctions","linear","x","easeIn","easeOut","easeInEaseOut","springTimestep","generateStaticKeyframes","ease","duration","delay","numSteps","timestep","keyframes","currentX","i","push","looper","SimulationLooper","springSystem","SpringSystem","generateSpringKeyframes","springDamping","initialVelocity","mass","tension","friction","Math","sqrt","springConfig","SpringConfig","fromOrigamiTensionAndFriction","spring","createSpringWithConfig","result","readStep","getCurrentValue","addListener","onSpringUpdate","_endValue","_currentState","velocity","activateSpring","getId","removeAllListeners","springDuration","length","generateKeyframes","config","type","resolvedDelay","easingFunction","resolvedDuration"],"mappings":"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","file":"RTCKeyframeGenerator.js","sourcesContent":["/**\n * @providesModule RCTKeyframeGenerator\n * @flow\n */\n\nimport BezierEasing from \"bezier-easing\";\nimport Rebound from \"rebound\";\nimport memoize from \"fast-memoize\";\n\nimport invariant from \"Invariant\";\n\nimport type { LayoutAnim } from \"RCTLayoutAnimationManager\";\n\nconst timestepCoefficient = 1;\n\nconst staticEasingFunctions = {\n  linear: (x) => x,\n  easeIn: BezierEasing(0.42, 0, 1, 1),\n  easeOut: BezierEasing(0, 0, 0.58, 1),\n  easeInEaseOut: BezierEasing(0.42, 0, 0.58, 1)\n};\n\nexport type KeyframeResult = {\n  keyframes: number[],\n  duration: number,\n  delay: number\n};\n\nconst springTimestep = 16.667 * timestepCoefficient;\n\nfunction generateStaticKeyframes(\n  ease: (x: number) => number,\n  duration: number,\n  delay: number\n): KeyframeResult {\n  const numSteps = duration / springTimestep;\n  const timestep = 1.0 / numSteps;\n\n  const keyframes = [];\n\n  let currentX = 0;\n  for (let i = 0; i < numSteps; i++) {\n    keyframes.push(ease(currentX));\n    currentX += timestep;\n  }\n\n  keyframes.push(1);\n\n  return { keyframes, duration, delay };\n}\n\nconst looper = new Rebound.SimulationLooper(springTimestep);\nconst springSystem = new Rebound.SpringSystem(looper);\n\nfunction generateSpringKeyframes(\n  springDamping: number,\n  initialVelocity: number = 0,\n  delay: number\n): KeyframeResult {\n  const mass = 1; /* Oragami Default */\n  const tension = 40; /* Oragami Default */\n  const friction = springDamping * (2 * Math.sqrt(mass * tension));\n\n  const springConfig = Rebound.SpringConfig.fromOrigamiTensionAndFriction(\n    tension,\n    friction\n  );\n  const spring = springSystem.createSpringWithConfig(springConfig);\n\n  let result = [];\n  function readStep(spring) {\n    result.push(spring.getCurrentValue());\n  }\n\n  spring.addListener({ onSpringUpdate: readStep });\n  spring._endValue = 1.0;\n  spring._currentState.velocity = initialVelocity;\n  springSystem.activateSpring(spring.getId());\n  spring.removeAllListeners();\n\n  const springDuration = result.length * springTimestep;\n\n  return { keyframes: result, duration: springDuration, delay };\n}\n\nconst generateKeyframes: (\n  config: LayoutAnim,\n  duration: number\n) => ?KeyframeResult = memoize((config: LayoutAnim = {}, duration: number) => {\n  const {\n    type = \"easeInEaseOut\",\n    springDamping,\n    initialVelocity,\n    delay\n  } = config;\n\n  const resolvedDelay = delay != null ? delay : 0;\n\n  if (type && type !== \"spring\") {\n    const easingFunction = staticEasingFunctions[type];\n    const resolvedDuration =\n      config.duration != null ? config.duration : duration;\n\n    if (resolvedDuration === 0) {\n      return null;\n    }\n\n    return generateStaticKeyframes(\n      easingFunction,\n      resolvedDuration,\n      resolvedDelay\n    );\n  }\n\n  if (type && type === \"spring\" && springDamping) {\n    return generateSpringKeyframes(\n      springDamping,\n      initialVelocity,\n      resolvedDelay\n    );\n  }\n\n  invariant(false, \"Invalid layoutAnimation configuration provided\");\n});\n\nexport default generateKeyframes;\n"]}