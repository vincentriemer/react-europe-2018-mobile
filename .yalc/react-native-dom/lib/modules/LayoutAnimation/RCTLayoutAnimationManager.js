Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray2=require("babel-runtime/helpers/slicedToArray");var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _defineProperty2=require("babel-runtime/helpers/defineProperty");var _defineProperty3=_interopRequireDefault(_defineProperty2);var _extends4=require("babel-runtime/helpers/extends");var _extends5=_interopRequireDefault(_extends4);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _Invariant=require("./../../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);var _RTCKeyframeGenerator=require("./RTCKeyframeGenerator");var _RTCKeyframeGenerator2=_interopRequireDefault(_RTCKeyframeGenerator);var _MatrixMath=require("./../../utils/MatrixMath.dom");var MatrixMath=_interopRequireWildcard(_MatrixMath);function _interopRequireWildcard(obj){if(obj&&obj.__esModule){return obj;}else{var newObj={};if(obj!=null){for(var key in obj){if(Object.prototype.hasOwnProperty.call(obj,key))newObj[key]=obj[key];}}newObj.default=obj;return newObj;}}function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var PropertiesEnum={opacity:true,scaleXY:true};var TypesEnum={spring:true,linear:true,easeInEaseOut:true,easeIn:true,easeOut:true};var RCTLayoutAnimationManager=function(){function RCTLayoutAnimationManager(manager){(0,_classCallCheck3.default)(this,RCTLayoutAnimationManager);this.manager=manager;this.reset();}(0,_createClass3.default)(RCTLayoutAnimationManager,[{key:"configureNext",value:function configureNext(config,callback){this.pendingConfig=config;this.pendingCallback=callback;}},{key:"reset",value:function reset(){this.removedNodes=[];this.layoutChanges=[];this.pendingConfig=undefined;this.pendingCallback=undefined;}},{key:"isPending",value:function isPending(){return this.pendingConfig!=null;}},{key:"addLayoutChanges",value:function addLayoutChanges(changes){this.layoutChanges=this.layoutChanges.concat(changes);}},{key:"queueRemovedNode",value:function queueRemovedNode(tag){this.removedNodes.push(tag);}},{key:"constructKeyframes",value:function constructKeyframes(config){var create=config.create,update=config.update,del=config.delete,duration=config.duration;var keyframes={create:(0,_RTCKeyframeGenerator2.default)(create,duration),update:(0,_RTCKeyframeGenerator2.default)(update,duration),delete:(0,_RTCKeyframeGenerator2.default)(del,duration)};return keyframes;}},{key:"createOpacityKeyframes",value:function createOpacityKeyframes(from,to,keyframes){return keyframes.map(function(keyframe){return{opacity:""+(to+(from-to)*(1-keyframe))};});}},{key:"createTransformAnimationKeyframes",value:function createTransformAnimationKeyframes(from,to,keyframes,propName,existingKeyframes){return existingKeyframes.map(function(prevKeyframe,index){var newValue=void 0;if(["scaleX","scaleY"].includes(propName)){newValue=from+(to-from)*keyframes[index];if(newValue<=0){newValue=0.0001;}}else{newValue=from+(to-from)*keyframes[index];}return(0,_extends5.default)({},prevKeyframe,(0,_defineProperty3.default)({},propName,newValue));});}},{key:"createInverseTransformAnimationKeyframes",value:function createInverseTransformAnimationKeyframes(propName,existingKeyframes,parentKeyframes){return existingKeyframes.map(function(prevKeyframe,index){var parentKeyframe=parentKeyframes[index];var parentValue=parentKeyframe[propName];var newValue=void 0;if(["scaleX","scaleY"].includes(propName)){newValue=1/parentValue;}else{newValue=-1*parentValue;}return(0,_extends5.default)({},prevKeyframe,(0,_defineProperty3.default)({},propName,newValue));});}},{key:"transformAnimationConfigFactory",value:function transformAnimationConfigFactory(keyLength,duration,layout){return[new Array(keyLength).fill({translateX:layout.left,translateY:layout.top,scaleX:1.0,scaleY:1.0,inverseScaleX:1.0,inverseScaleY:1.0}),{duration:duration,layout:layout,origin:{x:-1*layout.width/2,y:-1*layout.height/2}}];}},{key:"childContainerAnimationConfigFactory",value:function childContainerAnimationConfigFactory(keyLength){return new Array(keyLength).fill({scaleX:1.0,scaleY:1.0});}},{key:"applyInverseTransformOnChildren",value:function applyInverseTransformOnChildren(shadowView,registry,updateKeyConfig,newFrames,propName){var _this=this;var view=this.manager.viewRegistry.get(shadowView.reactTag);if(view&&view.reactSubviews.length!==0){view.reactSubviews.forEach(function(subView,index){var subReactTag=subView.reactTag;var subShadowView=_this.manager.shadowViewRegistry.get(subReactTag);(0,_Invariant2.default)(subShadowView,"Shadow View does not exist");var previousLayout=subShadowView.previousLayout;(0,_Invariant2.default)(previousLayout,"Shadow View has no previous layout");if(!registry.hasOwnProperty(subReactTag)){registry[subReactTag]=_this.transformAnimationConfigFactory(updateKeyConfig.keyframes.length,updateKeyConfig.duration,previousLayout);}registry[subReactTag][0]=_this.createInverseTransformAnimationKeyframes(propName,registry[subReactTag][0],newFrames);});}}},{key:"createTransformAnimations",value:function createTransformAnimations(keyframes,config){var _this2=this;var animations=[];var cleanup=[];var registry={};var createKeyConfig=keyframes.create,updateKeyConfig=keyframes.update,deleteKeyConfig=keyframes.delete;var addedNodes=this.layoutChanges.filter(function(lc){return!lc.previousMeasurement;}).map(function(lc){return lc.reactTag;});this.layoutChanges.forEach(function(layoutChange){var reactTag=layoutChange.reactTag,layout=layoutChange.layout,nextMeasurement=layoutChange.nextMeasurement,previousMeasurement=layoutChange.previousMeasurement;var view=_this2.manager.viewRegistry.get(reactTag);(0,_Invariant2.default)(view,"view does not exist");if(!previousMeasurement){if(createKeyConfig==null){view.frame=layout;view.opacity=1;return;}if(view.reactSuperview&&addedNodes.includes(view.reactSuperview.reactTag)){view.frame=layout;view.opacity=1;return;}var _keyframes=_this2.createOpacityKeyframes(0,1,createKeyConfig.keyframes);var _config={duration:createKeyConfig.duration,delay:createKeyConfig.delay,fill:"none"};view.style.willChange="opacity";view.frame=layout;animations.push(new KeyframeEffect(view,_keyframes,_config));cleanup.push(function(){view.style.willChange="";});}else{if(updateKeyConfig==null){view.frame=layout;return;}var shadowView=_this2.manager.shadowViewRegistry.get(reactTag);(0,_Invariant2.default)(shadowView,"shadowView does not exist");if(!registry.hasOwnProperty(reactTag)){registry[reactTag]=_this2.transformAnimationConfigFactory(updateKeyConfig.keyframes.length,updateKeyConfig.duration,layout);}var _view$frame=view.frame,prevTop=_view$frame.top,prevLeft=_view$frame.left,prevWidth=_view$frame.width,prevHeight=_view$frame.height;var nextTop=layout.top,nextLeft=layout.left,nextWidth=layout.width,nextHeight=layout.height;if(prevTop!==nextTop){var prevTranslateY=prevTop;var nextTranslateY=nextTop;var newFrames=_this2.createTransformAnimationKeyframes(prevTranslateY,nextTranslateY,updateKeyConfig.keyframes,"translateY",registry[reactTag][0]);registry[reactTag][0]=newFrames;}if(prevLeft!==nextLeft){var prevTranslateX=prevLeft;var nextTranslateX=nextLeft;var _newFrames=_this2.createTransformAnimationKeyframes(prevTranslateX,nextTranslateX,updateKeyConfig.keyframes,"translateX",registry[reactTag][0]);registry[reactTag][0]=_newFrames;}var childContainerTransform=_this2.childContainerAnimationConfigFactory(updateKeyConfig.keyframes.length);var shouldTransformChildren=false;if(prevWidth!==nextWidth&&nextWidth!==0){var prevScaleX=prevWidth/nextWidth;var nextScaleX=1.0;var _newFrames2=_this2.createTransformAnimationKeyframes(prevScaleX,nextScaleX,updateKeyConfig.keyframes,"scaleX",registry[reactTag][0]);registry[reactTag][0]=_newFrames2;if(view.childContainer){shouldTransformChildren=true;childContainerTransform=_this2.createInverseTransformAnimationKeyframes("scaleX",childContainerTransform,_newFrames2);}}if(prevHeight!==nextHeight&&nextHeight!==0){var nextScaleY=1.0;var prevScaleY=prevHeight/nextHeight;var _newFrames3=_this2.createTransformAnimationKeyframes(prevScaleY,nextScaleY,updateKeyConfig.keyframes,"scaleY",registry[reactTag][0]);registry[reactTag][0]=_newFrames3;if(view.childContainer){shouldTransformChildren=true;childContainerTransform=_this2.createInverseTransformAnimationKeyframes("scaleY",childContainerTransform,_newFrames3);}}if(shouldTransformChildren){var childContainer=view.childContainer;if(childContainer){var _keyframes2=childContainerTransform.map(function(_ref){var scaleX=_ref.scaleX,scaleY=_ref.scaleY;return{transform:"scale("+scaleX+","+scaleY+")"};});var _config2={duration:updateKeyConfig.duration,fill:"none"};childContainer.style.willChange="transform";animations.push(new KeyframeEffect(childContainer,_keyframes2,_config2));cleanup.push(function(){childContainer.style.willChange="";});}}}});Object.keys(registry).forEach(function(tag){var reactTag=parseInt(tag,10);var _registry$reactTag=(0,_slicedToArray3.default)(registry[reactTag],2),keyframeConfigs=_registry$reactTag[0],_registry$reactTag$=_registry$reactTag[1],duration=_registry$reactTag$.duration,layout=_registry$reactTag$.layout,origin=_registry$reactTag$.origin;var view=_this2.manager.viewRegistry.get(reactTag);(0,_Invariant2.default)(view,"view does not exist");var keyframes=_this2.constructTransformKeyframes(keyframeConfigs,origin);var layoutStyle={width:layout.width+"px",height:layout.height+"px"};var config={duration:duration,fill:"none"};var prevWillChange=view.style.willChange;view.style.willChange="transform";view.frame=layout;animations.push(new KeyframeEffect(view,keyframes,config));cleanup.push(function(){view.style.willChange=prevWillChange;});});this.removedNodes.forEach(function(reactTag){var view=_this2.manager.viewRegistry.get(reactTag);(0,_Invariant2.default)(view,"view does not exist");var cleanUpRemovedNode=function cleanUpRemovedNode(){};if(deleteKeyConfig==null){if(view.reactSuperview){view.reactSuperview.removeReactSubview(view);}_this2.manager.viewRegistry.delete(reactTag);view.purge();return;}if(view.reactSuperview&&_this2.removedNodes.includes(view.reactSuperview.reactTag)){if(view.reactSuperview){view.reactSuperview.removeReactSubview(view);}_this2.manager.viewRegistry.delete(reactTag);return;}var keyframes=_this2.createOpacityKeyframes(1,0,deleteKeyConfig.keyframes);var config={duration:deleteKeyConfig.duration,delay:deleteKeyConfig.delay,fill:"forwards"};view.style.willChange="opacity";animations.push(new KeyframeEffect(view,keyframes,config));cleanup.push(function(){if(view.reactSuperview){view.reactSuperview.removeReactSubview(view);}_this2.manager.viewRegistry.delete(reactTag);view.purge();});});return[animations,cleanup];}},{key:"constructTransformKeyframes",value:function constructTransformKeyframes(keyframeConfigs,origin){return keyframeConfigs.map(function(config){var translateX=config.translateX,translateY=config.translateY,scaleX=config.scaleX,scaleY=config.scaleY;var transformMatrix=MatrixMath.createTranslate2d(origin.x,origin.y);MatrixMath.multiplyInto(transformMatrix,transformMatrix,MatrixMath.createTranslate2d(translateX,translateY));var scaleMatrix=MatrixMath.createIdentityMatrix();MatrixMath.reuseScale3dCommand(scaleMatrix,scaleX,scaleY,1.0);MatrixMath.multiplyInto(transformMatrix,transformMatrix,scaleMatrix);MatrixMath.multiplyInto(transformMatrix,transformMatrix,MatrixMath.createTranslate2d(-origin.x,-origin.y));return{transform:"matrix3d("+transformMatrix.join(", ")+")"};});}},{key:"applyLayoutChanges",value:function applyLayoutChanges(){var pendingConfig=this.pendingConfig;var layoutChanges=this.layoutChanges;var callback=this.pendingCallback;(0,_Invariant2.default)(pendingConfig&&layoutChanges&&callback,"Attempting to apply a layoutanimation without a pending config.");var keyframes=this.constructKeyframes(pendingConfig);var _createTransformAnima=this.createTransformAnimations(keyframes,pendingConfig),_createTransformAnima2=(0,_slicedToArray3.default)(_createTransformAnima,2),animations=_createTransformAnima2[0],cleanup=_createTransformAnima2[1];var groupEffect=new GroupEffect(animations);var animation=document.timeline.play(groupEffect);animation.finished.then(function(){cleanup.forEach(function(c){return c();});callback();});this.reset();}}]);return RCTLayoutAnimationManager;}();exports.default=RCTLayoutAnimationManager;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uLy4uL1JlYWN0RG9tL21vZHVsZXMvTGF5b3V0QW5pbWF0aW9uL1JDVExheW91dEFuaW1hdGlvbk1hbmFnZXIuanMiXSwibmFtZXMiOlsiTWF0cml4TWF0aCIsIlByb3BlcnRpZXNFbnVtIiwib3BhY2l0eSIsInNjYWxlWFkiLCJUeXBlc0VudW0iLCJzcHJpbmciLCJsaW5lYXIiLCJlYXNlSW5FYXNlT3V0IiwiZWFzZUluIiwiZWFzZU91dCIsIlJDVExheW91dEFuaW1hdGlvbk1hbmFnZXIiLCJtYW5hZ2VyIiwicmVzZXQiLCJjb25maWciLCJjYWxsYmFjayIsInBlbmRpbmdDb25maWciLCJwZW5kaW5nQ2FsbGJhY2siLCJyZW1vdmVkTm9kZXMiLCJsYXlvdXRDaGFuZ2VzIiwidW5kZWZpbmVkIiwiY2hhbmdlcyIsImNvbmNhdCIsInRhZyIsInB1c2giLCJjcmVhdGUiLCJ1cGRhdGUiLCJkZWwiLCJkZWxldGUiLCJkdXJhdGlvbiIsImtleWZyYW1lcyIsImZyb20iLCJ0byIsIm1hcCIsImtleWZyYW1lIiwicHJvcE5hbWUiLCJleGlzdGluZ0tleWZyYW1lcyIsInByZXZLZXlmcmFtZSIsImluZGV4IiwibmV3VmFsdWUiLCJpbmNsdWRlcyIsInBhcmVudEtleWZyYW1lcyIsInBhcmVudEtleWZyYW1lIiwicGFyZW50VmFsdWUiLCJrZXlMZW5ndGgiLCJsYXlvdXQiLCJBcnJheSIsImZpbGwiLCJ0cmFuc2xhdGVYIiwibGVmdCIsInRyYW5zbGF0ZVkiLCJ0b3AiLCJzY2FsZVgiLCJzY2FsZVkiLCJpbnZlcnNlU2NhbGVYIiwiaW52ZXJzZVNjYWxlWSIsIm9yaWdpbiIsIngiLCJ3aWR0aCIsInkiLCJoZWlnaHQiLCJzaGFkb3dWaWV3IiwicmVnaXN0cnkiLCJ1cGRhdGVLZXlDb25maWciLCJuZXdGcmFtZXMiLCJ2aWV3Iiwidmlld1JlZ2lzdHJ5IiwiZ2V0IiwicmVhY3RUYWciLCJyZWFjdFN1YnZpZXdzIiwibGVuZ3RoIiwiZm9yRWFjaCIsInN1YlZpZXciLCJzdWJSZWFjdFRhZyIsInN1YlNoYWRvd1ZpZXciLCJzaGFkb3dWaWV3UmVnaXN0cnkiLCJwcmV2aW91c0xheW91dCIsImhhc093blByb3BlcnR5IiwidHJhbnNmb3JtQW5pbWF0aW9uQ29uZmlnRmFjdG9yeSIsImNyZWF0ZUludmVyc2VUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMiLCJhbmltYXRpb25zIiwiY2xlYW51cCIsImNyZWF0ZUtleUNvbmZpZyIsImRlbGV0ZUtleUNvbmZpZyIsImFkZGVkTm9kZXMiLCJmaWx0ZXIiLCJsYyIsInByZXZpb3VzTWVhc3VyZW1lbnQiLCJsYXlvdXRDaGFuZ2UiLCJuZXh0TWVhc3VyZW1lbnQiLCJmcmFtZSIsInJlYWN0U3VwZXJ2aWV3IiwiY3JlYXRlT3BhY2l0eUtleWZyYW1lcyIsImRlbGF5Iiwic3R5bGUiLCJ3aWxsQ2hhbmdlIiwiS2V5ZnJhbWVFZmZlY3QiLCJwcmV2VG9wIiwicHJldkxlZnQiLCJwcmV2V2lkdGgiLCJwcmV2SGVpZ2h0IiwibmV4dFRvcCIsIm5leHRMZWZ0IiwibmV4dFdpZHRoIiwibmV4dEhlaWdodCIsInByZXZUcmFuc2xhdGVZIiwibmV4dFRyYW5zbGF0ZVkiLCJjcmVhdGVUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMiLCJwcmV2VHJhbnNsYXRlWCIsIm5leHRUcmFuc2xhdGVYIiwiY2hpbGRDb250YWluZXJUcmFuc2Zvcm0iLCJjaGlsZENvbnRhaW5lckFuaW1hdGlvbkNvbmZpZ0ZhY3RvcnkiLCJzaG91bGRUcmFuc2Zvcm1DaGlsZHJlbiIsInByZXZTY2FsZVgiLCJuZXh0U2NhbGVYIiwiY2hpbGRDb250YWluZXIiLCJuZXh0U2NhbGVZIiwicHJldlNjYWxlWSIsInRyYW5zZm9ybSIsIk9iamVjdCIsImtleXMiLCJwYXJzZUludCIsImtleWZyYW1lQ29uZmlncyIsImNvbnN0cnVjdFRyYW5zZm9ybUtleWZyYW1lcyIsImxheW91dFN0eWxlIiwicHJldldpbGxDaGFuZ2UiLCJjbGVhblVwUmVtb3ZlZE5vZGUiLCJyZW1vdmVSZWFjdFN1YnZpZXciLCJwdXJnZSIsInRyYW5zZm9ybU1hdHJpeCIsImNyZWF0ZVRyYW5zbGF0ZTJkIiwibXVsdGlwbHlJbnRvIiwic2NhbGVNYXRyaXgiLCJjcmVhdGVJZGVudGl0eU1hdHJpeCIsInJldXNlU2NhbGUzZENvbW1hbmQiLCJqb2luIiwiY29uc3RydWN0S2V5ZnJhbWVzIiwiY3JlYXRlVHJhbnNmb3JtQW5pbWF0aW9ucyIsImdyb3VwRWZmZWN0IiwiR3JvdXBFZmZlY3QiLCJhbmltYXRpb24iLCJkb2N1bWVudCIsInRpbWVsaW5lIiwicGxheSIsImZpbmlzaGVkIiwidGhlbiIsImMiXSwibWFwcGluZ3MiOiI0cEJBT0Esa0QsbURBQ0EsNEQseUVBQ0Esd0QsR0FBWUEsVyxtV0FLWixHQUFNQyxnQkFBaUIsQ0FDckJDLFFBQVMsSUFEWSxDQUVyQkMsUUFBUyxJQUZZLENBQXZCLENBS0EsR0FBTUMsV0FBWSxDQUNoQkMsT0FBUSxJQURRLENBRWhCQyxPQUFRLElBRlEsQ0FHaEJDLGNBQWUsSUFIQyxDQUloQkMsT0FBUSxJQUpRLENBS2hCQyxRQUFTLElBTE8sQ0FBbEIsQyxHQXFETUMsMEIsWUFRSixtQ0FBWUMsT0FBWixDQUFtQyw4REFDakMsS0FBS0EsT0FBTCxDQUFlQSxPQUFmLENBQ0EsS0FBS0MsS0FBTCxHQUNELEMsdUdBRWFDLE0sQ0FBK0JDLFEsQ0FBb0IsQ0FDL0QsS0FBS0MsYUFBTCxDQUFxQkYsTUFBckIsQ0FDQSxLQUFLRyxlQUFMLENBQXVCRixRQUF2QixDQUNELEMscUNBRU8sQ0FDTixLQUFLRyxZQUFMLENBQW9CLEVBQXBCLENBQ0EsS0FBS0MsYUFBTCxDQUFxQixFQUFyQixDQUNBLEtBQUtILGFBQUwsQ0FBcUJJLFNBQXJCLENBQ0EsS0FBS0gsZUFBTCxDQUF1QkcsU0FBdkIsQ0FDRCxDLDZDQUVvQixDQUNuQixNQUFPLE1BQUtKLGFBQUwsRUFBc0IsSUFBN0IsQ0FDRCxDLDBEQUVnQkssTyxDQUF5QixDQUN4QyxLQUFLRixhQUFMLENBQXFCLEtBQUtBLGFBQUwsQ0FBbUJHLE1BQW5CLENBQTBCRCxPQUExQixDQUFyQixDQUNELEMsMERBRWdCRSxHLENBQWEsQ0FDNUIsS0FBS0wsWUFBTCxDQUFrQk0sSUFBbEIsQ0FBdUJELEdBQXZCLEVBQ0QsQyw4REFFa0JULE0sQ0FBK0IsSUFDeENXLE9BRHdDLENBQ0VYLE1BREYsQ0FDeENXLE1BRHdDLENBQ2hDQyxNQURnQyxDQUNFWixNQURGLENBQ2hDWSxNQURnQyxDQUNoQkMsR0FEZ0IsQ0FDRWIsTUFERixDQUN4QmMsTUFEd0IsQ0FDWEMsUUFEVyxDQUNFZixNQURGLENBQ1hlLFFBRFcsQ0FHaEQsR0FBTUMsV0FBWSxDQUNoQkwsT0FBUSxtQ0FBcUJBLE1BQXJCLENBQTZCSSxRQUE3QixDQURRLENBRWhCSCxPQUFRLG1DQUFxQkEsTUFBckIsQ0FBNkJHLFFBQTdCLENBRlEsQ0FHaEJELE9BQVEsbUNBQXFCRCxHQUFyQixDQUEwQkUsUUFBMUIsQ0FIUSxDQUFsQixDQU1BLE1BQU9DLFVBQVAsQ0FDRCxDLHNFQUVzQkMsSSxDQUFjQyxFLENBQVlGLFMsQ0FBcUIsQ0FDcEUsTUFBT0EsV0FBVUcsR0FBVixDQUFjLFNBQUNDLFFBQUQsUUFBZSxDQUNsQy9CLFlBQVk2QixHQUFLLENBQUNELEtBQU9DLEVBQVIsR0FBZSxFQUFJRSxRQUFuQixDQUFqQixDQURrQyxDQUFmLEVBQWQsQ0FBUCxDQUdELEMsNEZBR0NILEksQ0FDQUMsRSxDQUNBRixTLENBQ0FLLFEsQ0FDQUMsaUIsQ0FDQSxDQUNBLE1BQU9BLG1CQUFrQkgsR0FBbEIsQ0FBc0IsU0FBQ0ksWUFBRCxDQUFlQyxLQUFmLENBQXlCLENBQ3BELEdBQUlDLGdCQUFKLENBRUEsR0FBSSxDQUFDLFFBQUQsQ0FBVyxRQUFYLEVBQXFCQyxRQUFyQixDQUE4QkwsUUFBOUIsQ0FBSixDQUE2QyxDQUMzQ0ksU0FBV1IsS0FBTyxDQUFDQyxHQUFLRCxJQUFOLEVBQWNELFVBQVVRLEtBQVYsQ0FBaEMsQ0FFQSxHQUFJQyxVQUFZLENBQWhCLENBQW1CLENBQ2pCQSxTQUFXLE1BQVgsQ0FDRCxDQUNGLENBTkQsSUFNTyxDQUNMQSxTQUFXUixLQUFPLENBQUNDLEdBQUtELElBQU4sRUFBY0QsVUFBVVEsS0FBVixDQUFoQyxDQUNELENBRUQsK0JBQ0tELFlBREwsaUNBRUdGLFFBRkgsQ0FFY0ksUUFGZCxHQUlELENBakJNLENBQVAsQ0FrQkQsQywwR0FHQ0osUSxDQUNBQyxpQixDQUNBSyxlLENBQ0EsQ0FDQSxNQUFPTCxtQkFBa0JILEdBQWxCLENBQXNCLFNBQUNJLFlBQUQsQ0FBZUMsS0FBZixDQUF5QixDQUNwRCxHQUFNSSxnQkFBaUJELGdCQUFnQkgsS0FBaEIsQ0FBdkIsQ0FDQSxHQUFJSyxhQUFjRCxlQUFlUCxRQUFmLENBQWxCLENBRUEsR0FBSUksZ0JBQUosQ0FDQSxHQUFJLENBQUMsUUFBRCxDQUFXLFFBQVgsRUFBcUJDLFFBQXJCLENBQThCTCxRQUE5QixDQUFKLENBQTZDLENBQzNDSSxTQUFXLEVBQUlJLFdBQWYsQ0FDRCxDQUZELElBRU8sQ0FDTEosU0FBVyxDQUFDLENBQUQsQ0FBS0ksV0FBaEIsQ0FDRCxDQUVELCtCQUNLTixZQURMLGlDQUVHRixRQUZILENBRWNJLFFBRmQsR0FJRCxDQWZNLENBQVAsQ0FnQkQsQyx3RkFHQ0ssUyxDQUNBZixRLENBQ0FnQixNLENBQzBCLENBQzFCLE1BQU8sQ0FDTCxHQUFJQyxNQUFKLENBQVVGLFNBQVYsRUFBcUJHLElBQXJCLENBQTBCLENBQ3hCQyxXQUFZSCxPQUFPSSxJQURLLENBRXhCQyxXQUFZTCxPQUFPTSxHQUZLLENBR3hCQyxPQUFRLEdBSGdCLENBSXhCQyxPQUFRLEdBSmdCLENBS3hCQyxjQUFlLEdBTFMsQ0FNeEJDLGNBQWUsR0FOUyxDQUExQixDQURLLENBU0wsQ0FDRTFCLFNBQVVBLFFBRFosQ0FFRWdCLGFBRkYsQ0FHRVcsT0FBUSxDQUNOQyxFQUFHLENBQUMsQ0FBRCxDQUFLWixPQUFPYSxLQUFaLENBQW9CLENBRGpCLENBRU5DLEVBQUcsQ0FBQyxDQUFELENBQUtkLE9BQU9lLE1BQVosQ0FBcUIsQ0FGbEIsQ0FIVixDQVRLLENBQVAsQ0FrQkQsQyxrR0FFb0NoQixTLENBQW1CLENBQ3RELE1BQU8sSUFBSUUsTUFBSixDQUFVRixTQUFWLEVBQXFCRyxJQUFyQixDQUEwQixDQUMvQkssT0FBUSxHQUR1QixDQUUvQkMsT0FBUSxHQUZ1QixDQUExQixDQUFQLENBSUQsQyx3RkFHQ1EsVSxDQUNBQyxRLENBQ0FDLGUsQ0FDQUMsUyxDQUNBN0IsUSxDQUNBLGdCQUNBLEdBQU04QixNQUFPLEtBQUtyRCxPQUFMLENBQWFzRCxZQUFiLENBQTBCQyxHQUExQixDQUE4Qk4sV0FBV08sUUFBekMsQ0FBYixDQUVBLEdBQUlILE1BQVFBLEtBQUtJLGFBQUwsQ0FBbUJDLE1BQW5CLEdBQThCLENBQTFDLENBQTZDLENBQzNDTCxLQUFLSSxhQUFMLENBQW1CRSxPQUFuQixDQUEyQixTQUFDQyxPQUFELENBQVVsQyxLQUFWLENBQW9CLENBQzdDLEdBQU1tQyxhQUFjRCxRQUFRSixRQUE1QixDQUVBLEdBQU1NLGVBQWdCLE1BQUs5RCxPQUFMLENBQWErRCxrQkFBYixDQUFnQ1IsR0FBaEMsQ0FBb0NNLFdBQXBDLENBQXRCLENBQ0Esd0JBQVVDLGFBQVYsQ0FBeUIsNEJBQXpCLEVBRUEsR0FBTUUsZ0JBQWlCRixjQUFjRSxjQUFyQyxDQUNBLHdCQUFVQSxjQUFWLENBQTBCLG9DQUExQixFQUVBLEdBQUksQ0FBQ2QsU0FBU2UsY0FBVCxDQUF3QkosV0FBeEIsQ0FBTCxDQUEyQyxDQUN6Q1gsU0FBU1csV0FBVCxFQUF3QixNQUFLSywrQkFBTCxDQUN0QmYsZ0JBQWdCakMsU0FBaEIsQ0FBMEJ3QyxNQURKLENBRXRCUCxnQkFBZ0JsQyxRQUZNLENBR3RCK0MsY0FIc0IsQ0FBeEIsQ0FLRCxDQUVEZCxTQUNFVyxXQURGLEVBRUUsQ0FGRixFQUVPLE1BQUtNLHdDQUFMLENBQ0w1QyxRQURLLENBRUwyQixTQUFTVyxXQUFULEVBQXNCLENBQXRCLENBRkssQ0FHTFQsU0FISyxDQUZQLENBT0QsQ0F4QkQsRUF5QkQsQ0FDRixDLDRFQUdDbEMsUyxDQUNBaEIsTSxDQUNBLGlCQUNBLEdBQU1rRSxZQUFhLEVBQW5CLENBQ0EsR0FBTUMsU0FBVSxFQUFoQixDQUNBLEdBQU1uQixVQUE2QyxFQUFuRCxDQUhBLEdBTVVvQixnQkFOVixDQVNJcEQsU0FUSixDQU1FTCxNQU5GLENBT1VzQyxlQVBWLENBU0lqQyxTQVRKLENBT0VKLE1BUEYsQ0FRVXlELGVBUlYsQ0FTSXJELFNBVEosQ0FRRUYsTUFSRixDQVdBLEdBQU13RCxZQUFhLEtBQUtqRSxhQUFMLENBQ2hCa0UsTUFEZ0IsQ0FDVCxTQUFDQyxFQUFELFFBQVEsQ0FBQ0EsR0FBR0MsbUJBQVosRUFEUyxFQUVoQnRELEdBRmdCLENBRVosU0FBQ3FELEVBQUQsUUFBUUEsSUFBR2xCLFFBQVgsRUFGWSxDQUFuQixDQUlBLEtBQUtqRCxhQUFMLENBQW1Cb0QsT0FBbkIsQ0FBMkIsU0FBQ2lCLFlBQUQsQ0FBa0IsSUFFekNwQixTQUZ5QyxDQU12Q29CLFlBTnVDLENBRXpDcEIsUUFGeUMsQ0FHekN2QixNQUh5QyxDQU12QzJDLFlBTnVDLENBR3pDM0MsTUFIeUMsQ0FJekM0QyxlQUp5QyxDQU12Q0QsWUFOdUMsQ0FJekNDLGVBSnlDLENBS3pDRixtQkFMeUMsQ0FNdkNDLFlBTnVDLENBS3pDRCxtQkFMeUMsQ0FRM0MsR0FBTXRCLE1BQU8sT0FBS3JELE9BQUwsQ0FBYXNELFlBQWIsQ0FBMEJDLEdBQTFCLENBQThCQyxRQUE5QixDQUFiLENBQ0Esd0JBQVVILElBQVYsQ0FBZ0IscUJBQWhCLEVBR0EsR0FBSSxDQUFDc0IsbUJBQUwsQ0FBMEIsQ0FFeEIsR0FBSUwsaUJBQW1CLElBQXZCLENBQTZCLENBQzNCakIsS0FBS3lCLEtBQUwsQ0FBYTdDLE1BQWIsQ0FDQW9CLEtBQUs5RCxPQUFMLENBQWUsQ0FBZixDQUNBLE9BQ0QsQ0FHRCxHQUNFOEQsS0FBSzBCLGNBQUwsRUFDQVAsV0FBVzVDLFFBQVgsQ0FBb0J5QixLQUFLMEIsY0FBTCxDQUFvQnZCLFFBQXhDLENBRkYsQ0FHRSxDQUNBSCxLQUFLeUIsS0FBTCxDQUFhN0MsTUFBYixDQUNBb0IsS0FBSzlELE9BQUwsQ0FBZSxDQUFmLENBQ0EsT0FDRCxDQUVELEdBQU0yQixZQUFZLE9BQUs4RCxzQkFBTCxDQUNoQixDQURnQixDQUVoQixDQUZnQixDQUdoQlYsZ0JBQWdCcEQsU0FIQSxDQUFsQixDQU1BLEdBQU1oQixTQUFTLENBQ2JlLFNBQVVxRCxnQkFBZ0JyRCxRQURiLENBRWJnRSxNQUFPWCxnQkFBZ0JXLEtBRlYsQ0FHYjlDLEtBQU0sTUFITyxDQUFmLENBTUFrQixLQUFLNkIsS0FBTCxDQUFXQyxVQUFYLENBQXdCLFNBQXhCLENBQ0E5QixLQUFLeUIsS0FBTCxDQUFhN0MsTUFBYixDQUVBbUMsV0FBV3hELElBQVgsQ0FBZ0IsR0FBSXdFLGVBQUosQ0FBbUIvQixJQUFuQixDQUF5Qm5DLFVBQXpCLENBQW9DaEIsT0FBcEMsQ0FBaEIsRUFDQW1FLFFBQVF6RCxJQUFSLENBQWEsVUFBTSxDQUNqQnlDLEtBQUs2QixLQUFMLENBQVdDLFVBQVgsQ0FBd0IsRUFBeEIsQ0FDRCxDQUZELEVBR0QsQ0FyQ0QsSUFxQ08sQ0FFTCxHQUFJaEMsaUJBQW1CLElBQXZCLENBQTZCLENBQzNCRSxLQUFLeUIsS0FBTCxDQUFhN0MsTUFBYixDQUNBLE9BQ0QsQ0FFRCxHQUFNZ0IsWUFBYSxPQUFLakQsT0FBTCxDQUFhK0Qsa0JBQWIsQ0FBZ0NSLEdBQWhDLENBQW9DQyxRQUFwQyxDQUFuQixDQUNBLHdCQUFVUCxVQUFWLENBQXNCLDJCQUF0QixFQUVBLEdBQUksQ0FBQ0MsU0FBU2UsY0FBVCxDQUF3QlQsUUFBeEIsQ0FBTCxDQUF3QyxDQUN0Q04sU0FBU00sUUFBVCxFQUFxQixPQUFLVSwrQkFBTCxDQUNuQmYsZ0JBQWdCakMsU0FBaEIsQ0FBMEJ3QyxNQURQLENBRW5CUCxnQkFBZ0JsQyxRQUZHLENBR25CZ0IsTUFIbUIsQ0FBckIsQ0FLRCxDQWhCSSxnQkF1QkRvQixLQUFLeUIsS0F2QkosQ0FtQkVPLE9BbkJGLGFBbUJIOUMsR0FuQkcsQ0FvQkcrQyxRQXBCSCxhQW9CSGpELElBcEJHLENBcUJJa0QsU0FyQkosYUFxQkh6QyxLQXJCRyxDQXNCSzBDLFVBdEJMLGFBc0JIeEMsTUF0QkcsSUEwQkV5QyxRQTFCRixDQThCRHhELE1BOUJDLENBMEJITSxHQTFCRyxDQTJCR21ELFFBM0JILENBOEJEekQsTUE5QkMsQ0EyQkhJLElBM0JHLENBNEJJc0QsU0E1QkosQ0E4QkQxRCxNQTlCQyxDQTRCSGEsS0E1QkcsQ0E2Qks4QyxVQTdCTCxDQThCRDNELE1BOUJDLENBNkJIZSxNQTdCRyxDQWdDTCxHQUFJcUMsVUFBWUksT0FBaEIsQ0FBeUIsQ0FDdkIsR0FBTUksZ0JBQWlCUixPQUF2QixDQUNBLEdBQU1TLGdCQUFpQkwsT0FBdkIsQ0FFQSxHQUFNckMsV0FBWSxPQUFLMkMsaUNBQUwsQ0FDaEJGLGNBRGdCLENBRWhCQyxjQUZnQixDQUdoQjNDLGdCQUFnQmpDLFNBSEEsQ0FJaEIsWUFKZ0IsQ0FLaEJnQyxTQUFTTSxRQUFULEVBQW1CLENBQW5CLENBTGdCLENBQWxCLENBUUFOLFNBQVNNLFFBQVQsRUFBbUIsQ0FBbkIsRUFBd0JKLFNBQXhCLENBQ0QsQ0FFRCxHQUFJa0MsV0FBYUksUUFBakIsQ0FBMkIsQ0FDekIsR0FBTU0sZ0JBQWlCVixRQUF2QixDQUNBLEdBQU1XLGdCQUFpQlAsUUFBdkIsQ0FFQSxHQUFNdEMsWUFBWSxPQUFLMkMsaUNBQUwsQ0FDaEJDLGNBRGdCLENBRWhCQyxjQUZnQixDQUdoQjlDLGdCQUFnQmpDLFNBSEEsQ0FJaEIsWUFKZ0IsQ0FLaEJnQyxTQUFTTSxRQUFULEVBQW1CLENBQW5CLENBTGdCLENBQWxCLENBUUFOLFNBQVNNLFFBQVQsRUFBbUIsQ0FBbkIsRUFBd0JKLFVBQXhCLENBQ0QsQ0FFRCxHQUFJOEMseUJBQTBCLE9BQUtDLG9DQUFMLENBQzVCaEQsZ0JBQWdCakMsU0FBaEIsQ0FBMEJ3QyxNQURFLENBQTlCLENBR0EsR0FBSTBDLHlCQUEwQixLQUE5QixDQUVBLEdBQUliLFlBQWNJLFNBQWQsRUFBMkJBLFlBQWMsQ0FBN0MsQ0FBZ0QsQ0FDOUMsR0FBTVUsWUFBYWQsVUFBWUksU0FBL0IsQ0FDQSxHQUFNVyxZQUFhLEdBQW5CLENBRUEsR0FBTWxELGFBQVksT0FBSzJDLGlDQUFMLENBQ2hCTSxVQURnQixDQUVoQkMsVUFGZ0IsQ0FHaEJuRCxnQkFBZ0JqQyxTQUhBLENBSWhCLFFBSmdCLENBS2hCZ0MsU0FBU00sUUFBVCxFQUFtQixDQUFuQixDQUxnQixDQUFsQixDQVFBTixTQUFTTSxRQUFULEVBQW1CLENBQW5CLEVBQXdCSixXQUF4QixDQUVBLEdBQUlDLEtBQUtrRCxjQUFULENBQXlCLENBQ3ZCSCx3QkFBMEIsSUFBMUIsQ0FDQUYsd0JBQTBCLE9BQUsvQix3Q0FBTCxDQUN4QixRQUR3QixDQUV4QitCLHVCQUZ3QixDQUd4QjlDLFdBSHdCLENBQTFCLENBS0QsQ0FDRixDQUVELEdBQUlvQyxhQUFlSSxVQUFmLEVBQTZCQSxhQUFlLENBQWhELENBQW1ELENBQ2pELEdBQU1ZLFlBQWEsR0FBbkIsQ0FDQSxHQUFNQyxZQUFhakIsV0FBYUksVUFBaEMsQ0FFQSxHQUFNeEMsYUFBWSxPQUFLMkMsaUNBQUwsQ0FDaEJVLFVBRGdCLENBRWhCRCxVQUZnQixDQUdoQnJELGdCQUFnQmpDLFNBSEEsQ0FJaEIsUUFKZ0IsQ0FLaEJnQyxTQUFTTSxRQUFULEVBQW1CLENBQW5CLENBTGdCLENBQWxCLENBUUFOLFNBQVNNLFFBQVQsRUFBbUIsQ0FBbkIsRUFBd0JKLFdBQXhCLENBRUEsR0FBSUMsS0FBS2tELGNBQVQsQ0FBeUIsQ0FDdkJILHdCQUEwQixJQUExQixDQUNBRix3QkFBMEIsT0FBSy9CLHdDQUFMLENBQ3hCLFFBRHdCLENBRXhCK0IsdUJBRndCLENBR3hCOUMsV0FId0IsQ0FBMUIsQ0FLRCxDQUNGLENBRUQsR0FBSWdELHVCQUFKLENBQTZCLENBQzNCLEdBQU1HLGdCQUFpQmxELEtBQUtrRCxjQUE1QixDQUNBLEdBQUlBLGNBQUosQ0FBb0IsQ0FDbEIsR0FBTXJGLGFBQVlnRix3QkFBd0I3RSxHQUF4QixDQUNoQixrQkFBR21CLE9BQUgsTUFBR0EsTUFBSCxDQUFXQyxNQUFYLE1BQVdBLE1BQVgsT0FBeUIsQ0FDdkJpRSxtQkFBb0JsRSxNQUFwQixLQUE4QkMsTUFBOUIsSUFEdUIsQ0FBekIsRUFEZ0IsQ0FBbEIsQ0FLQSxHQUFNdkMsVUFBUyxDQUFFZSxTQUFVa0MsZ0JBQWdCbEMsUUFBNUIsQ0FBc0NrQixLQUFNLE1BQTVDLENBQWYsQ0FFQW9FLGVBQWVyQixLQUFmLENBQXFCQyxVQUFyQixDQUFrQyxXQUFsQyxDQUNBZixXQUFXeEQsSUFBWCxDQUNFLEdBQUl3RSxlQUFKLENBQW1CbUIsY0FBbkIsQ0FBbUNyRixXQUFuQyxDQUE4Q2hCLFFBQTlDLENBREYsRUFHQW1FLFFBQVF6RCxJQUFSLENBQWEsVUFBTSxDQUNqQjJGLGVBQWVyQixLQUFmLENBQXFCQyxVQUFyQixDQUFrQyxFQUFsQyxDQUNELENBRkQsRUFHRCxDQUNGLENBQ0YsQ0FDRixDQXhMRCxFQTBMQXdCLE9BQU9DLElBQVAsQ0FBWTFELFFBQVosRUFBc0JTLE9BQXRCLENBQThCLFNBQUNoRCxHQUFELENBQVMsQ0FDckMsR0FBTTZDLFVBQVdxRCxTQUFTbEcsR0FBVCxDQUFjLEVBQWQsQ0FBakIsQ0FEcUMsbURBR21CdUMsU0FDdERNLFFBRHNELENBSG5CLElBRzlCc0QsZUFIOEIsaUVBR1g3RixRQUhXLHFCQUdYQSxRQUhXLENBR0RnQixNQUhDLHFCQUdEQSxNQUhDLENBR09XLE1BSFAscUJBR09BLE1BSFAsQ0FPckMsR0FBTVMsTUFBTyxPQUFLckQsT0FBTCxDQUFhc0QsWUFBYixDQUEwQkMsR0FBMUIsQ0FBOEJDLFFBQTlCLENBQWIsQ0FDQSx3QkFBVUgsSUFBVixDQUFnQixxQkFBaEIsRUFFQSxHQUFNbkMsV0FBWSxPQUFLNkYsMkJBQUwsQ0FDaEJELGVBRGdCLENBRWhCbEUsTUFGZ0IsQ0FBbEIsQ0FLQSxHQUFNb0UsYUFBYyxDQUNsQmxFLE1BQVViLE9BQU9hLEtBQWpCLEtBRGtCLENBRWxCRSxPQUFXZixPQUFPZSxNQUFsQixLQUZrQixDQUFwQixDQUtBLEdBQU05QyxRQUFTLENBQUVlLGlCQUFGLENBQVlrQixLQUFNLE1BQWxCLENBQWYsQ0FFQSxHQUFNOEUsZ0JBQWlCNUQsS0FBSzZCLEtBQUwsQ0FBV0MsVUFBbEMsQ0FDQTlCLEtBQUs2QixLQUFMLENBQVdDLFVBQVgsQ0FBd0IsV0FBeEIsQ0FDQTlCLEtBQUt5QixLQUFMLENBQWE3QyxNQUFiLENBQ0FtQyxXQUFXeEQsSUFBWCxDQUFnQixHQUFJd0UsZUFBSixDQUFtQi9CLElBQW5CLENBQXlCbkMsU0FBekIsQ0FBb0NoQixNQUFwQyxDQUFoQixFQUNBbUUsUUFBUXpELElBQVIsQ0FBYSxVQUFNLENBQ2pCeUMsS0FBSzZCLEtBQUwsQ0FBV0MsVUFBWCxDQUF3QjhCLGNBQXhCLENBQ0QsQ0FGRCxFQUdELENBN0JELEVBZ0NBLEtBQUszRyxZQUFMLENBQWtCcUQsT0FBbEIsQ0FBMEIsU0FBQ0gsUUFBRCxDQUFjLENBQ3RDLEdBQU1ILE1BQU8sT0FBS3JELE9BQUwsQ0FBYXNELFlBQWIsQ0FBMEJDLEdBQTFCLENBQThCQyxRQUE5QixDQUFiLENBQ0Esd0JBQVVILElBQVYsQ0FBZ0IscUJBQWhCLEVBRUEsR0FBTTZELG9CQUFxQixRQUFyQkEsbUJBQXFCLEVBQU0sQ0FBRSxDQUFuQyxDQUVBLEdBQUkzQyxpQkFBbUIsSUFBdkIsQ0FBNkIsQ0FDM0IsR0FBSWxCLEtBQUswQixjQUFULENBQXlCLENBQ3ZCMUIsS0FBSzBCLGNBQUwsQ0FBb0JvQyxrQkFBcEIsQ0FBdUM5RCxJQUF2QyxFQUNELENBQ0QsT0FBS3JELE9BQUwsQ0FBYXNELFlBQWIsQ0FBMEJ0QyxNQUExQixDQUFpQ3dDLFFBQWpDLEVBQ0FILEtBQUsrRCxLQUFMLEdBQ0EsT0FDRCxDQUVELEdBQ0UvRCxLQUFLMEIsY0FBTCxFQUNBLE9BQUt6RSxZQUFMLENBQWtCc0IsUUFBbEIsQ0FBMkJ5QixLQUFLMEIsY0FBTCxDQUFvQnZCLFFBQS9DLENBRkYsQ0FHRSxDQUNBLEdBQUlILEtBQUswQixjQUFULENBQXlCLENBQ3ZCMUIsS0FBSzBCLGNBQUwsQ0FBb0JvQyxrQkFBcEIsQ0FBdUM5RCxJQUF2QyxFQUNELENBQ0QsT0FBS3JELE9BQUwsQ0FBYXNELFlBQWIsQ0FBMEJ0QyxNQUExQixDQUFpQ3dDLFFBQWpDLEVBQ0EsT0FDRCxDQUVELEdBQU10QyxXQUFZLE9BQUs4RCxzQkFBTCxDQUNoQixDQURnQixDQUVoQixDQUZnQixDQUdoQlQsZ0JBQWdCckQsU0FIQSxDQUFsQixDQU1BLEdBQU1oQixRQUFTLENBQ2JlLFNBQVVzRCxnQkFBZ0J0RCxRQURiLENBRWJnRSxNQUFPVixnQkFBZ0JVLEtBRlYsQ0FHYjlDLEtBQU0sVUFITyxDQUFmLENBTUFrQixLQUFLNkIsS0FBTCxDQUFXQyxVQUFYLENBQXdCLFNBQXhCLENBQ0FmLFdBQVd4RCxJQUFYLENBQWdCLEdBQUl3RSxlQUFKLENBQW1CL0IsSUFBbkIsQ0FBeUJuQyxTQUF6QixDQUFvQ2hCLE1BQXBDLENBQWhCLEVBQ0FtRSxRQUFRekQsSUFBUixDQUFhLFVBQU0sQ0FDakIsR0FBSXlDLEtBQUswQixjQUFULENBQXlCLENBQ3ZCMUIsS0FBSzBCLGNBQUwsQ0FBb0JvQyxrQkFBcEIsQ0FBdUM5RCxJQUF2QyxFQUNELENBQ0QsT0FBS3JELE9BQUwsQ0FBYXNELFlBQWIsQ0FBMEJ0QyxNQUExQixDQUFpQ3dDLFFBQWpDLEVBQ0FILEtBQUsrRCxLQUFMLEdBQ0QsQ0FORCxFQU9ELENBL0NELEVBaURBLE1BQU8sQ0FBQ2hELFVBQUQsQ0FBYUMsT0FBYixDQUFQLENBQ0QsQyxnRkFHQ3lDLGUsQ0FDQWxFLE0sQ0FDQSxDQUNBLE1BQU9rRSxpQkFBZ0J6RixHQUFoQixDQUFvQixTQUFDbkIsTUFBRCxDQUFZLElBQzdCa0MsV0FENkIsQ0FDY2xDLE1BRGQsQ0FDN0JrQyxVQUQ2QixDQUNqQkUsVUFEaUIsQ0FDY3BDLE1BRGQsQ0FDakJvQyxVQURpQixDQUNMRSxNQURLLENBQ2N0QyxNQURkLENBQ0xzQyxNQURLLENBQ0dDLE1BREgsQ0FDY3ZDLE1BRGQsQ0FDR3VDLE1BREgsQ0FJckMsR0FBSTRFLGlCQUFrQmhJLFdBQVdpSSxpQkFBWCxDQUE2QjFFLE9BQU9DLENBQXBDLENBQXVDRCxPQUFPRyxDQUE5QyxDQUF0QixDQUdBMUQsV0FBV2tJLFlBQVgsQ0FDRUYsZUFERixDQUVFQSxlQUZGLENBR0VoSSxXQUFXaUksaUJBQVgsQ0FBNkJsRixVQUE3QixDQUF5Q0UsVUFBekMsQ0FIRixFQU9BLEdBQU1rRixhQUFjbkksV0FBV29JLG9CQUFYLEVBQXBCLENBQ0FwSSxXQUFXcUksbUJBQVgsQ0FBK0JGLFdBQS9CLENBQTRDaEYsTUFBNUMsQ0FBb0RDLE1BQXBELENBQTRELEdBQTVELEVBQ0FwRCxXQUFXa0ksWUFBWCxDQUF3QkYsZUFBeEIsQ0FBeUNBLGVBQXpDLENBQTBERyxXQUExRCxFQUdBbkksV0FBV2tJLFlBQVgsQ0FDRUYsZUFERixDQUVFQSxlQUZGLENBR0VoSSxXQUFXaUksaUJBQVgsQ0FBNkIsQ0FBQzFFLE9BQU9DLENBQXJDLENBQXdDLENBQUNELE9BQU9HLENBQWhELENBSEYsRUFNQSxNQUFPLENBQ0wyRCxzQkFBdUJXLGdCQUFnQk0sSUFBaEIsQ0FBcUIsSUFBckIsQ0FBdkIsSUFESyxDQUFQLENBR0QsQ0E1Qk0sQ0FBUCxDQTZCRCxDLCtEQUVvQixDQUNuQixHQUFNdkgsZUFBZ0IsS0FBS0EsYUFBM0IsQ0FDQSxHQUFNRyxlQUFnQixLQUFLQSxhQUEzQixDQUNBLEdBQU1KLFVBQVcsS0FBS0UsZUFBdEIsQ0FFQSx3QkFDRUQsZUFBaUJHLGFBQWpCLEVBQWtDSixRQURwQyxDQUVFLGlFQUZGLEVBS0EsR0FBTWUsV0FBWSxLQUFLMEcsa0JBQUwsQ0FBd0J4SCxhQUF4QixDQUFsQixDQVZtQiwwQkFXVyxLQUFLeUgseUJBQUwsQ0FDNUIzRyxTQUQ0QixDQUU1QmQsYUFGNEIsQ0FYWCw2RUFXWmdFLFVBWFksMkJBV0FDLE9BWEEsMkJBZ0JuQixHQUFNeUQsYUFBYyxHQUFJQyxZQUFKLENBQWdCM0QsVUFBaEIsQ0FBcEIsQ0FFQSxHQUFNNEQsV0FBWUMsU0FBU0MsUUFBVCxDQUFrQkMsSUFBbEIsQ0FBdUJMLFdBQXZCLENBQWxCLENBQ0FFLFVBQVVJLFFBQVYsQ0FBbUJDLElBQW5CLENBQXdCLFVBQU0sQ0FDNUJoRSxRQUFRVixPQUFSLENBQWdCLFNBQUMyRSxDQUFELFFBQU9BLElBQVAsRUFBaEIsRUFDQW5JLFdBQ0QsQ0FIRCxFQUtBLEtBQUtGLEtBQUwsR0FDRCxDLHlEQUdZRix5QiIsImZpbGUiOiJSQ1RMYXlvdXRBbmltYXRpb25NYW5hZ2VyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAcHJvdmlkZXNNb2R1bGUgUkNUTGF5b3V0QW5pbWF0aW9uTWFuYWdlclxuICogQGZsb3dcbiAqL1xuaW1wb3J0IHR5cGUgeyBMYXlvdXRDaGFuZ2UgfSBmcm9tIFwiUkNUU2hhZG93Vmlld1wiO1xuaW1wb3J0IHR5cGUgeyBLZXlmcmFtZVJlc3VsdCB9IGZyb20gXCJSQ1RLZXlmcmFtZUdlbmVyYXRvclwiO1xuXG5pbXBvcnQgaW52YXJpYW50IGZyb20gXCJJbnZhcmlhbnRcIjtcbmltcG9ydCBSQ1RLZXlmcmFtZUdlbmVyYXRvciBmcm9tIFwiUkNUS2V5ZnJhbWVHZW5lcmF0b3JcIjtcbmltcG9ydCAqIGFzIE1hdHJpeE1hdGggZnJvbSBcIk1hdHJpeE1hdGhcIjtcblxuaW1wb3J0IHR5cGVvZiBfUkNUVUlNYW5hZ2VyIGZyb20gXCJSQ1RVSU1hbmFnZXJcIjtcbnR5cGUgUkNUVUlNYW5hZ2VyID0gJENhbGw8JGF3YWl0PF9SQ1RVSU1hbmFnZXI+PjtcblxuY29uc3QgUHJvcGVydGllc0VudW0gPSB7XG4gIG9wYWNpdHk6IHRydWUsXG4gIHNjYWxlWFk6IHRydWVcbn07XG5cbmNvbnN0IFR5cGVzRW51bSA9IHtcbiAgc3ByaW5nOiB0cnVlLFxuICBsaW5lYXI6IHRydWUsXG4gIGVhc2VJbkVhc2VPdXQ6IHRydWUsXG4gIGVhc2VJbjogdHJ1ZSxcbiAgZWFzZU91dDogdHJ1ZVxufTtcblxuZXhwb3J0IHR5cGUgTGF5b3V0QW5pbSA9IHtcbiAgZHVyYXRpb24/OiBudW1iZXIsXG4gIGRlbGF5PzogbnVtYmVyLFxuICBzcHJpbmdEYW1waW5nPzogbnVtYmVyLFxuICBpbml0aWFsVmVsb2NpdHk/OiBudW1iZXIsXG4gIHR5cGU/OiAkRW51bTx0eXBlb2YgVHlwZXNFbnVtPixcbiAgcHJvcGVydHk/OiAkRW51bTx0eXBlb2YgUHJvcGVydGllc0VudW0+XG59O1xuXG5leHBvcnQgdHlwZSBMYXlvdXRBbmltYXRpb25Db25maWcgPSB7XG4gIGR1cmF0aW9uOiBudW1iZXIsXG4gIGNyZWF0ZTogTGF5b3V0QW5pbSxcbiAgdXBkYXRlOiBMYXlvdXRBbmltLFxuICBkZWxldGU6IExheW91dEFuaW1cbn07XG5cbnR5cGUgS2V5ZnJhbWVDb25maWcgPSB7XG4gIGNyZWF0ZTogP0tleWZyYW1lUmVzdWx0LFxuICB1cGRhdGU6ID9LZXlmcmFtZVJlc3VsdCxcbiAgZGVsZXRlOiA/S2V5ZnJhbWVSZXN1bHRcbn07XG5cbnR5cGUgVHJhbnNmb3JtS2V5ZnJhbWVDb25maWcgPSB7XG4gIHRyYW5zbGF0ZVg6IG51bWJlcixcbiAgdHJhbnNsYXRlWTogbnVtYmVyLFxuICBzY2FsZVg6IG51bWJlcixcbiAgc2NhbGVZOiBudW1iZXJcbn07XG5cbnR5cGUgQ2hpbGRDb250YWluZXJLZXlmcmFtZUNvbmZpZyA9IHtcbiAgc2NhbGVYOiBudW1iZXIsXG4gIHNjYWxlWTogbnVtYmVyXG59O1xuXG50eXBlIENoaWxkQ29udGFpbmVyQW5pbWF0aW9uQ29uZmlnID0gQ2hpbGRDb250YWluZXJLZXlmcmFtZUNvbmZpZ1tdO1xuXG50eXBlIFRyYW5zZm9ybUFuaW1hdGlvbkNvbmZpZyA9IFtcbiAgVHJhbnNmb3JtS2V5ZnJhbWVDb25maWdbXSxcbiAgeyBkdXJhdGlvbjogbnVtYmVyLCBsYXlvdXQ6IEZyYW1lLCBvcmlnaW46IFBvc2l0aW9uIH1cbl07XG5cbnR5cGUgVHJhbnNmb3JtQW5pbWF0aW9uQ29uZmlnUmVnaXN0cnkgPSB7XG4gIFtyZWFjdFRhZzogbnVtYmVyXTogVHJhbnNmb3JtQW5pbWF0aW9uQ29uZmlnXG59O1xuXG5jbGFzcyBSQ1RMYXlvdXRBbmltYXRpb25NYW5hZ2VyIHtcbiAgbWFuYWdlcjogUkNUVUlNYW5hZ2VyO1xuXG4gIHBlbmRpbmdDb25maWc6ID9MYXlvdXRBbmltYXRpb25Db25maWc7XG4gIHBlbmRpbmdDYWxsYmFjazogP0Z1bmN0aW9uO1xuICByZW1vdmVkTm9kZXM6IG51bWJlcltdO1xuICBsYXlvdXRDaGFuZ2VzOiBMYXlvdXRDaGFuZ2VbXTtcblxuICBjb25zdHJ1Y3RvcihtYW5hZ2VyOiBSQ1RVSU1hbmFnZXIpIHtcbiAgICB0aGlzLm1hbmFnZXIgPSBtYW5hZ2VyO1xuICAgIHRoaXMucmVzZXQoKTtcbiAgfVxuXG4gIGNvbmZpZ3VyZU5leHQoY29uZmlnOiBMYXlvdXRBbmltYXRpb25Db25maWcsIGNhbGxiYWNrOiBGdW5jdGlvbikge1xuICAgIHRoaXMucGVuZGluZ0NvbmZpZyA9IGNvbmZpZztcbiAgICB0aGlzLnBlbmRpbmdDYWxsYmFjayA9IGNhbGxiYWNrO1xuICB9XG5cbiAgcmVzZXQoKSB7XG4gICAgdGhpcy5yZW1vdmVkTm9kZXMgPSBbXTtcbiAgICB0aGlzLmxheW91dENoYW5nZXMgPSBbXTtcbiAgICB0aGlzLnBlbmRpbmdDb25maWcgPSB1bmRlZmluZWQ7XG4gICAgdGhpcy5wZW5kaW5nQ2FsbGJhY2sgPSB1bmRlZmluZWQ7XG4gIH1cblxuICBpc1BlbmRpbmcoKTogYm9vbGVhbiB7XG4gICAgcmV0dXJuIHRoaXMucGVuZGluZ0NvbmZpZyAhPSBudWxsO1xuICB9XG5cbiAgYWRkTGF5b3V0Q2hhbmdlcyhjaGFuZ2VzOiBMYXlvdXRDaGFuZ2VbXSkge1xuICAgIHRoaXMubGF5b3V0Q2hhbmdlcyA9IHRoaXMubGF5b3V0Q2hhbmdlcy5jb25jYXQoY2hhbmdlcyk7XG4gIH1cblxuICBxdWV1ZVJlbW92ZWROb2RlKHRhZzogbnVtYmVyKSB7XG4gICAgdGhpcy5yZW1vdmVkTm9kZXMucHVzaCh0YWcpO1xuICB9XG5cbiAgY29uc3RydWN0S2V5ZnJhbWVzKGNvbmZpZzogTGF5b3V0QW5pbWF0aW9uQ29uZmlnKSB7XG4gICAgY29uc3QgeyBjcmVhdGUsIHVwZGF0ZSwgZGVsZXRlOiBkZWwsIGR1cmF0aW9uIH0gPSBjb25maWc7XG5cbiAgICBjb25zdCBrZXlmcmFtZXMgPSB7XG4gICAgICBjcmVhdGU6IFJDVEtleWZyYW1lR2VuZXJhdG9yKGNyZWF0ZSwgZHVyYXRpb24pLFxuICAgICAgdXBkYXRlOiBSQ1RLZXlmcmFtZUdlbmVyYXRvcih1cGRhdGUsIGR1cmF0aW9uKSxcbiAgICAgIGRlbGV0ZTogUkNUS2V5ZnJhbWVHZW5lcmF0b3IoZGVsLCBkdXJhdGlvbilcbiAgICB9O1xuXG4gICAgcmV0dXJuIGtleWZyYW1lcztcbiAgfVxuXG4gIGNyZWF0ZU9wYWNpdHlLZXlmcmFtZXMoZnJvbTogbnVtYmVyLCB0bzogbnVtYmVyLCBrZXlmcmFtZXM6IG51bWJlcltdKSB7XG4gICAgcmV0dXJuIGtleWZyYW1lcy5tYXAoKGtleWZyYW1lKSA9PiAoe1xuICAgICAgb3BhY2l0eTogYCR7dG8gKyAoZnJvbSAtIHRvKSAqICgxIC0ga2V5ZnJhbWUpfWBcbiAgICB9KSk7XG4gIH1cblxuICBjcmVhdGVUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMoXG4gICAgZnJvbTogbnVtYmVyLFxuICAgIHRvOiBudW1iZXIsXG4gICAga2V5ZnJhbWVzOiBudW1iZXJbXSxcbiAgICBwcm9wTmFtZTogc3RyaW5nLFxuICAgIGV4aXN0aW5nS2V5ZnJhbWVzOiBhbnlbXVxuICApIHtcbiAgICByZXR1cm4gZXhpc3RpbmdLZXlmcmFtZXMubWFwKChwcmV2S2V5ZnJhbWUsIGluZGV4KSA9PiB7XG4gICAgICBsZXQgbmV3VmFsdWU7XG5cbiAgICAgIGlmIChbXCJzY2FsZVhcIiwgXCJzY2FsZVlcIl0uaW5jbHVkZXMocHJvcE5hbWUpKSB7XG4gICAgICAgIG5ld1ZhbHVlID0gZnJvbSArICh0byAtIGZyb20pICoga2V5ZnJhbWVzW2luZGV4XTtcblxuICAgICAgICBpZiAobmV3VmFsdWUgPD0gMCkge1xuICAgICAgICAgIG5ld1ZhbHVlID0gMC4wMDAxO1xuICAgICAgICB9XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBuZXdWYWx1ZSA9IGZyb20gKyAodG8gLSBmcm9tKSAqIGtleWZyYW1lc1tpbmRleF07XG4gICAgICB9XG5cbiAgICAgIHJldHVybiB7XG4gICAgICAgIC4uLnByZXZLZXlmcmFtZSxcbiAgICAgICAgW3Byb3BOYW1lXTogbmV3VmFsdWVcbiAgICAgIH07XG4gICAgfSk7XG4gIH1cblxuICBjcmVhdGVJbnZlcnNlVHJhbnNmb3JtQW5pbWF0aW9uS2V5ZnJhbWVzKFxuICAgIHByb3BOYW1lOiBzdHJpbmcsXG4gICAgZXhpc3RpbmdLZXlmcmFtZXM6IGFueVtdLFxuICAgIHBhcmVudEtleWZyYW1lczogYW55W11cbiAgKSB7XG4gICAgcmV0dXJuIGV4aXN0aW5nS2V5ZnJhbWVzLm1hcCgocHJldktleWZyYW1lLCBpbmRleCkgPT4ge1xuICAgICAgY29uc3QgcGFyZW50S2V5ZnJhbWUgPSBwYXJlbnRLZXlmcmFtZXNbaW5kZXhdO1xuICAgICAgbGV0IHBhcmVudFZhbHVlID0gcGFyZW50S2V5ZnJhbWVbcHJvcE5hbWVdO1xuXG4gICAgICBsZXQgbmV3VmFsdWU7XG4gICAgICBpZiAoW1wic2NhbGVYXCIsIFwic2NhbGVZXCJdLmluY2x1ZGVzKHByb3BOYW1lKSkge1xuICAgICAgICBuZXdWYWx1ZSA9IDEgLyBwYXJlbnRWYWx1ZTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG5ld1ZhbHVlID0gLTEgKiBwYXJlbnRWYWx1ZTtcbiAgICAgIH1cblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgLi4ucHJldktleWZyYW1lLFxuICAgICAgICBbcHJvcE5hbWVdOiBuZXdWYWx1ZVxuICAgICAgfTtcbiAgICB9KTtcbiAgfVxuXG4gIHRyYW5zZm9ybUFuaW1hdGlvbkNvbmZpZ0ZhY3RvcnkoXG4gICAga2V5TGVuZ3RoOiBudW1iZXIsXG4gICAgZHVyYXRpb246IG51bWJlcixcbiAgICBsYXlvdXQ6IEZyYW1lXG4gICk6IFRyYW5zZm9ybUFuaW1hdGlvbkNvbmZpZyB7XG4gICAgcmV0dXJuIFtcbiAgICAgIG5ldyBBcnJheShrZXlMZW5ndGgpLmZpbGwoe1xuICAgICAgICB0cmFuc2xhdGVYOiBsYXlvdXQubGVmdCxcbiAgICAgICAgdHJhbnNsYXRlWTogbGF5b3V0LnRvcCxcbiAgICAgICAgc2NhbGVYOiAxLjAsXG4gICAgICAgIHNjYWxlWTogMS4wLFxuICAgICAgICBpbnZlcnNlU2NhbGVYOiAxLjAsXG4gICAgICAgIGludmVyc2VTY2FsZVk6IDEuMFxuICAgICAgfSksXG4gICAgICB7XG4gICAgICAgIGR1cmF0aW9uOiBkdXJhdGlvbixcbiAgICAgICAgbGF5b3V0LFxuICAgICAgICBvcmlnaW46IHtcbiAgICAgICAgICB4OiAtMSAqIGxheW91dC53aWR0aCAvIDIsXG4gICAgICAgICAgeTogLTEgKiBsYXlvdXQuaGVpZ2h0IC8gMlxuICAgICAgICB9XG4gICAgICB9XG4gICAgXTtcbiAgfVxuXG4gIGNoaWxkQ29udGFpbmVyQW5pbWF0aW9uQ29uZmlnRmFjdG9yeShrZXlMZW5ndGg6IG51bWJlcikge1xuICAgIHJldHVybiBuZXcgQXJyYXkoa2V5TGVuZ3RoKS5maWxsKHtcbiAgICAgIHNjYWxlWDogMS4wLFxuICAgICAgc2NhbGVZOiAxLjBcbiAgICB9KTtcbiAgfVxuXG4gIGFwcGx5SW52ZXJzZVRyYW5zZm9ybU9uQ2hpbGRyZW4oXG4gICAgc2hhZG93VmlldzogKixcbiAgICByZWdpc3RyeTogVHJhbnNmb3JtQW5pbWF0aW9uQ29uZmlnUmVnaXN0cnksXG4gICAgdXBkYXRlS2V5Q29uZmlnOiBLZXlmcmFtZVJlc3VsdCxcbiAgICBuZXdGcmFtZXM6IFRyYW5zZm9ybUtleWZyYW1lQ29uZmlnW10sXG4gICAgcHJvcE5hbWU6IHN0cmluZ1xuICApIHtcbiAgICBjb25zdCB2aWV3ID0gdGhpcy5tYW5hZ2VyLnZpZXdSZWdpc3RyeS5nZXQoc2hhZG93Vmlldy5yZWFjdFRhZyk7XG5cbiAgICBpZiAodmlldyAmJiB2aWV3LnJlYWN0U3Vidmlld3MubGVuZ3RoICE9PSAwKSB7XG4gICAgICB2aWV3LnJlYWN0U3Vidmlld3MuZm9yRWFjaCgoc3ViVmlldywgaW5kZXgpID0+IHtcbiAgICAgICAgY29uc3Qgc3ViUmVhY3RUYWcgPSBzdWJWaWV3LnJlYWN0VGFnO1xuXG4gICAgICAgIGNvbnN0IHN1YlNoYWRvd1ZpZXcgPSB0aGlzLm1hbmFnZXIuc2hhZG93Vmlld1JlZ2lzdHJ5LmdldChzdWJSZWFjdFRhZyk7XG4gICAgICAgIGludmFyaWFudChzdWJTaGFkb3dWaWV3LCBcIlNoYWRvdyBWaWV3IGRvZXMgbm90IGV4aXN0XCIpO1xuXG4gICAgICAgIGNvbnN0IHByZXZpb3VzTGF5b3V0ID0gc3ViU2hhZG93Vmlldy5wcmV2aW91c0xheW91dDtcbiAgICAgICAgaW52YXJpYW50KHByZXZpb3VzTGF5b3V0LCBcIlNoYWRvdyBWaWV3IGhhcyBubyBwcmV2aW91cyBsYXlvdXRcIik7XG5cbiAgICAgICAgaWYgKCFyZWdpc3RyeS5oYXNPd25Qcm9wZXJ0eShzdWJSZWFjdFRhZykpIHtcbiAgICAgICAgICByZWdpc3RyeVtzdWJSZWFjdFRhZ10gPSB0aGlzLnRyYW5zZm9ybUFuaW1hdGlvbkNvbmZpZ0ZhY3RvcnkoXG4gICAgICAgICAgICB1cGRhdGVLZXlDb25maWcua2V5ZnJhbWVzLmxlbmd0aCxcbiAgICAgICAgICAgIHVwZGF0ZUtleUNvbmZpZy5kdXJhdGlvbixcbiAgICAgICAgICAgIHByZXZpb3VzTGF5b3V0XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIHJlZ2lzdHJ5W1xuICAgICAgICAgIHN1YlJlYWN0VGFnXG4gICAgICAgIF1bMF0gPSB0aGlzLmNyZWF0ZUludmVyc2VUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMoXG4gICAgICAgICAgcHJvcE5hbWUsXG4gICAgICAgICAgcmVnaXN0cnlbc3ViUmVhY3RUYWddWzBdLFxuICAgICAgICAgIG5ld0ZyYW1lc1xuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfVxuICB9XG5cbiAgY3JlYXRlVHJhbnNmb3JtQW5pbWF0aW9ucyhcbiAgICBrZXlmcmFtZXM6IEtleWZyYW1lQ29uZmlnLFxuICAgIGNvbmZpZzogTGF5b3V0QW5pbWF0aW9uQ29uZmlnXG4gICkge1xuICAgIGNvbnN0IGFuaW1hdGlvbnMgPSBbXTtcbiAgICBjb25zdCBjbGVhbnVwID0gW107XG4gICAgY29uc3QgcmVnaXN0cnk6IFRyYW5zZm9ybUFuaW1hdGlvbkNvbmZpZ1JlZ2lzdHJ5ID0ge307XG5cbiAgICBjb25zdCB7XG4gICAgICBjcmVhdGU6IGNyZWF0ZUtleUNvbmZpZyxcbiAgICAgIHVwZGF0ZTogdXBkYXRlS2V5Q29uZmlnLFxuICAgICAgZGVsZXRlOiBkZWxldGVLZXlDb25maWdcbiAgICB9ID0ga2V5ZnJhbWVzO1xuXG4gICAgY29uc3QgYWRkZWROb2RlcyA9IHRoaXMubGF5b3V0Q2hhbmdlc1xuICAgICAgLmZpbHRlcigobGMpID0+ICFsYy5wcmV2aW91c01lYXN1cmVtZW50KVxuICAgICAgLm1hcCgobGMpID0+IGxjLnJlYWN0VGFnKTtcblxuICAgIHRoaXMubGF5b3V0Q2hhbmdlcy5mb3JFYWNoKChsYXlvdXRDaGFuZ2UpID0+IHtcbiAgICAgIGNvbnN0IHtcbiAgICAgICAgcmVhY3RUYWcsXG4gICAgICAgIGxheW91dCxcbiAgICAgICAgbmV4dE1lYXN1cmVtZW50LFxuICAgICAgICBwcmV2aW91c01lYXN1cmVtZW50XG4gICAgICB9ID0gbGF5b3V0Q2hhbmdlO1xuXG4gICAgICBjb25zdCB2aWV3ID0gdGhpcy5tYW5hZ2VyLnZpZXdSZWdpc3RyeS5nZXQocmVhY3RUYWcpO1xuICAgICAgaW52YXJpYW50KHZpZXcsIFwidmlldyBkb2VzIG5vdCBleGlzdFwiKTtcblxuICAgICAgLy8gaWYgdGhlcmUncyBubyBwcmV2aW91cyBtZWFzdXJlbWVudCB3ZSBjYW4gYXNzdW1lIHRoZSB2aWV3IGlzIGNyZWF0ZWRcbiAgICAgIGlmICghcHJldmlvdXNNZWFzdXJlbWVudCkge1xuICAgICAgICAvLyBza2lwIGlmIG5vIGNyZWF0aW9uIGtleWZyYW1lIGNvbmZpZ1xuICAgICAgICBpZiAoY3JlYXRlS2V5Q29uZmlnID09IG51bGwpIHtcbiAgICAgICAgICB2aWV3LmZyYW1lID0gbGF5b3V0O1xuICAgICAgICAgIHZpZXcub3BhY2l0eSA9IDE7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgLy8gRG9uJ3QgYW5pbWF0ZSBjaGlsZHJlbiBvZiBhZGRlZCB2aWV3c1xuICAgICAgICBpZiAoXG4gICAgICAgICAgdmlldy5yZWFjdFN1cGVydmlldyAmJlxuICAgICAgICAgIGFkZGVkTm9kZXMuaW5jbHVkZXModmlldy5yZWFjdFN1cGVydmlldy5yZWFjdFRhZylcbiAgICAgICAgKSB7XG4gICAgICAgICAgdmlldy5mcmFtZSA9IGxheW91dDtcbiAgICAgICAgICB2aWV3Lm9wYWNpdHkgPSAxO1xuICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuXG4gICAgICAgIGNvbnN0IGtleWZyYW1lcyA9IHRoaXMuY3JlYXRlT3BhY2l0eUtleWZyYW1lcyhcbiAgICAgICAgICAwLFxuICAgICAgICAgIDEsXG4gICAgICAgICAgY3JlYXRlS2V5Q29uZmlnLmtleWZyYW1lc1xuICAgICAgICApO1xuXG4gICAgICAgIGNvbnN0IGNvbmZpZyA9IHtcbiAgICAgICAgICBkdXJhdGlvbjogY3JlYXRlS2V5Q29uZmlnLmR1cmF0aW9uLFxuICAgICAgICAgIGRlbGF5OiBjcmVhdGVLZXlDb25maWcuZGVsYXksXG4gICAgICAgICAgZmlsbDogXCJub25lXCJcbiAgICAgICAgfTtcblxuICAgICAgICB2aWV3LnN0eWxlLndpbGxDaGFuZ2UgPSBcIm9wYWNpdHlcIjtcbiAgICAgICAgdmlldy5mcmFtZSA9IGxheW91dDtcblxuICAgICAgICBhbmltYXRpb25zLnB1c2gobmV3IEtleWZyYW1lRWZmZWN0KHZpZXcsIGtleWZyYW1lcywgY29uZmlnKSk7XG4gICAgICAgIGNsZWFudXAucHVzaCgoKSA9PiB7XG4gICAgICAgICAgdmlldy5zdHlsZS53aWxsQ2hhbmdlID0gXCJcIjtcbiAgICAgICAgfSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICAvLyBza2lwIGxheW91dCB1cGRhdGUgYW5pbWF0aW9uXG4gICAgICAgIGlmICh1cGRhdGVLZXlDb25maWcgPT0gbnVsbCkge1xuICAgICAgICAgIHZpZXcuZnJhbWUgPSBsYXlvdXQ7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG5cbiAgICAgICAgY29uc3Qgc2hhZG93VmlldyA9IHRoaXMubWFuYWdlci5zaGFkb3dWaWV3UmVnaXN0cnkuZ2V0KHJlYWN0VGFnKTtcbiAgICAgICAgaW52YXJpYW50KHNoYWRvd1ZpZXcsIFwic2hhZG93VmlldyBkb2VzIG5vdCBleGlzdFwiKTtcblxuICAgICAgICBpZiAoIXJlZ2lzdHJ5Lmhhc093blByb3BlcnR5KHJlYWN0VGFnKSkge1xuICAgICAgICAgIHJlZ2lzdHJ5W3JlYWN0VGFnXSA9IHRoaXMudHJhbnNmb3JtQW5pbWF0aW9uQ29uZmlnRmFjdG9yeShcbiAgICAgICAgICAgIHVwZGF0ZUtleUNvbmZpZy5rZXlmcmFtZXMubGVuZ3RoLFxuICAgICAgICAgICAgdXBkYXRlS2V5Q29uZmlnLmR1cmF0aW9uLFxuICAgICAgICAgICAgbGF5b3V0XG4gICAgICAgICAgKTtcbiAgICAgICAgfVxuXG4gICAgICAgIGxldCB7XG4gICAgICAgICAgdG9wOiBwcmV2VG9wLFxuICAgICAgICAgIGxlZnQ6IHByZXZMZWZ0LFxuICAgICAgICAgIHdpZHRoOiBwcmV2V2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBwcmV2SGVpZ2h0XG4gICAgICAgIH0gPSB2aWV3LmZyYW1lO1xuXG4gICAgICAgIGxldCB7XG4gICAgICAgICAgdG9wOiBuZXh0VG9wLFxuICAgICAgICAgIGxlZnQ6IG5leHRMZWZ0LFxuICAgICAgICAgIHdpZHRoOiBuZXh0V2lkdGgsXG4gICAgICAgICAgaGVpZ2h0OiBuZXh0SGVpZ2h0XG4gICAgICAgIH0gPSBsYXlvdXQ7XG5cbiAgICAgICAgaWYgKHByZXZUb3AgIT09IG5leHRUb3ApIHtcbiAgICAgICAgICBjb25zdCBwcmV2VHJhbnNsYXRlWSA9IHByZXZUb3A7XG4gICAgICAgICAgY29uc3QgbmV4dFRyYW5zbGF0ZVkgPSBuZXh0VG9wO1xuXG4gICAgICAgICAgY29uc3QgbmV3RnJhbWVzID0gdGhpcy5jcmVhdGVUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMoXG4gICAgICAgICAgICBwcmV2VHJhbnNsYXRlWSxcbiAgICAgICAgICAgIG5leHRUcmFuc2xhdGVZLFxuICAgICAgICAgICAgdXBkYXRlS2V5Q29uZmlnLmtleWZyYW1lcyxcbiAgICAgICAgICAgIFwidHJhbnNsYXRlWVwiLFxuICAgICAgICAgICAgcmVnaXN0cnlbcmVhY3RUYWddWzBdXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJlZ2lzdHJ5W3JlYWN0VGFnXVswXSA9IG5ld0ZyYW1lcztcbiAgICAgICAgfVxuXG4gICAgICAgIGlmIChwcmV2TGVmdCAhPT0gbmV4dExlZnQpIHtcbiAgICAgICAgICBjb25zdCBwcmV2VHJhbnNsYXRlWCA9IHByZXZMZWZ0O1xuICAgICAgICAgIGNvbnN0IG5leHRUcmFuc2xhdGVYID0gbmV4dExlZnQ7XG5cbiAgICAgICAgICBjb25zdCBuZXdGcmFtZXMgPSB0aGlzLmNyZWF0ZVRyYW5zZm9ybUFuaW1hdGlvbktleWZyYW1lcyhcbiAgICAgICAgICAgIHByZXZUcmFuc2xhdGVYLFxuICAgICAgICAgICAgbmV4dFRyYW5zbGF0ZVgsXG4gICAgICAgICAgICB1cGRhdGVLZXlDb25maWcua2V5ZnJhbWVzLFxuICAgICAgICAgICAgXCJ0cmFuc2xhdGVYXCIsXG4gICAgICAgICAgICByZWdpc3RyeVtyZWFjdFRhZ11bMF1cbiAgICAgICAgICApO1xuXG4gICAgICAgICAgcmVnaXN0cnlbcmVhY3RUYWddWzBdID0gbmV3RnJhbWVzO1xuICAgICAgICB9XG5cbiAgICAgICAgbGV0IGNoaWxkQ29udGFpbmVyVHJhbnNmb3JtID0gdGhpcy5jaGlsZENvbnRhaW5lckFuaW1hdGlvbkNvbmZpZ0ZhY3RvcnkoXG4gICAgICAgICAgdXBkYXRlS2V5Q29uZmlnLmtleWZyYW1lcy5sZW5ndGhcbiAgICAgICAgKTtcbiAgICAgICAgbGV0IHNob3VsZFRyYW5zZm9ybUNoaWxkcmVuID0gZmFsc2U7XG5cbiAgICAgICAgaWYgKHByZXZXaWR0aCAhPT0gbmV4dFdpZHRoICYmIG5leHRXaWR0aCAhPT0gMCkge1xuICAgICAgICAgIGNvbnN0IHByZXZTY2FsZVggPSBwcmV2V2lkdGggLyBuZXh0V2lkdGg7XG4gICAgICAgICAgY29uc3QgbmV4dFNjYWxlWCA9IDEuMDtcblxuICAgICAgICAgIGNvbnN0IG5ld0ZyYW1lcyA9IHRoaXMuY3JlYXRlVHJhbnNmb3JtQW5pbWF0aW9uS2V5ZnJhbWVzKFxuICAgICAgICAgICAgcHJldlNjYWxlWCxcbiAgICAgICAgICAgIG5leHRTY2FsZVgsXG4gICAgICAgICAgICB1cGRhdGVLZXlDb25maWcua2V5ZnJhbWVzLFxuICAgICAgICAgICAgXCJzY2FsZVhcIixcbiAgICAgICAgICAgIHJlZ2lzdHJ5W3JlYWN0VGFnXVswXVxuICAgICAgICAgICk7XG5cbiAgICAgICAgICByZWdpc3RyeVtyZWFjdFRhZ11bMF0gPSBuZXdGcmFtZXM7XG5cbiAgICAgICAgICBpZiAodmlldy5jaGlsZENvbnRhaW5lcikge1xuICAgICAgICAgICAgc2hvdWxkVHJhbnNmb3JtQ2hpbGRyZW4gPSB0cnVlO1xuICAgICAgICAgICAgY2hpbGRDb250YWluZXJUcmFuc2Zvcm0gPSB0aGlzLmNyZWF0ZUludmVyc2VUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMoXG4gICAgICAgICAgICAgIFwic2NhbGVYXCIsXG4gICAgICAgICAgICAgIGNoaWxkQ29udGFpbmVyVHJhbnNmb3JtLFxuICAgICAgICAgICAgICBuZXdGcmFtZXNcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgfVxuICAgICAgICB9XG5cbiAgICAgICAgaWYgKHByZXZIZWlnaHQgIT09IG5leHRIZWlnaHQgJiYgbmV4dEhlaWdodCAhPT0gMCkge1xuICAgICAgICAgIGNvbnN0IG5leHRTY2FsZVkgPSAxLjA7XG4gICAgICAgICAgY29uc3QgcHJldlNjYWxlWSA9IHByZXZIZWlnaHQgLyBuZXh0SGVpZ2h0O1xuXG4gICAgICAgICAgY29uc3QgbmV3RnJhbWVzID0gdGhpcy5jcmVhdGVUcmFuc2Zvcm1BbmltYXRpb25LZXlmcmFtZXMoXG4gICAgICAgICAgICBwcmV2U2NhbGVZLFxuICAgICAgICAgICAgbmV4dFNjYWxlWSxcbiAgICAgICAgICAgIHVwZGF0ZUtleUNvbmZpZy5rZXlmcmFtZXMsXG4gICAgICAgICAgICBcInNjYWxlWVwiLFxuICAgICAgICAgICAgcmVnaXN0cnlbcmVhY3RUYWddWzBdXG4gICAgICAgICAgKTtcblxuICAgICAgICAgIHJlZ2lzdHJ5W3JlYWN0VGFnXVswXSA9IG5ld0ZyYW1lcztcblxuICAgICAgICAgIGlmICh2aWV3LmNoaWxkQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBzaG91bGRUcmFuc2Zvcm1DaGlsZHJlbiA9IHRydWU7XG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lclRyYW5zZm9ybSA9IHRoaXMuY3JlYXRlSW52ZXJzZVRyYW5zZm9ybUFuaW1hdGlvbktleWZyYW1lcyhcbiAgICAgICAgICAgICAgXCJzY2FsZVlcIixcbiAgICAgICAgICAgICAgY2hpbGRDb250YWluZXJUcmFuc2Zvcm0sXG4gICAgICAgICAgICAgIG5ld0ZyYW1lc1xuICAgICAgICAgICAgKTtcbiAgICAgICAgICB9XG4gICAgICAgIH1cblxuICAgICAgICBpZiAoc2hvdWxkVHJhbnNmb3JtQ2hpbGRyZW4pIHtcbiAgICAgICAgICBjb25zdCBjaGlsZENvbnRhaW5lciA9IHZpZXcuY2hpbGRDb250YWluZXI7XG4gICAgICAgICAgaWYgKGNoaWxkQ29udGFpbmVyKSB7XG4gICAgICAgICAgICBjb25zdCBrZXlmcmFtZXMgPSBjaGlsZENvbnRhaW5lclRyYW5zZm9ybS5tYXAoXG4gICAgICAgICAgICAgICh7IHNjYWxlWCwgc2NhbGVZIH0pID0+ICh7XG4gICAgICAgICAgICAgICAgdHJhbnNmb3JtOiBgc2NhbGUoJHtzY2FsZVh9LCR7c2NhbGVZfSlgXG4gICAgICAgICAgICAgIH0pXG4gICAgICAgICAgICApO1xuICAgICAgICAgICAgY29uc3QgY29uZmlnID0geyBkdXJhdGlvbjogdXBkYXRlS2V5Q29uZmlnLmR1cmF0aW9uLCBmaWxsOiBcIm5vbmVcIiB9O1xuXG4gICAgICAgICAgICBjaGlsZENvbnRhaW5lci5zdHlsZS53aWxsQ2hhbmdlID0gXCJ0cmFuc2Zvcm1cIjtcbiAgICAgICAgICAgIGFuaW1hdGlvbnMucHVzaChcbiAgICAgICAgICAgICAgbmV3IEtleWZyYW1lRWZmZWN0KGNoaWxkQ29udGFpbmVyLCBrZXlmcmFtZXMsIGNvbmZpZylcbiAgICAgICAgICAgICk7XG4gICAgICAgICAgICBjbGVhbnVwLnB1c2goKCkgPT4ge1xuICAgICAgICAgICAgICBjaGlsZENvbnRhaW5lci5zdHlsZS53aWxsQ2hhbmdlID0gXCJcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgIH0pO1xuXG4gICAgT2JqZWN0LmtleXMocmVnaXN0cnkpLmZvckVhY2goKHRhZykgPT4ge1xuICAgICAgY29uc3QgcmVhY3RUYWcgPSBwYXJzZUludCh0YWcsIDEwKTtcblxuICAgICAgY29uc3QgW2tleWZyYW1lQ29uZmlncywgeyBkdXJhdGlvbiwgbGF5b3V0LCBvcmlnaW4gfV0gPSByZWdpc3RyeVtcbiAgICAgICAgcmVhY3RUYWdcbiAgICAgIF07XG5cbiAgICAgIGNvbnN0IHZpZXcgPSB0aGlzLm1hbmFnZXIudmlld1JlZ2lzdHJ5LmdldChyZWFjdFRhZyk7XG4gICAgICBpbnZhcmlhbnQodmlldywgXCJ2aWV3IGRvZXMgbm90IGV4aXN0XCIpO1xuXG4gICAgICBjb25zdCBrZXlmcmFtZXMgPSB0aGlzLmNvbnN0cnVjdFRyYW5zZm9ybUtleWZyYW1lcyhcbiAgICAgICAga2V5ZnJhbWVDb25maWdzLFxuICAgICAgICBvcmlnaW5cbiAgICAgICk7XG5cbiAgICAgIGNvbnN0IGxheW91dFN0eWxlID0ge1xuICAgICAgICB3aWR0aDogYCR7bGF5b3V0LndpZHRofXB4YCxcbiAgICAgICAgaGVpZ2h0OiBgJHtsYXlvdXQuaGVpZ2h0fXB4YFxuICAgICAgfTtcblxuICAgICAgY29uc3QgY29uZmlnID0geyBkdXJhdGlvbiwgZmlsbDogXCJub25lXCIgfTtcblxuICAgICAgY29uc3QgcHJldldpbGxDaGFuZ2UgPSB2aWV3LnN0eWxlLndpbGxDaGFuZ2U7XG4gICAgICB2aWV3LnN0eWxlLndpbGxDaGFuZ2UgPSBcInRyYW5zZm9ybVwiO1xuICAgICAgdmlldy5mcmFtZSA9IGxheW91dDtcbiAgICAgIGFuaW1hdGlvbnMucHVzaChuZXcgS2V5ZnJhbWVFZmZlY3Qodmlldywga2V5ZnJhbWVzLCBjb25maWcpKTtcbiAgICAgIGNsZWFudXAucHVzaCgoKSA9PiB7XG4gICAgICAgIHZpZXcuc3R5bGUud2lsbENoYW5nZSA9IHByZXZXaWxsQ2hhbmdlO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICAvLyBBbmltYXRlIHZpZXcgcmVtb3ZhbFxuICAgIHRoaXMucmVtb3ZlZE5vZGVzLmZvckVhY2goKHJlYWN0VGFnKSA9PiB7XG4gICAgICBjb25zdCB2aWV3ID0gdGhpcy5tYW5hZ2VyLnZpZXdSZWdpc3RyeS5nZXQocmVhY3RUYWcpO1xuICAgICAgaW52YXJpYW50KHZpZXcsIFwidmlldyBkb2VzIG5vdCBleGlzdFwiKTtcblxuICAgICAgY29uc3QgY2xlYW5VcFJlbW92ZWROb2RlID0gKCkgPT4ge307XG5cbiAgICAgIGlmIChkZWxldGVLZXlDb25maWcgPT0gbnVsbCkge1xuICAgICAgICBpZiAodmlldy5yZWFjdFN1cGVydmlldykge1xuICAgICAgICAgIHZpZXcucmVhY3RTdXBlcnZpZXcucmVtb3ZlUmVhY3RTdWJ2aWV3KHZpZXcpO1xuICAgICAgICB9XG4gICAgICAgIHRoaXMubWFuYWdlci52aWV3UmVnaXN0cnkuZGVsZXRlKHJlYWN0VGFnKTtcbiAgICAgICAgdmlldy5wdXJnZSgpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGlmIChcbiAgICAgICAgdmlldy5yZWFjdFN1cGVydmlldyAmJlxuICAgICAgICB0aGlzLnJlbW92ZWROb2Rlcy5pbmNsdWRlcyh2aWV3LnJlYWN0U3VwZXJ2aWV3LnJlYWN0VGFnKVxuICAgICAgKSB7XG4gICAgICAgIGlmICh2aWV3LnJlYWN0U3VwZXJ2aWV3KSB7XG4gICAgICAgICAgdmlldy5yZWFjdFN1cGVydmlldy5yZW1vdmVSZWFjdFN1YnZpZXcodmlldyk7XG4gICAgICAgIH1cbiAgICAgICAgdGhpcy5tYW5hZ2VyLnZpZXdSZWdpc3RyeS5kZWxldGUocmVhY3RUYWcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIGNvbnN0IGtleWZyYW1lcyA9IHRoaXMuY3JlYXRlT3BhY2l0eUtleWZyYW1lcyhcbiAgICAgICAgMSxcbiAgICAgICAgMCxcbiAgICAgICAgZGVsZXRlS2V5Q29uZmlnLmtleWZyYW1lc1xuICAgICAgKTtcblxuICAgICAgY29uc3QgY29uZmlnID0ge1xuICAgICAgICBkdXJhdGlvbjogZGVsZXRlS2V5Q29uZmlnLmR1cmF0aW9uLFxuICAgICAgICBkZWxheTogZGVsZXRlS2V5Q29uZmlnLmRlbGF5LFxuICAgICAgICBmaWxsOiBcImZvcndhcmRzXCJcbiAgICAgIH07XG5cbiAgICAgIHZpZXcuc3R5bGUud2lsbENoYW5nZSA9IFwib3BhY2l0eVwiO1xuICAgICAgYW5pbWF0aW9ucy5wdXNoKG5ldyBLZXlmcmFtZUVmZmVjdCh2aWV3LCBrZXlmcmFtZXMsIGNvbmZpZykpO1xuICAgICAgY2xlYW51cC5wdXNoKCgpID0+IHtcbiAgICAgICAgaWYgKHZpZXcucmVhY3RTdXBlcnZpZXcpIHtcbiAgICAgICAgICB2aWV3LnJlYWN0U3VwZXJ2aWV3LnJlbW92ZVJlYWN0U3Vidmlldyh2aWV3KTtcbiAgICAgICAgfVxuICAgICAgICB0aGlzLm1hbmFnZXIudmlld1JlZ2lzdHJ5LmRlbGV0ZShyZWFjdFRhZyk7XG4gICAgICAgIHZpZXcucHVyZ2UoKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuXG4gICAgcmV0dXJuIFthbmltYXRpb25zLCBjbGVhbnVwXTtcbiAgfVxuXG4gIGNvbnN0cnVjdFRyYW5zZm9ybUtleWZyYW1lcyhcbiAgICBrZXlmcmFtZUNvbmZpZ3M6IFRyYW5zZm9ybUtleWZyYW1lQ29uZmlnW10sXG4gICAgb3JpZ2luOiBQb3NpdGlvblxuICApIHtcbiAgICByZXR1cm4ga2V5ZnJhbWVDb25maWdzLm1hcCgoY29uZmlnKSA9PiB7XG4gICAgICBjb25zdCB7IHRyYW5zbGF0ZVgsIHRyYW5zbGF0ZVksIHNjYWxlWCwgc2NhbGVZIH0gPSBjb25maWc7XG5cbiAgICAgIC8vIHNoaWZ0IHRyYW5zZm9ybWF0aW9uIG9yaWdpblxuICAgICAgbGV0IHRyYW5zZm9ybU1hdHJpeCA9IE1hdHJpeE1hdGguY3JlYXRlVHJhbnNsYXRlMmQob3JpZ2luLngsIG9yaWdpbi55KTtcblxuICAgICAgLy8gYXBwbHkgdHJhbnNsYXRpb25cbiAgICAgIE1hdHJpeE1hdGgubXVsdGlwbHlJbnRvKFxuICAgICAgICB0cmFuc2Zvcm1NYXRyaXgsXG4gICAgICAgIHRyYW5zZm9ybU1hdHJpeCxcbiAgICAgICAgTWF0cml4TWF0aC5jcmVhdGVUcmFuc2xhdGUyZCh0cmFuc2xhdGVYLCB0cmFuc2xhdGVZKVxuICAgICAgKTtcblxuICAgICAgLy8gYXBwbHkgc2NhbGluZ1xuICAgICAgY29uc3Qgc2NhbGVNYXRyaXggPSBNYXRyaXhNYXRoLmNyZWF0ZUlkZW50aXR5TWF0cml4KCk7XG4gICAgICBNYXRyaXhNYXRoLnJldXNlU2NhbGUzZENvbW1hbmQoc2NhbGVNYXRyaXgsIHNjYWxlWCwgc2NhbGVZLCAxLjApO1xuICAgICAgTWF0cml4TWF0aC5tdWx0aXBseUludG8odHJhbnNmb3JtTWF0cml4LCB0cmFuc2Zvcm1NYXRyaXgsIHNjYWxlTWF0cml4KTtcblxuICAgICAgLy8gcmV2ZXJ0IHRyYW5zZm9ybWF0aW9uIG9yaWdpblxuICAgICAgTWF0cml4TWF0aC5tdWx0aXBseUludG8oXG4gICAgICAgIHRyYW5zZm9ybU1hdHJpeCxcbiAgICAgICAgdHJhbnNmb3JtTWF0cml4LFxuICAgICAgICBNYXRyaXhNYXRoLmNyZWF0ZVRyYW5zbGF0ZTJkKC1vcmlnaW4ueCwgLW9yaWdpbi55KVxuICAgICAgKTtcblxuICAgICAgcmV0dXJuIHtcbiAgICAgICAgdHJhbnNmb3JtOiBgbWF0cml4M2QoJHt0cmFuc2Zvcm1NYXRyaXguam9pbihcIiwgXCIpfSlgXG4gICAgICB9O1xuICAgIH0pO1xuICB9XG5cbiAgYXBwbHlMYXlvdXRDaGFuZ2VzKCkge1xuICAgIGNvbnN0IHBlbmRpbmdDb25maWcgPSB0aGlzLnBlbmRpbmdDb25maWc7XG4gICAgY29uc3QgbGF5b3V0Q2hhbmdlcyA9IHRoaXMubGF5b3V0Q2hhbmdlcztcbiAgICBjb25zdCBjYWxsYmFjayA9IHRoaXMucGVuZGluZ0NhbGxiYWNrO1xuXG4gICAgaW52YXJpYW50KFxuICAgICAgcGVuZGluZ0NvbmZpZyAmJiBsYXlvdXRDaGFuZ2VzICYmIGNhbGxiYWNrLFxuICAgICAgXCJBdHRlbXB0aW5nIHRvIGFwcGx5IGEgbGF5b3V0YW5pbWF0aW9uIHdpdGhvdXQgYSBwZW5kaW5nIGNvbmZpZy5cIlxuICAgICk7XG5cbiAgICBjb25zdCBrZXlmcmFtZXMgPSB0aGlzLmNvbnN0cnVjdEtleWZyYW1lcyhwZW5kaW5nQ29uZmlnKTtcbiAgICBjb25zdCBbYW5pbWF0aW9ucywgY2xlYW51cF0gPSB0aGlzLmNyZWF0ZVRyYW5zZm9ybUFuaW1hdGlvbnMoXG4gICAgICBrZXlmcmFtZXMsXG4gICAgICBwZW5kaW5nQ29uZmlnXG4gICAgKTtcblxuICAgIGNvbnN0IGdyb3VwRWZmZWN0ID0gbmV3IEdyb3VwRWZmZWN0KGFuaW1hdGlvbnMpO1xuXG4gICAgY29uc3QgYW5pbWF0aW9uID0gZG9jdW1lbnQudGltZWxpbmUucGxheShncm91cEVmZmVjdCk7XG4gICAgYW5pbWF0aW9uLmZpbmlzaGVkLnRoZW4oKCkgPT4ge1xuICAgICAgY2xlYW51cC5mb3JFYWNoKChjKSA9PiBjKCkpO1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcblxuICAgIHRoaXMucmVzZXQoKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RMYXlvdXRBbmltYXRpb25NYW5hZ2VyO1xuIl19