{"version":3,"sources":["../../../ReactDom/modules/RedBox/RCTRedBox.js"],"names":["getFileName","path","split","pop","RCTRedBox","bridge","dismiss","domRoot","firstChild","removeChild","reload","window","location","copy","fullStackTrace","_lastErrorMessage","_lastStackTrace","frame","methodName","file","formatFrameSource","bundleURL","URL","bundleLocation","pathname","search","fetch","method","body","headers","openStackFrame","detail","JSON","stringify","document","createElement","setAttribute","documentElement","appendChild","fileName","name","lineInfo","lineNumber","column","message","stack","currentBox","redBox","addEventListener"],"mappings":"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","file":"RCTRedBox.js","sourcesContent":["/**\n * @providesModule RCTRedBox\n * @flow\n */\n\nimport RCTBridge, {\n  RCT_EXPORT_MODULE,\n  RCT_EXPORT_METHOD,\n  RCTFunctionTypeNormal\n} from \"RCTBridge\";\nimport RedBox from \"RedBoxView\";\n\nimport type { StackEntry } from \"RCTExceptionsManager\";\n\nfunction getFileName(path) {\n  return path\n    .split(\"\\\\\")\n    .pop()\n    .split(\"/\")\n    .pop();\n}\n\n@RCT_EXPORT_MODULE(\"RCTRedBox\")\nclass RCTRedBox {\n  bridge: RCTBridge;\n  domRoot: HTMLElement;\n  currentBox: ?RedBox;\n\n  _lastErrorMessage: ?string;\n  _lastStackTrace: ?(StackEntry[]);\n\n  constructor(bridge: RCTBridge) {\n    this.bridge = bridge;\n\n    this.domRoot = document.createElement(\"div\");\n    this.domRoot.setAttribute(\"id\", \"redbox\");\n    if (document.documentElement) {\n      document.documentElement.appendChild(this.domRoot);\n    }\n  }\n\n  dismiss = () => {\n    while (this.domRoot.firstChild) {\n      this.domRoot.removeChild(this.domRoot.firstChild);\n    }\n  };\n\n  reload = () => {\n    window.location.reload(true);\n  };\n\n  formatFrameSource(frame: StackEntry) {\n    const fileName = (() => {\n      if (frame.file) {\n        const name = getFileName(frame.file);\n        if (name) return name;\n      }\n      return \"<unknown file>\";\n    })();\n\n    let lineInfo = `${fileName}:${frame.lineNumber}`;\n    if (frame.column !== 0) {\n      lineInfo += `:${frame.column}`;\n    }\n    return lineInfo;\n  }\n\n  copy = () => {\n    let fullStackTrace = \"\";\n\n    if (this._lastErrorMessage != null) {\n      fullStackTrace += this._lastErrorMessage;\n      fullStackTrace += \"\\n\\n\";\n    }\n\n    if (this._lastStackTrace) {\n      for (let frame of this._lastStackTrace) {\n        fullStackTrace += `${frame.methodName}\\n`;\n        if (frame.file) {\n          fullStackTrace += `    ${this.formatFrameSource(frame)}\\n`;\n        }\n      }\n    }\n\n    const bundleURL = new URL(this.bridge.bundleLocation);\n\n    bundleURL.pathname = \"/copy-to-clipboard\";\n    bundleURL.search = \"\";\n\n    fetch(bundleURL, {\n      method: \"POST\",\n      body: fullStackTrace,\n      headers: {\n        \"Content-Type\": \"text/plain\"\n      }\n    });\n  };\n\n  openStackFrame = ({ detail: frame }: any) => {\n    const bundleURL = new URL(this.bridge.bundleLocation);\n\n    bundleURL.pathname = \"/open-stack-frame\";\n    bundleURL.search = \"\";\n\n    fetch(bundleURL, {\n      method: \"POST\",\n      body: JSON.stringify(frame),\n      headers: {\n        \"Content-Type\": \"application/json\"\n      }\n    });\n  };\n\n  updateError(message: string, stack: StackEntry[]) {\n    const currentBox = this.currentBox;\n\n    if (currentBox) {\n      currentBox.message = message;\n      currentBox.stack = stack;\n    }\n\n    this._lastErrorMessage = message;\n    this._lastStackTrace = stack;\n  }\n\n  showErrorMessage(message: string, stack: StackEntry[]) {\n    const redBox: RedBox = new RedBox();\n    this.currentBox = redBox;\n\n    redBox.message = message;\n    redBox.stack = stack;\n\n    this._lastErrorMessage = message;\n    this._lastStackTrace = stack;\n\n    redBox.addEventListener(\"dismiss\", this.dismiss);\n    redBox.addEventListener(\"reload\", this.reload);\n    redBox.addEventListener(\"copy\", this.copy);\n    redBox.addEventListener(\"stackframe\", this.openStackFrame);\n\n    this.domRoot.appendChild(redBox);\n  }\n}\n\nexport default RCTRedBox;\n"]}