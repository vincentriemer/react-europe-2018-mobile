Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_class,_desc,_value,_class2;var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);var _RCTBridge=require("./../bridge/RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object['ke'+'ys'](descriptor).forEach(function(key){desc[key]=descriptor[key];});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if('value'in desc||desc.initializer){desc.writable=true;}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc;},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined;}if(desc.initializer===void 0){Object['define'+'Property'](target,property,desc);desc=null;}return desc;}var RCTWebSocketModule=(_dec=(0,_RCTBridge.RCT_EXPORT_MODULE)("RCTWebSocketModule"),_dec2=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec3=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec4=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec5=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec6=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec(_class=(_class2=function(){function RCTWebSocketModule(bridge){(0,_classCallCheck3.default)(this,RCTWebSocketModule);this.bridge=bridge;this.sockets={};}(0,_createClass3.default)(RCTWebSocketModule,[{key:"connect",value:function connect(url,protocols,options,socketId){var _this=this;var socket=protocols?new WebSocket(url,protocols):new WebSocket(url);socket.binaryType="arraybuffer";this.sockets[String(socketId)]=socket;socket.onclose=function(event){var payload={id:socketId,code:event.code,reason:event.reason};_this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketClosed",payload]);};socket.onerror=function(event){var payload={id:socketId,message:"Native WebSocket error"};_this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketFailed",payload]);};socket.onmessage=function(event){var data=event.data;if(data instanceof ArrayBuffer){var arr=new Uint8Array(data);var str=new Array(arr.byteLength);for(var i=0;i<str.length;i++){str[i]=String.fromCharCode(arr[i]);}data=btoa(str.join(""));}var payload={id:socketId,type:typeof event.data==="string"?"string":"binary",data:data};_this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketMessage",payload]);};socket.onopen=function(event){var payload={id:socketId};_this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",["websocketOpen",payload]);};}},{key:"_send",value:function _send(data,socketId){var socket=this.sockets[String(socketId)];if(!socket){throw new Error("Error while sending data to WebSocket: no such socket");}socket.send(data);}},{key:"send",value:function send(data,socketId){this._send(data,socketId);}},{key:"sendBinary",value:function sendBinary(data,socketId){var chars=atob(data);var array=new Uint8Array(chars.length);for(var i=0;i<chars.length;i++){array[i]=chars.charCodeAt(i)&255;}this._send(array.buffer,socketId);}},{key:"ping",value:function ping(socketId){throw new Error("Cannot send a ping. Browser WebSocket APIs are not capable of sending specific opcodes");}},{key:"close",value:function close(codeOrId,reason,socketId){var id=void 0;if(typeof reason!=="undefined"&&typeof socketId!=="undefined"){id=String(socketId);var socket=this.sockets[id];if(!socket){return;}socket.close(codeOrId,reason);}else{id=String(codeOrId);var _socket=this.sockets[id];if(!_socket){return;}_socket.close();}delete this.sockets[id];}}]);return RCTWebSocketModule;}(),(_applyDecoratedDescriptor(_class2.prototype,"connect",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"connect"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"send",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"send"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"sendBinary",[_dec4],Object.getOwnPropertyDescriptor(_class2.prototype,"sendBinary"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"ping",[_dec5],Object.getOwnPropertyDescriptor(_class2.prototype,"ping"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"close",[_dec6],Object.getOwnPropertyDescriptor(_class2.prototype,"close"),_class2.prototype)),_class2))||_class);exports.default=RCTWebSocketModule;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL21vZHVsZXMvUkNUV2ViU29ja2V0TW9kdWxlLmpzIl0sIm5hbWVzIjpbIlJDVFdlYlNvY2tldE1vZHVsZSIsImJyaWRnZSIsInNvY2tldHMiLCJ1cmwiLCJwcm90b2NvbHMiLCJvcHRpb25zIiwic29ja2V0SWQiLCJzb2NrZXQiLCJXZWJTb2NrZXQiLCJiaW5hcnlUeXBlIiwiU3RyaW5nIiwib25jbG9zZSIsImV2ZW50IiwicGF5bG9hZCIsImlkIiwiY29kZSIsInJlYXNvbiIsImVucXVldWVKU0NhbGwiLCJvbmVycm9yIiwibWVzc2FnZSIsIm9ubWVzc2FnZSIsImRhdGEiLCJBcnJheUJ1ZmZlciIsImFyciIsIlVpbnQ4QXJyYXkiLCJzdHIiLCJBcnJheSIsImJ5dGVMZW5ndGgiLCJpIiwibGVuZ3RoIiwiZnJvbUNoYXJDb2RlIiwiYnRvYSIsImpvaW4iLCJ0eXBlIiwib25vcGVuIiwiRXJyb3IiLCJzZW5kIiwiX3NlbmQiLCJjaGFycyIsImF0b2IiLCJhcnJheSIsImNoYXJDb2RlQXQiLCJidWZmZXIiLCJjb2RlT3JJZCIsImNsb3NlIl0sIm1hcHBpbmdzIjoic1hBS0EsK0MsbURBQ0EsZ0QsNnhCQU9NQSxtQixPQURMLGlDQUFrQixvQkFBbEIsQyxPQWtCRSxrRSxPQXlGQSxrRSxPQVdBLGtFLE9BZ0JBLGtFLE9BZUEsa0UsaUNBaEpELDRCQUFZQyxNQUFaLENBQStCLHVEQUM3QixLQUFLQSxNQUFMLENBQWNBLE1BQWQsQ0FDQSxLQUFLQyxPQUFMLENBQWUsRUFBZixDQUNELEMsb0ZBWUNDLEcsQ0FDQUMsUyxDQUNBQyxPLENBQ0FDLFEsQ0FDQSxnQkFDQSxHQUFNQyxRQUFTSCxVQUNYLEdBQUlJLFVBQUosQ0FBY0wsR0FBZCxDQUFtQkMsU0FBbkIsQ0FEVyxDQUVYLEdBQUlJLFVBQUosQ0FBY0wsR0FBZCxDQUZKLENBR0FJLE9BQU9FLFVBQVAsQ0FBb0IsYUFBcEIsQ0FDQSxLQUFLUCxPQUFMLENBQWFRLE9BQU9KLFFBQVAs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LEMsa0NBU0lBLFEsQ0FBa0IsQ0FDckIsS0FBTSxJQUFJNkIsTUFBSixDQUNKLHdGQURJLENBQU4sQ0FHRCxDLG9DQVdLUSxRLENBQWtCM0IsTSxDQUF1QlYsUSxDQUF5QixDQUN0RSxHQUFJUSxVQUFKLENBQ0EsR0FBSSxNQUFPRSxPQUFQLEdBQWtCLFdBQWxCLEVBQWlDLE1BQU9WLFNBQVAsR0FBb0IsV0FBekQsQ0FBc0UsQ0FDcEVRLEdBQUtKLE9BQU9KLFFBQVAsQ0FBTCxDQUNBLEdBQU1DLFFBQVMsS0FBS0wsT0FBTCxDQUFhWSxFQUFiLENBQWYsQ0FDQSxHQUFJLENBQUNQLE1BQUwsQ0FBYSxDQUNYLE9BQ0QsQ0FDREEsT0FBT3FDLEtBQVAsQ0FBYUQsUUFBYixDQUF1QjNCLE1BQXZCLEVBQ0QsQ0FQRCxJQU9PLENBQ0xGLEdBQUtKLE9BQU9pQyxRQUFQLENBQUwsQ0FDQSxHQUFNcEMsU0FBUyxLQUFLTCxPQUFMLENBQWFZLEVBQWIsQ0FBZixDQUNBLEdBQUksQ0FBQ1AsT0FBTCxDQUFhLENBQ1gsT0FDRCxDQUNEQSxRQUFPcUMsS0FBUCxHQUNELENBQ0QsTUFBTyxNQUFLMUMsT0FBTCxDQUFhWSxFQUFiLENBQVAsQ0FDRCxDLG13QkFHWWQsa0IiLCJmaWxlIjoiUkNUV2ViU29ja2V0TW9kdWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAcHJvdmlkZXNNb2R1bGUgUkNUV2ViU29ja2V0TW9kdWxlXG4gKiBAZmxvd1xuICovXG5cbmltcG9ydCBpbnZhcmlhbnQgZnJvbSBcIkludmFyaWFudFwiO1xuaW1wb3J0IFJDVEJyaWRnZSwge1xuICBSQ1RfRVhQT1JUX01PRFVMRSxcbiAgUkNUX0VYUE9SVF9NRVRIT0QsXG4gIFJDVEZ1bmN0aW9uVHlwZU5vcm1hbFxufSBmcm9tIFwiUkNUQnJpZGdlXCI7XG5cbkBSQ1RfRVhQT1JUX01PRFVMRShcIlJDVFdlYlNvY2tldE1vZHVsZVwiKVxuY2xhc3MgUkNUV2ViU29ja2V0TW9kdWxlIHtcbiAgYnJpZGdlOiBSQ1RCcmlkZ2U7XG4gIHNvY2tldHM6IHsgW2lkOiBzdHJpbmddOiBXZWJTb2NrZXQgfTtcblxuICBjb25zdHJ1Y3RvcihicmlkZ2U6IFJDVEJyaWRnZSkge1xuICAgIHRoaXMuYnJpZGdlID0gYnJpZGdlO1xuICAgIHRoaXMuc29ja2V0cyA9IHt9O1xuICB9XG5cbiAgLyoqXG4gICAqIEVzdGFibGlzaCBhIGNvbm5lY3Rpb24gYW5kIGFzc29jaWF0ZSB3aXRoIHNvY2tldElELiBzb2NrZXRJRCBpcyB1c2VkIGZvciBmdXR1cmVcbiAgICogY29tbXVuaWNhdGlvbiB3aXRoIFJlYWN0XG4gICAqIEBwYXJhbSB1cmwgLSBzdHJpbmcgVXJsIHRvIGNvbm5lY3QgdG9cbiAgICogQHBhcmFtIHByb3RvY29scyAtIHByb3RvY29scyBmb3IgY3JlYXRpbmcgdGhlIFdlYlNvY2tldCBpbnN0YW5jZVxuICAgKiBAcGFyYW0gb3B0aW9ucyAtIGN1cnJlbnRseSB1bnVzZWRcbiAgICogQHBhcmFtIHNvY2tldElkIC0gSUQgdXNlZCB0byByZXByZXNlbnQgdGhpcyBjb25uZWN0aW9uIGluIFJlYWN0XG4gICAqL1xuICBAUkNUX0VYUE9SVF9NRVRIT0QoUkNURnVuY3Rpb25UeXBlTm9ybWFsKVxuICBjb25uZWN0KFxuICAgIHVybDogc3RyaW5nLFxuICAgIHByb3RvY29sczogc3RyaW5nIHwgQXJyYXk8c3RyaW5nPixcbiAgICBvcHRpb25zOiBhbnksXG4gICAgc29ja2V0SWQ6IG51bWJlclxuICApIHtcbiAgICBjb25zdCBzb2NrZXQgPSBwcm90b2NvbHNcbiAgICAgID8gbmV3IFdlYlNvY2tldCh1cmwsIHByb3RvY29scylcbiAgICAgIDogbmV3IFdlYlNvY2tldCh1cmwpO1xuICAgIHNvY2tldC5iaW5hcnlUeXBlID0gXCJhcnJheWJ1ZmZlclwiO1xuICAgIHRoaXMuc29ja2V0c1tTdHJpbmcoc29ja2V0SWQpXSA9IHNvY2tldDtcblxuICAgIC8vIHNldCB0aGUgb25jbG9zZSwgb25lcnJvciBhbmQgb25tZXNzYWdlIGZ1bmN0aW9ucyBzbyB0aGF0IHRoZVxuICAgIC8vIFJlYWN0IGV2ZW50IGNhbiBiZSBkaXNwYXRjaGVkXG4gICAgc29ja2V0Lm9uY2xvc2UgPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGlkOiBzb2NrZXRJZCxcbiAgICAgICAgY29kZTogZXZlbnQuY29kZSxcbiAgICAgICAgcmVhc29uOiBldmVudC5yZWFzb25cbiAgICAgIH07XG4gICAgICB0aGlzLmJyaWRnZS5lbnF1ZXVlSlNDYWxsKFwiUkNURGV2aWNlRXZlbnRFbWl0dGVyXCIsIFwiZW1pdFwiLCBbXG4gICAgICAgIFwid2Vic29ja2V0Q2xvc2VkXCIsXG4gICAgICAgIHBheWxvYWRcbiAgICAgIF0pO1xuICAgIH07XG4gICAgc29ja2V0Lm9uZXJyb3IgPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGlkOiBzb2NrZXRJZCxcbiAgICAgICAgbWVzc2FnZTogXCJOYXRpdmUgV2ViU29ja2V0IGVycm9yXCJcbiAgICAgIH07XG4gICAgICB0aGlzLmJyaWRnZS5lbnF1ZXVlSlNDYWxsKFwiUkNURGV2aWNlRXZlbnRFbWl0dGVyXCIsIFwiZW1pdFwiLCBbXG4gICAgICAgIFwid2Vic29ja2V0RmFpbGVkXCIsXG4gICAgICAgIHBheWxvYWRcbiAgICAgIF0pO1xuICAgIH07XG4gICAgc29ja2V0Lm9ubWVzc2FnZSA9IChldmVudCkgPT4ge1xuICAgICAgbGV0IGRhdGEgPSBldmVudC5kYXRhO1xuICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikge1xuICAgICAgICAvLyBDb252ZXJ0IGFycmF5YnVmZmVyIHRvIHN0cmluZyBiZWNhdXNlIHRoZSBjdXJyZW50IGJyaWRnZSBmb3JtYXQgaXNcbiAgICAgICAgLy8gYXV0b21hdGljYWxseSBzdHJpbmdpZmllZCB0byBhY2NvdW50IGZvciBtZXRhZGF0YSBhbmQgdG8gc3BlZWQgdXBcbiAgICAgICAgLy8gb2xkZXIgdmVyc2lvbnMgb2YgQmxpbmsuIFdlIG1heSBiZSBhYmxlIHRvIGF2b2lkIHRoaXMgaW5kaXJlY3Rpb25cbiAgICAgICAgLy8gbGF0ZXIgb24uXG4gICAgICAgIGNvbnN0IGFyciA9IG5ldyBVaW50OEFycmF5KGRhdGEpO1xuICAgICAgICBjb25zdCBzdHIgPSBuZXcgQXJyYXkoYXJyLmJ5dGVMZW5ndGgpO1xuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHN0ci5sZW5ndGg7IGkrKykge1xuICAgICAgICAgIHN0cltpXSA9IFN0cmluZy5mcm9tQ2hhckNvZGUoYXJyW2ldKTtcbiAgICAgICAgfVxuICAgICAgICBkYXRhID0gYnRvYShzdHIuam9pbihcIlwiKSk7XG4gICAgICB9XG4gICAgICBjb25zdCBwYXlsb2FkID0ge1xuICAgICAgICBpZDogc29ja2V0SWQsXG4gICAgICAgIHR5cGU6IHR5cGVvZiBldmVudC5kYXRhID09PSBcInN0cmluZ1wiID8gXCJzdHJpbmdcIiA6IFwiYmluYXJ5XCIsXG4gICAgICAgIGRhdGE6IGRhdGFcbiAgICAgIH07XG4gICAgICB0aGlzLmJyaWRnZS5lbnF1ZXVlSlNDYWxsKFwiUkNURGV2aWNlRXZlbnRFbWl0dGVyXCIsIFwiZW1pdFwiLCBbXG4gICAgICAgIFwid2Vic29ja2V0TWVzc2FnZVwiLFxuICAgICAgICBwYXlsb2FkXG4gICAgICBdKTtcbiAgICB9O1xuICAgIHNvY2tldC5vbm9wZW4gPSAoZXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHBheWxvYWQgPSB7XG4gICAgICAgIGlkOiBzb2NrZXRJZFxuICAgICAgfTtcbiAgICAgIHRoaXMuYnJpZGdlLmVucXVldWVKU0NhbGwoXCJSQ1REZXZpY2VFdmVudEVtaXR0ZXJcIiwgXCJlbWl0XCIsIFtcbiAgICAgICAgXCJ3ZWJzb2NrZXRPcGVuXCIsXG4gICAgICAgIHBheWxvYWRcbiAgICAgIF0pO1xuICAgIH07XG4gIH1cblxuICAvKipcbiAgICogaW50ZXJuYWwgZnVuY3Rpb24gdG8gc2VuZCB0aGUgZGF0YVxuICAgKiBtYXBzIHRoZSBSZWFjdCBzb2NrZXRJRCB0byB0aGUgaW5zdGFuY2Ugb2YgV2ViU29ja2V0XG4gICAqL1xuICBfc2VuZChkYXRhOiBzdHJpbmcgfCBBcnJheUJ1ZmZlciwgc29ja2V0SWQ6IG51bWJlcikge1xuICAgIGNvbnN0IHNvY2tldCA9IHRoaXMuc29ja2V0c1tTdHJpbmcoc29ja2V0SWQpXTtcbiAgICBpZiAoIXNvY2tldCkge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiRXJyb3Igd2hpbGUgc2VuZGluZyBkYXRhIHRvIFdlYlNvY2tldDogbm8gc3VjaCBzb2NrZXRcIik7XG4gICAgfVxuICAgIHNvY2tldC5zZW5kKGRhdGEpO1xuICB9XG5cbiAgLyoqXG4gICAqIHNlbmRcbiAgICogZnVuY3Rpb24gY2FsbGVkIGJ5IHRoZSBSZWFjdCBjb2RlIHRocm91Z2ggbWVzc2FnZXNcbiAgICogQHBhcmFtIGRhdGEgLSBkYXRhIGZyb20gcmVhY3RcbiAgICogQHBhcmFtIHNvY2tldElkIC0gUmVhY3Qgc29ja2V0IGlkXG4gICAqL1xuICBAUkNUX0VYUE9SVF9NRVRIT0QoUkNURnVuY3Rpb25UeXBlTm9ybWFsKVxuICBzZW5kKGRhdGE6IHN0cmluZywgc29ja2V0SWQ6IG51bWJlcikge1xuICAgIHRoaXMuX3NlbmQoZGF0YSwgc29ja2V0SWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIHNlbmRCaW5hcnlcbiAgICogZnVuY3Rpb24gY2FsbGVkIGJ5IHRoZSBSZWFjdCBjb2RlIHRocm91Z2ggbWVzc2FnZXNcbiAgICogQHBhcmFtIGRhdGEgLSBkYXRhIGZyb20gcmVhY3RcbiAgICogQHBhcmFtIHNvY2tldElkIC0gUmVhY3Qgc29ja2V0IGlkXG4gICAqL1xuICBAUkNUX0VYUE9SVF9NRVRIT0QoUkNURnVuY3Rpb25UeXBlTm9ybWFsKVxuICBzZW5kQmluYXJ5KGRhdGE6IHN0cmluZywgc29ja2V0SWQ6IG51bWJlcikge1xuICAgIGNvbnN0IGNoYXJzID0gYXRvYihkYXRhKTtcbiAgICBjb25zdCBhcnJheSA9IG5ldyBVaW50OEFycmF5KGNoYXJzLmxlbmd0aCk7XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjaGFycy5sZW5ndGg7IGkrKykge1xuICAgICAgYXJyYXlbaV0gPSBjaGFycy5jaGFyQ29kZUF0KGkpICYgMjU1O1xuICAgIH1cbiAgICB0aGlzLl9zZW5kKGFycmF5LmJ1ZmZlciwgc29ja2V0SWQpO1xuICB9XG5cbiAgLyoqXG4gICAqIHBpbmdcbiAgICogVW5zdXBwb3J0ZWQgaW4gV2ViVlIgZHVlIHRvXG4gICAqIFwiQ2Fubm90IHNlbmQgYSBwaW5nLiBCcm93c2VyIFdlYlNvY2tldCBBUElzIGFyZSBub3QgY2FwYWJsZSBvZiBzZW5kaW5nIHNwZWNpZmljIG9wY29kZXNcIlxuICAgKiBAcGFyYW0gc29ja2V0SWQgLSBSZWFjdCBzb2NrZXQgaWRcbiAgICovXG4gIEBSQ1RfRVhQT1JUX01FVEhPRChSQ1RGdW5jdGlvblR5cGVOb3JtYWwpXG4gIHBpbmcoc29ja2V0SWQ6IG51bWJlcikge1xuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIFwiQ2Fubm90IHNlbmQgYSBwaW5nLiBCcm93c2VyIFdlYlNvY2tldCBBUElzIGFyZSBub3QgY2FwYWJsZSBvZiBzZW5kaW5nIHNwZWNpZmljIG9wY29kZXNcIlxuICAgICk7XG4gIH1cblxuICAvKipcbiAgICogY2xvc2VcbiAgICogZnVuY3Rpb24gY2FsbGVkIGJ5IHRoZSBSZWFjdCBjb2RlIHRocm91Z2ggbWVzc2FnZXNcbiAgICogQHBhcmFtIGNvZGVPcklkIC0gaWYgcmVhc29uIGlzIHVuZGVmaW5lZCBvciBzb2NrZWRJZCBpcyB1bmRlZmluZWQgdGhpcyBpcyBpZCwgb3RoZXJ3aXNlXG4gICAqICAgICAgICAgICAgICAgICAgIGl0IGlzIHRoZSBjb2RlIHRvIHJlcG9ydCB0byB0aGUgd2Vic29ja2V0XG4gICAqIEBwYXJhbSByZWFzb24gLSByZWFzb24gZGlzdHJpYnV0ZWQgdG8gV2ViU29ja2V0IGNsb3NlLCBtYXliZSB1bmRlZmluZWRcbiAgICogQHBhcmFtIHNvY2tldElkIC0gUmVhY3Qgc29ja2V0IGlkIG9yIG1heWJlIHVuZGVmaW5lZCBpbiB3aGljaCBjb2Rlb3JJRCBjb250YWlucyB0aGUgc29ja2V0XG4gICAqL1xuICBAUkNUX0VYUE9SVF9NRVRIT0QoUkNURnVuY3Rpb25UeXBlTm9ybWFsKVxuICBjbG9zZShjb2RlT3JJZDogbnVtYmVyLCByZWFzb246IHZvaWQgfCBzdHJpbmcsIHNvY2tldElkOiB2b2lkIHwgbnVtYmVyKSB7XG4gICAgbGV0IGlkO1xuICAgIGlmICh0eXBlb2YgcmVhc29uICE9PSBcInVuZGVmaW5lZFwiICYmIHR5cGVvZiBzb2NrZXRJZCAhPT0gXCJ1bmRlZmluZWRcIikge1xuICAgICAgaWQgPSBTdHJpbmcoc29ja2V0SWQpO1xuICAgICAgY29uc3Qgc29ja2V0ID0gdGhpcy5zb2NrZXRzW2lkXTtcbiAgICAgIGlmICghc29ja2V0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNvY2tldC5jbG9zZShjb2RlT3JJZCwgcmVhc29uKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWQgPSBTdHJpbmcoY29kZU9ySWQpO1xuICAgICAgY29uc3Qgc29ja2V0ID0gdGhpcy5zb2NrZXRzW2lkXTtcbiAgICAgIGlmICghc29ja2V0KSB7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cbiAgICAgIHNvY2tldC5jbG9zZSgpO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5zb2NrZXRzW2lkXTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RXZWJTb2NrZXRNb2R1bGU7XG4iXX0=