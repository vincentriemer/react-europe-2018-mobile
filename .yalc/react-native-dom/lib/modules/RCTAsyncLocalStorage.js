Object.defineProperty(exports,"__esModule",{value:true});var _slicedToArray2=require("babel-runtime/helpers/slicedToArray");var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_dec2,_dec3,_dec4,_dec5,_class,_desc,_value,_class2;var _RCTBridge=require("./../bridge/RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _idbKeyval=require("idb-keyval");var _idbKeyval2=_interopRequireDefault(_idbKeyval);var _deepmerge=require("deepmerge");var _deepmerge2=_interopRequireDefault(_deepmerge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object['ke'+'ys'](descriptor).forEach(function(key){desc[key]=descriptor[key];});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if('value'in desc||desc.initializer){desc.writable=true;}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc;},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined;}if(desc.initializer===void 0){Object['define'+'Property'](target,property,desc);desc=null;}return desc;}var RCTAsyncLocalStorage=(_dec=(0,_RCTBridge.RCT_EXPORT_MODULE)("RCTAsyncLocalStorage"),_dec2=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec3=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec4=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec5=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec(_class=(_class2=function(){function RCTAsyncLocalStorage(bridge){(0,_classCallCheck3.default)(this,RCTAsyncLocalStorage);this.bridge=bridge;}(0,_createClass3.default)(RCTAsyncLocalStorage,[{key:"multiGet",value:function multiGet(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return _idbKeyval2.default.get(key);})).then(function(result){callback(null,result.map(function(value,index){return[keys[index],value];}));}).catch(function(err){callback(err);});}},{key:"multiMerge",value:function multiMerge(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref){var _ref2=(0,_slicedToArray3.default)(_ref,2),key=_ref2[0],prevValue=_ref2[1];return _idbKeyval2.default.get(key).then(function(nextValue){if(nextValue==null||typeof nextValue!=="object"){return _idbKeyval2.default.set(key,prevValue);}else{return _idbKeyval2.default.set(key,(0,_deepmerge2.default)(prevValue,nextValue));}});})).then(function(){callback();});}},{key:"multiSet",value:function multiSet(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref3){var _ref4=(0,_slicedToArray3.default)(_ref3,2),key=_ref4[0],value=_ref4[1];return _idbKeyval2.default.set(key,value);})).then(function(){callback();});}},{key:"multiRemove",value:function multiRemove(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return _idbKeyval2.default.delete(key);})).then(function(){callback();});}}]);return RCTAsyncLocalStorage;}(),(_applyDecoratedDescriptor(_class2.prototype,"multiGet",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"multiGet"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiMerge",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"multiMerge"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiSet",[_dec4],Object.getOwnPropertyDescriptor(_class2.prototype,"multiSet"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiRemove",[_dec5],Object.getOwnPropertyDescriptor(_class2.prototype,"multiRemove"),_class2.prototype)),_class2))||_class);exports.default=RCTAsyncLocalStorage;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL21vZHVsZXMvUkNUQXN5bmNMb2NhbFN0b3JhZ2UuanMiXSwibmFtZXMiOlsiUkNUQXN5bmNMb2NhbFN0b3JhZ2UiLCJicmlkZ2UiLCJrZXlzIiwiY2FsbGJhY2tJZCIsImNhbGxiYWNrIiwiY2FsbGJhY2tGcm9tSWQiLCJQcm9taXNlIiwiYWxsIiwibWFwIiwia2V5IiwiZ2V0IiwidGhlbiIsInJlc3VsdCIsInZhbHVlIiwiaW5kZXgiLCJjYXRjaCIsImVyciIsImt2UGFpcnMiLCJwcmV2VmFsdWUiLCJuZXh0VmFsdWUiLCJzZXQiLCJkZWxldGUiXSwibWFwcGluZ3MiOiIrZUFLQSxnRCxtREFLQSxxQyxtREFDQSxvQyw2eEJBR01BLHFCLE9BREwsaUNBQWtCLHNCQUFsQixDLE9BUUUsa0UsT0FpQkEsa0UsT0FtQkEsa0UsT0FhQSxrRSxpQ0FyREQsOEJBQVlDLE1BQVosQ0FBK0IseURBQzdCLEtBQUtBLE1BQUwsQ0FBY0EsTUFBZCxDQUNELEMsd0ZBR1FDLEksQ0FBZ0JDLFUsQ0FBb0IsQ0FDM0MsR0FBTUMsVUFBVyxLQUFLSCxNQUFMLENBQVlJLGNBQVosQ0FBMkJGLFVBQTNCLENBQWpCLENBRUFHLFFBQVFDLEdBQVIsQ0FDRUwsS0FBS00sR0FBTCxDQUFTLFNBQUNDLEdBQUQsQ0FBUyxDQUNoQixNQUFPLHFCQUFVQyxHQUFWLENBQWNELEdBQWQsQ0FBUCxDQUNELENBRkQsQ0FERixFQUtHRSxJQUxILENBS1EsU0FBQ0MsTUFBRCxDQUFZLENBQ2hCUixTQUFTLElBQVQsQ0FBZVEsT0FBT0osR0FBUCxDQUFXLFNBQUNLLEtBQUQsQ0FBUUMsS0FBUixRQUFrQixDQUFDWixLQUFLWSxLQUFMLENBQUQsQ0FBY0QsS0FBZCxDQUFsQixFQUFYLENBQWYsRUFDRCxDQVBILEVBUUdFLEtBUkgsQ0FRUyxTQUFDQyxHQUFELENBQVMsQ0FDZFosU0FBU1ksR0FBVCxFQUNELENBVkgsRUFXRCxDLDhDQUdVQyxPLENBQTBCZCxVLENBQW9CLENBQ3ZELEdBQU1DLFVBQVcsS0FBS0gsTUFBTCxDQUFZSSxjQUFaLENBQTJCRixVQUEzQixDQUFqQixDQUVBRyxRQUFRQyxHQUFSLENBQ0VVLFFBQVFULEdBQVIsQ0FBWSxjQUFzQiwrQ0FBcEJDLEdBQW9CLFVBQWZTLFNBQWUsVUFDaEMsTUFBTyxxQkFBVVIsR0FBVixDQUFjRCxHQUFkLEVBQW1CRSxJQUFuQixDQUF3QixTQUFDUSxTQUFELENBQWUsQ0FDNUMsR0FBSUEsV0FBYSxJQUFiLEVBQXFCLE1BQU9BLFVBQVAsR0FBcUIsUUFBOUMsQ0FBd0QsQ0FDdEQsTUFBTyxxQkFBVUMsR0FBVixDQUFjWCxHQUFkLENBQW1CUyxTQUFuQixDQUFQLENBQ0QsQ0FGRCxJQUVPLENBQ0wsTUFBTyxxQkFBVUUsR0FBVixDQUFjWCxHQUFkLENBQW1CLHdCQUFVUyxTQUFWLENBQXFCQyxTQUFyQixDQUFuQixDQUFQLENBQ0QsQ0FDRixDQU5NLENBQVAsQ0FPRCxDQVJELENBREYsRUFVRVIsSUFWRixDQVVPLFVBQU0sQ0FDWFAsV0FDRCxDQVpELEVBYUQsQywwQ0FHUWEsTyxDQUEwQmQsVSxDQUFvQixDQUNyRCxHQUFNQyxVQUFXLEtBQUtILE1BQUwsQ0FBWUksY0FBWixDQUEyQkYsVUFBM0IsQ0FBakIsQ0FFQUcsUUFBUUMsR0FBUixDQUNFVSxRQUFRVCxHQUFSLENBQVksZUFBa0IsZ0RBQWhCQyxHQUFnQixVQUFYSSxLQUFXLFVBQzVCLE1BQU8scUJBQVVPLEdBQVYsQ0FBY1gsR0FBZCxDQUFtQkksS0FBbkIsQ0FBUCxDQUNELENBRkQsQ0FERixFQUlFRixJQUpGLENBSU8sVUFBTSxDQUNYUCxXQUNELENBTkQsRUFPRCxDLGdEQUdXRixJLENBQWdCQyxVLENBQW9CLENBQzlDLEdBQU1DLFVBQVcsS0FBS0gsTUFBTCxDQUFZSSxjQUFaLENBQTJCRixVQUEzQixDQUFqQixDQUVBRyxRQUFRQyxHQUFSLENBQ0VMLEtBQUtNLEdBQUwsQ0FBUyxTQUFDQyxHQUFELENBQVMsQ0FDaEIsTUFBTyxxQkFBVVksTUFBVixDQUFpQlosR0FBakIsQ0FBUCxDQUNELENBRkQsQ0FERixFQUlFRSxJQUpGLENBSU8sVUFBTSxDQUNYUCxXQUNELENBTkQsRUFPRCxDLG1wQkFHWUosb0IiLCJmaWxlIjoiUkNUQXN5bmNMb2NhbFN0b3JhZ2UuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBwcm92aWRlc01vZHVsZSBSQ1RBc3luY0xvY2FsU3RvcmFnZVxuICogQGZsb3dcbiAqL1xuXG5pbXBvcnQgUkNUQnJpZGdlLCB7XG4gIFJDVF9FWFBPUlRfTU9EVUxFLFxuICBSQ1RfRVhQT1JUX01FVEhPRCxcbiAgUkNURnVuY3Rpb25UeXBlTm9ybWFsXG59IGZyb20gXCJSQ1RCcmlkZ2VcIjtcbmltcG9ydCBpZGJLZXl2YWwgZnJvbSBcImlkYi1rZXl2YWxcIjtcbmltcG9ydCBkZWVwbWVyZ2UgZnJvbSBcImRlZXBtZXJnZVwiO1xuXG5AUkNUX0VYUE9SVF9NT0RVTEUoXCJSQ1RBc3luY0xvY2FsU3RvcmFnZVwiKVxuY2xhc3MgUkNUQXN5bmNMb2NhbFN0b3JhZ2Uge1xuICBicmlkZ2U6IFJDVEJyaWRnZTtcblxuICBjb25zdHJ1Y3RvcihicmlkZ2U6IFJDVEJyaWRnZSkge1xuICAgIHRoaXMuYnJpZGdlID0gYnJpZGdlO1xuICB9XG5cbiAgQFJDVF9FWFBPUlRfTUVUSE9EKFJDVEZ1bmN0aW9uVHlwZU5vcm1hbClcbiAgbXVsdGlHZXQoa2V5czogc3RyaW5nW10sIGNhbGxiYWNrSWQ6IG51bWJlcikge1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5icmlkZ2UuY2FsbGJhY2tGcm9tSWQoY2FsbGJhY2tJZCk7XG5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIGtleXMubWFwKChrZXkpID0+IHtcbiAgICAgICAgcmV0dXJuIGlkYktleXZhbC5nZXQoa2V5KTtcbiAgICAgIH0pXG4gICAgKVxuICAgICAgLnRoZW4oKHJlc3VsdCkgPT4ge1xuICAgICAgICBjYWxsYmFjayhudWxsLCByZXN1bHQubWFwKCh2YWx1ZSwgaW5kZXgpID0+IFtrZXlzW2luZGV4XSwgdmFsdWVdKSk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKChlcnIpID0+IHtcbiAgICAgICAgY2FsbGJhY2soZXJyKTtcbiAgICAgIH0pO1xuICB9XG5cbiAgQFJDVF9FWFBPUlRfTUVUSE9EKFJDVEZ1bmN0aW9uVHlwZU5vcm1hbClcbiAgbXVsdGlNZXJnZShrdlBhaXJzOiBbc3RyaW5nLCBhbnldW10sIGNhbGxiYWNrSWQ6IG51bWJlcikge1xuICAgIGNvbnN0IGNhbGxiYWNrID0gdGhpcy5icmlkZ2UuY2FsbGJhY2tGcm9tSWQoY2FsbGJhY2tJZCk7XG5cbiAgICBQcm9taXNlLmFsbChcbiAgICAgIGt2UGFpcnMubWFwKChba2V5LCBwcmV2VmFsdWVdKSA9PiB7XG4gICAgICAgIHJldHVybiBpZGJLZXl2YWwuZ2V0KGtleSkudGhlbigobmV4dFZhbHVlKSA9PiB7XG4gICAgICAgICAgaWYgKG5leHRWYWx1ZSA9PSBudWxsIHx8IHR5cGVvZiBuZXh0VmFsdWUgIT09IFwib2JqZWN0XCIpIHtcbiAgICAgICAgICAgIHJldHVybiBpZGJLZXl2YWwuc2V0KGtleSwgcHJldlZhbHVlKTtcbiAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgcmV0dXJuIGlkYktleXZhbC5zZXQoa2V5LCBkZWVwbWVyZ2UocHJldlZhbHVlLCBuZXh0VmFsdWUpKTtcbiAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgfSlcbiAgICApLnRoZW4oKCkgPT4ge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfVxuXG4gIEBSQ1RfRVhQT1JUX01FVEhPRChSQ1RGdW5jdGlvblR5cGVOb3JtYWwpXG4gIG11bHRpU2V0KGt2UGFpcnM6IFtzdHJpbmcsIGFueV1bXSwgY2FsbGJhY2tJZDogbnVtYmVyKSB7XG4gICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLmJyaWRnZS5jYWxsYmFja0Zyb21JZChjYWxsYmFja0lkKTtcblxuICAgIFByb21pc2UuYWxsKFxuICAgICAga3ZQYWlycy5tYXAoKFtrZXksIHZhbHVlXSkgPT4ge1xuICAgICAgICByZXR1cm4gaWRiS2V5dmFsLnNldChrZXksIHZhbHVlKTtcbiAgICAgIH0pXG4gICAgKS50aGVuKCgpID0+IHtcbiAgICAgIGNhbGxiYWNrKCk7XG4gICAgfSk7XG4gIH1cblxuICBAUkNUX0VYUE9SVF9NRVRIT0QoUkNURnVuY3Rpb25UeXBlTm9ybWFsKVxuICBtdWx0aVJlbW92ZShrZXlzOiBzdHJpbmdbXSwgY2FsbGJhY2tJZDogbnVtYmVyKSB7XG4gICAgY29uc3QgY2FsbGJhY2sgPSB0aGlzLmJyaWRnZS5jYWxsYmFja0Zyb21JZChjYWxsYmFja0lkKTtcblxuICAgIFByb21pc2UuYWxsKFxuICAgICAga2V5cy5tYXAoKGtleSkgPT4ge1xuICAgICAgICByZXR1cm4gaWRiS2V5dmFsLmRlbGV0ZShrZXkpO1xuICAgICAgfSlcbiAgICApLnRoZW4oKCkgPT4ge1xuICAgICAgY2FsbGJhY2soKTtcbiAgICB9KTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RBc3luY0xvY2FsU3RvcmFnZTtcbiJdfQ==