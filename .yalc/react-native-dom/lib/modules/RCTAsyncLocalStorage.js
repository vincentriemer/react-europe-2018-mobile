Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _slicedToArray2=require("babel-runtime/helpers/slicedToArray");var _slicedToArray3=_interopRequireDefault(_slicedToArray2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_dec2,_dec3,_dec4,_dec5,_dec6,_class,_desc,_value,_class2;var _RCTBridge=require("./../bridge/RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _idbKeyval=require("idb-keyval");var _idbKeyval2=_interopRequireDefault(_idbKeyval);var _deepmerge=require("deepmerge");var _deepmerge2=_interopRequireDefault(_deepmerge);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object['ke'+'ys'](descriptor).forEach(function(key){desc[key]=descriptor[key];});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if('value'in desc||desc.initializer){desc.writable=true;}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc;},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined;}if(desc.initializer===void 0){Object['define'+'Property'](target,property,desc);desc=null;}return desc;}var RCTAsyncLocalStorage=(_dec=(0,_RCTBridge.RCT_EXPORT_MODULE)("RCTAsyncLocalStorage"),_dec2=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec3=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec4=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec5=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec6=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec(_class=(_class2=function(){function RCTAsyncLocalStorage(bridge){(0,_classCallCheck3.default)(this,RCTAsyncLocalStorage);this.bridge=bridge;}(0,_createClass3.default)(RCTAsyncLocalStorage,[{key:"multiGet",value:function multiGet(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return _idbKeyval2.default.get(key);})).then(function(result){callback(null,result.map(function(value,index){return[keys[index],value];}));}).catch(function(err){callback(err);});}},{key:"multiMerge",value:function multiMerge(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref){var _ref2=(0,_slicedToArray3.default)(_ref,2),key=_ref2[0],prevValue=_ref2[1];return _idbKeyval2.default.get(key).then(function(nextValue){if(nextValue==null||typeof nextValue!=="object"){return _idbKeyval2.default.set(key,prevValue);}else{return _idbKeyval2.default.set(key,(0,_deepmerge2.default)(prevValue,nextValue));}});})).then(function(){callback();});}},{key:"multiSet",value:function multiSet(kvPairs,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(kvPairs.map(function(_ref3){var _ref4=(0,_slicedToArray3.default)(_ref3,2),key=_ref4[0],value=_ref4[1];return _idbKeyval2.default.set(key,value);})).then(function(){callback();});}},{key:"multiRemove",value:function multiRemove(keys,callbackId){var callback=this.bridge.callbackFromId(callbackId);Promise.all(keys.map(function(key){return _idbKeyval2.default.delete(key);})).then(function(){callback();});}},{key:"getAllKeys",value:function getAllKeys(callbackId){var callback,keys;return _regenerator2.default.async(function getAllKeys$(_context){while(1){switch(_context.prev=_context.next){case 0:callback=this.bridge.callbackFromId(callbackId);_context.prev=1;_context.next=4;return _regenerator2.default.awrap(_idbKeyval2.default.keys());case 4:keys=_context.sent;callback(null,keys);_context.next=11;break;case 8:_context.prev=8;_context.t0=_context["catch"](1);callback(_context.t0,null);case 11:case"end":return _context.stop();}}},null,this,[[1,8]]);}}]);return RCTAsyncLocalStorage;}(),(_applyDecoratedDescriptor(_class2.prototype,"multiGet",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"multiGet"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiMerge",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"multiMerge"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiSet",[_dec4],Object.getOwnPropertyDescriptor(_class2.prototype,"multiSet"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"multiRemove",[_dec5],Object.getOwnPropertyDescriptor(_class2.prototype,"multiRemove"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"getAllKeys",[_dec6],Object.getOwnPropertyDescriptor(_class2.prototype,"getAllKeys"),_class2.prototype)),_class2))||_class);exports.default=RCTAsyncLocalStorage;
//# sourceMappingURL=RCTAsyncLocalStorage.js.map