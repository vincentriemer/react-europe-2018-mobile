Object.defineProperty(exports,"__esModule",{value:true});var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_dec2,_dec3,_class,_desc,_value,_class2;var _RCTBridge=require("./../bridge/RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _cuid=require("cuid");var _cuid2=_interopRequireDefault(_cuid);var _invariant=require("invariant");var _invariant2=_interopRequireDefault(_invariant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _applyDecoratedDescriptor(target,property,decorators,descriptor,context){var desc={};Object['ke'+'ys'](descriptor).forEach(function(key){desc[key]=descriptor[key];});desc.enumerable=!!desc.enumerable;desc.configurable=!!desc.configurable;if('value'in desc||desc.initializer){desc.writable=true;}desc=decorators.slice().reverse().reduce(function(desc,decorator){return decorator(target,property,desc)||desc;},desc);if(context&&desc.initializer!==void 0){desc.value=desc.initializer?desc.initializer.call(context):void 0;desc.initializer=undefined;}if(desc.initializer===void 0){Object['define'+'Property'](target,property,desc);desc=null;}return desc;}var kBlobURIScheme="blob";var RCTBlobManager=(_dec=(0,_RCTBridge.RCT_EXPORT_MODULE)("BlobModule"),_dec2=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec3=(0,_RCTBridge.RCT_EXPORT_METHOD)(_RCTBridge.RCTFunctionTypeNormal),_dec(_class=(_class2=function(){function RCTBlobManager(bridge){(0,_classCallCheck3.default)(this,RCTBlobManager);this.bridge=bridge;this.blobs={};}(0,_createClass3.default)(RCTBlobManager,[{key:"constantsToExport",value:function constantsToExport(){return{BLOB_URI_SCHEME:kBlobURIScheme,BLOB_URI_HOST:null};}},{key:"store",value:function store(data){var blobId=(0,_cuid2.default)();this.storeWithId(data,blobId);return blobId;}},{key:"storeWithId",value:function storeWithId(data,blobId){this.blobs[blobId]=data;}},{key:"resolve",value:function resolve(blob){var blobId=blob["blobId"];var offset=blob["offset"];var size=blob["size"];return this.resolveWithOffsetAndSize(blobId,offset,size);}},{key:"resolveURL",value:function resolveURL(url){var parsedUrl=new URL(url);var blobId=parsedUrl.pathname;var offset=parseInt(parsedUrl.searchParams.get("offset"),10);var size=parseInt(parsedUrl.searchParams.get("size"),10);return this.resolveWithOffsetAndSize(blobId,offset,size);}},{key:"resolveWithOffsetAndSize",value:function resolveWithOffsetAndSize(blobId,offset,size){var data=this.blobs[blobId];if(!data){return null;}if(offset!=0||size!=-1&&size!=data.size){data=data.slice(offset,offset+size);}return data;}},{key:"addNetworkingHandler",value:function addNetworkingHandler(){this.bridge.networking.addRequestHandler(this);this.bridge.networking.addResponseHandler(this);}},{key:"release",value:function release(blobId){delete this.blobs[blobId];}},{key:"canHandleNetworkingRequest",value:function canHandleNetworkingRequest(data){return data.blob!=null;}},{key:"handleNetworkingRequest",value:function handleNetworkingRequest(data){var blob=this.resolve(data.blob);(0,_invariant2.default)(blob,"Could not resolve blob "+data.blob);var contentType="application/octet-stream";var blobType=blob.type;if(blobType!=null&&blob.size!==0){contentType=blob.type;}return{body:blob,contentType:contentType};}},{key:"canHandleNetworkingResponse",value:function canHandleNetworkingResponse(responseType){return responseType==="blob";}},{key:"handleNetworkingResponse",value:function handleNetworkingResponse(response,data){data=data?data:new Blob();return{blobId:this.store(data),offset:0,size:data.size,name:null,type:response.getResponseHeader("content-type")};}}]);return RCTBlobManager;}(),(_applyDecoratedDescriptor(_class2.prototype,"addNetworkingHandler",[_dec2],Object.getOwnPropertyDescriptor(_class2.prototype,"addNetworkingHandler"),_class2.prototype),_applyDecoratedDescriptor(_class2.prototype,"release",[_dec3],Object.getOwnPropertyDescriptor(_class2.prototype,"release"),_class2.prototype)),_class2))||_class);exports.default=RCTBlobManager;
//# sourceMappingURL=RCTBlobManager.js.map