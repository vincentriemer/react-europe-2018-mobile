Object.defineProperty(exports,"__esModule",{value:true});exports.RCTTextEventType=undefined;var _toConsumableArray2=require("babel-runtime/helpers/toConsumableArray");var _toConsumableArray3=_interopRequireDefault(_toConsumableArray2);var _extends2=require("babel-runtime/helpers/extends");var _extends3=_interopRequireDefault(_extends2);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _dec,_class;exports.normalizeInputEventName=normalizeInputEventName;var _RCTBridge=require("./RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _Invariant=require("./../utils/Invariant");var _Invariant2=_interopRequireDefault(_Invariant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}var RCTTextEventType=exports.RCTTextEventType={RCTTextEventTypeFocus:0,RCTTextEventTypeBlur:1,RCTTextEventTypeChange:2,RCTTextEventTypeSubmit:3,RCTTextEventTypeEnd:4,RCTTextEventTypeKeyPress:5};function capitalizeFirstLetter(string){return string.charAt(0).toUpperCase()+string.slice(1);}function normalizeInputEventName(eventName){if(eventName.startsWith("on")){eventName="top"+eventName.substring(2);}else if(!eventName.startsWith("top")){eventName="top"+capitalizeFirstLetter(eventName);}return eventName;}function stringToHash(input){var hash=0,chr=void 0;if(input.length===0)return hash;for(var i=0;i<input.length;i++){chr=input.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0;}return hash;}var RCTEventDispatcher=(_dec=(0,_RCTBridge.RCT_EXPORT_MODULE)("RCTEventDispatcher"),_dec(_class=function(){(0,_createClass3.default)(RCTEventDispatcher,null,[{key:"RCTGetEventID",value:function RCTGetEventID(event){return event.viewTag|(stringToHash(event.eventName)&0xffff)<<32|event.coalescingKey<<48;}}]);function RCTEventDispatcher(bridge){(0,_classCallCheck3.default)(this,RCTEventDispatcher);this.bridge=bridge;this.events={};this.eventQueue=[];this.eventsDispatchScheduled=false;this.observers=new Set();return this;}(0,_createClass3.default)(RCTEventDispatcher,[{key:"sendDeviceEvent",value:function sendDeviceEvent(name,body){this.bridge.enqueueJSCall("RCTDeviceEventEmitter","emit",body?[name,body]:[name]);}},{key:"sendInputEvent",value:function sendInputEvent(name,body){name=normalizeInputEventName(name);this.bridge.enqueueJSCall("RCTEventEmitter","receiveEvent",[body.target,name,body]);}},{key:"sendTextEvent",value:function sendTextEvent(type,reactTag,text,key,eventCount){var events=["focus","blur","change","submitEditing","endEditing","keyPress"];var body={eventCount:eventCount,target:reactTag};if(text){body.text=text;}if(key){}this.sendInputEvent(events[type],body);}},{key:"sendEvent",value:function sendEvent(event){for(var _iterator=this.observers,_isArray=Array.isArray(_iterator),_i=0,_iterator=_isArray?_iterator:_iterator[typeof Symbol==="function"?Symbol.iterator:"@@iterator"]();;){var _ref;if(_isArray){if(_i>=_iterator.length)break;_ref=_iterator[_i++];}else{_i=_iterator.next();if(_i.done)break;_ref=_i.value;}var observer=_ref;observer.eventDispatcherWillDispatchEvent(event);}var eventID=RCTEventDispatcher.RCTGetEventID(event);var previousEvent=this.events[eventID];if(previousEvent){(0,_Invariant2.default)(event.canCoalesce(),"Got event which cannot be coalesced, but has the same eventID "+eventID+" as the previous event");event=previousEvent.coalesceWithEvent(previousEvent);}else{this.eventQueue.push(eventID);}this.events[eventID]=event;var scheduleEventsDispatch=false;if(!this.eventsDispatchScheduled){this.eventsDispatchScheduled=true;scheduleEventsDispatch=true;}if(scheduleEventsDispatch){this.flushEventsQueue();}}},{key:"dispatchEvent",value:function dispatchEvent(event){this.bridge.enqueueJSCallWithDotMethod(event.moduleDotMethod(),event.arguments());}},{key:"flushEventsQueue",value:function flushEventsQueue(){var _this=this;var events=(0,_extends3.default)({},this.events);this.events={};var eventQueue=[].concat((0,_toConsumableArray3.default)(this.eventQueue));this.eventQueue=[];this.eventsDispatchScheduled=false;eventQueue.forEach(function(eventId){_this.dispatchEvent(events[eventId]);});}},{key:"addDispatchObserver",value:function addDispatchObserver(observer){this.observers.add(observer);}},{key:"removeDispatchObserver",value:function removeDispatchObserver(observer){this.observers.delete(observer);}}]);return RCTEventDispatcher;}())||_class);exports.default=RCTEventDispatcher;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL2JyaWRnZS9SQ1RFdmVudERpc3BhdGNoZXIuanMiXSwibmFtZXMiOlsibm9ybWFsaXplSW5wdXRFdmVudE5hbWUiLCJSQ1RUZXh0RXZlbnRUeXBlIiwiUkNUVGV4dEV2ZW50VHlwZUZvY3VzIiwiUkNUVGV4dEV2ZW50VHlwZUJsdXIiLCJSQ1RUZXh0RXZlbnRUeXBlQ2hhbmdlIiwiUkNUVGV4dEV2ZW50VHlwZVN1Ym1pdCIsIlJDVFRleHRFdmVudFR5cGVFbmQiLCJSQ1RUZXh0RXZlbnRUeXBlS2V5UHJlc3MiLCJjYXBpdGFsaXplRmlyc3RMZXR0ZXIiLCJzdHJpbmciLCJjaGFyQXQiLCJ0b1VwcGVyQ2FzZSIsInNsaWNlIiwiZXZlbnROYW1lIiwic3RhcnRzV2l0aCIsInN1YnN0cmluZyIsInN0cmluZ1RvSGFzaCIsImlucHV0IiwiaGFzaCIsImNociIsImxlbmd0aCIsImkiLCJjaGFyQ29kZUF0IiwiUkNURXZlbnREaXNwYXRjaGVyIiwiZXZlbnQiLCJ2aWV3VGFnIiwiY29hbGVzY2luZ0tleSIsImJyaWRnZSIsImV2ZW50cyIsImV2ZW50UXVldWUiLCJldmVudHNEaXNwYXRjaFNjaGVkdWxlZCIsIm9ic2VydmVycyIsIlNldCIsIm5hbWUiLCJib2R5IiwiZW5xdWV1ZUpTQ2FsbCIsInRhcmdldCIsInR5cGUiLCJyZWFjdFRhZyIsInRleHQiLCJrZXkiLCJldmVudENvdW50Iiwic2VuZElucHV0RXZlbnQiLCJvYnNlcnZlciIsImV2ZW50RGlzcGF0Y2hlcldpbGxEaXNwYXRjaEV2ZW50IiwiZXZlbnRJRCIsIlJDVEdldEV2ZW50SUQiLCJwcmV2aW91c0V2ZW50IiwiY2FuQ29hbGVzY2UiLCJjb2FsZXNjZVdpdGhFdmVudCIsInB1c2giLCJzY2hlZHVsZUV2ZW50c0Rpc3BhdGNoIiwiZmx1c2hFdmVudHNRdWV1ZSIsImVucXVldWVKU0NhbGxXaXRoRG90TWV0aG9kIiwibW9kdWxlRG90TWV0aG9kIiwiYXJndW1lbnRzIiwiZm9y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QUtBLFVBQXRCLEVBQU4sQ0FDQSxLQUFLQSxVQUFMLENBQWtCLEVBQWxCLENBRUEsS0FBS0MsdUJBQUwsQ0FBK0IsS0FBL0IsQ0FFQUQsV0FBVzJCLE9BQVgsQ0FBbUIsU0FBQ0MsT0FBRCxDQUFhLENBQzlCLE1BQUtDLGFBQUwsQ0FBbUI5QixPQUFPNkIsT0FBUCxDQUFuQixFQUNELENBRkQsRUFHRCxDLGdFQUVtQmQsUSxDQUFzQyxDQUN4RCxLQUFLWixTQUFMLENBQWU0QixHQUFmLENBQW1CaEIsUUFBbkIsRUFDRCxDLHNFQUVzQkEsUSxDQUFzQyxDQUMzRCxLQUFLWixTQUFMLENBQWU2QixNQUFmLENBQXNCakIsUUFBdEIsRUFDRCxDLDREQUdZcEIsa0IiLCJmaWxlIjoiUkNURXZlbnREaXNwYXRjaGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBAcHJvdmlkZXNNb2R1bGUgUkNURXZlbnREaXNwYXRjaGVyXG4gKiBAZmxvd1xuICovXG5cbmltcG9ydCBSQ1RCcmlkZ2UsIHtcbiAgUkNUX0VYUE9SVF9NT0RVTEUsXG4gIFJDVF9FWFBPUlRfTUVUSE9ELFxuICBSQ1RGdW5jdGlvblR5cGVOb3JtYWxcbn0gZnJvbSBcIlJDVEJyaWRnZVwiO1xuaW1wb3J0IGludmFyaWFudCBmcm9tIFwiSW52YXJpYW50XCI7XG5cbmV4cG9ydCBjb25zdCBSQ1RUZXh0RXZlbnRUeXBlID0ge1xuICBSQ1RUZXh0RXZlbnRUeXBlRm9jdXM6IDAsXG4gIFJDVFRleHRFdmVudFR5cGVCbHVyOiAxLFxuICBSQ1RUZXh0RXZlbnRUeXBlQ2hhbmdlOiAyLFxuICBSQ1RUZXh0RXZlbnRUeXBlU3VibWl0OiAzLFxuICBSQ1RUZXh0RXZlbnRUeXBlRW5kOiA0LFxuICBSQ1RUZXh0RXZlbnRUeXBlS2V5UHJlc3M6IDVcbn07XG5cbmV4cG9ydCBpbnRlcmZhY2UgUkNURXZlbnQge1xuICB2aWV3VGFnOiBudW1iZXI7XG4gIGV2ZW50TmFtZTogc3RyaW5nO1xuICBjb2FsZXNjaW5nS2V5OiBudW1iZXI7XG5cbiAgY2FuQ29hbGVzY2UoKTogYm9vbGVhbjtcbiAgY29hbGVzY2VXaXRoRXZlbnQoZXZlbnQ6IFJDVEV2ZW50KTogUkNURXZlbnQ7XG5cbiAgbW9kdWxlRG90TWV0aG9kKCk6IHN0cmluZztcbiAgYXJndW1lbnRzKCk6IEFycmF5PGFueT47XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgUkNURXZlbnREaXNwYXRjaGVyT2JzZXJ2ZXIge1xuICBldmVudERpc3BhdGNoZXJXaWxsRGlzcGF0Y2hFdmVudChldmVudDogUkNURXZlbnQpOiB2b2lkO1xufVxuXG5mdW5jdGlvbiBjYXBpdGFsaXplRmlyc3RMZXR0ZXIoc3RyaW5nKSB7XG4gIHJldHVybiBzdHJpbmcuY2hhckF0KDApLnRvVXBwZXJDYXNlKCkgKyBzdHJpbmcuc2xpY2UoMSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBub3JtYWxpemVJbnB1dEV2ZW50TmFtZShldmVudE5hbWU6IHN0cmluZykge1xuICBpZiAoZXZlbnROYW1lLnN0YXJ0c1dpdGgoXCJvblwiKSkge1xuICAgIGV2ZW50TmFtZSA9IGB0b3Ake2V2ZW50TmFtZS5zdWJzdHJpbmcoMil9YDtcbiAgfSBlbHNlIGlmICghZXZlbnROYW1lLnN0YXJ0c1dpdGgoXCJ0b3BcIikpIHtcbiAgICBldmVudE5hbWUgPSBgdG9wJHtjYXBpdGFsaXplRmlyc3RMZXR0ZXIoZXZlbnROYW1lKX1gO1xuICB9XG5cbiAgcmV0dXJuIGV2ZW50TmFtZTtcbn1cblxuZnVuY3Rpb24gc3RyaW5nVG9IYXNoKGlucHV0OiBzdHJpbmcpOiBudW1iZXIge1xuICBsZXQgaGFzaCA9IDAsXG4gICAgY2hyO1xuICBpZiAoaW5wdXQubGVuZ3RoID09PSAwKSByZXR1cm4gaGFzaDtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKykge1xuICAgIGNociA9IGlucHV0LmNoYXJDb2RlQXQoaSk7XG4gICAgaGFzaCA9IChoYXNoIDw8IDUpIC0gaGFzaCArIGNocjtcbiAgICBoYXNoIHw9IDA7IC8vIENvbnZlcnQgdG8gMzJiaXQgaW50ZWdlclxuICB9XG4gIHJldHVybiBoYXNoO1xufVxuXG5AUkNUX0VYUE9SVF9NT0RVTEUoXCJSQ1RFdmVudERpc3BhdGNoZXJcIilcbmNsYXNzIFJDVEV2ZW50RGlzcGF0Y2hlciB7XG4gIGJyaWRnZTogUkNUQnJpZGdlO1xuICBldmVudHM6IHsgW251bWJlcl06IFJDVEV2ZW50IH07XG4gIGV2ZW50UXVldWU6IEFycmF5PG51bWJlcj47XG4gIC8vIHF1ZXVlTG9jayA/P1xuICBldmVudHNEaXNwYXRjaFNjaGVkdWxlZDogYm9vbGVhbjtcbiAgb2JzZXJ2ZXJzOiBTZXQ8UkNURXZlbnREaXNwYXRjaGVyT2JzZXJ2ZXI+O1xuICAvLyBvYnNlcnZlcnNMb2NrID8/XG5cbiAgc3RhdGljIFJDVEdldEV2ZW50SUQoZXZlbnQ6IFJDVEV2ZW50KTogbnVtYmVyIHtcbiAgICByZXR1cm4gKFxuICAgICAgZXZlbnQudmlld1RhZyB8XG4gICAgICAoKHN0cmluZ1RvSGFzaChldmVudC5ldmVudE5hbWUpICYgMHhmZmZmKSA8PCAzMikgfFxuICAgICAgKGV2ZW50LmNvYWxlc2NpbmdLZXkgPDwgNDgpXG4gICAgKTtcbiAgfVxuXG4gIGNvbnN0cnVjdG9yKGJyaWRnZTogUkNUQnJpZGdlKSB7XG4gICAgdGhpcy5icmlkZ2UgPSBicmlkZ2U7XG4gICAgdGhpcy5ldmVudHMgPSB7fTtcbiAgICB0aGlzLmV2ZW50UXVldWUgPSBbXTtcbiAgICB0aGlzLmV2ZW50c0Rpc3BhdGNoU2NoZWR1bGVkID0gZmFsc2U7XG4gICAgdGhpcy5vYnNlcnZlcnMgPSBuZXcgU2V0KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH1cblxuICBzZW5kRGV2aWNlRXZlbnQobmFtZTogc3RyaW5nLCBib2R5OiA/T2JqZWN0KSB7XG4gICAgdGhpcy5icmlkZ2UuZW5xdWV1ZUpTQ2FsbChcbiAgICAgIFwiUkNURGV2aWNlRXZlbnRFbWl0dGVyXCIsXG4gICAgICBcImVtaXRcIixcbiAgICAgIGJvZHkgPyBbbmFtZSwgYm9keV0gOiBbbmFtZV1cbiAgICApO1xuICB9XG5cbiAgc2VuZElucHV0RXZlbnQobmFtZTogc3RyaW5nLCBib2R5OiBPYmplY3QpIHtcbiAgICBuYW1lID0gbm9ybWFsaXplSW5wdXRFdmVudE5hbWUobmFtZSk7XG4gICAgdGhpcy5icmlkZ2UuZW5xdWV1ZUpTQ2FsbChcIlJDVEV2ZW50RW1pdHRlclwiLCBcInJlY2VpdmVFdmVudFwiLCBbXG4gICAgICBib2R5LnRhcmdldCxcbiAgICAgIG5hbWUsXG4gICAgICBib2R5XG4gICAgXSk7XG4gIH1cblxuICAvKipcbiAgICogU2VuZCBhIHRleHQgaW5wdXQvZm9jdXMgZXZlbnQuIEZvciBpbnRlcm5hbCB1c2Ugb25seS5cbiAgICovXG4gIHNlbmRUZXh0RXZlbnQoXG4gICAgdHlwZTogbnVtYmVyLFxuICAgIHJlYWN0VGFnOiBudW1iZXIsXG4gICAgdGV4dDogc3RyaW5nLFxuICAgIGtleTogc3RyaW5nLFxuICAgIGV2ZW50Q291bnQ6IG51bWJlclxuICApIHtcbiAgICBjb25zdCBldmVudHMgPSBbXG4gICAgICBcImZvY3VzXCIsXG4gICAgICBcImJsdXJcIixcbiAgICAgIFwiY2hhbmdlXCIsXG4gICAgICBcInN1Ym1pdEVkaXRpbmdcIixcbiAgICAgIFwiZW5kRWRpdGluZ1wiLFxuICAgICAgXCJrZXlQcmVzc1wiXG4gICAgXTtcblxuICAgIGNvbnN0IGJvZHk6IE9iamVjdCA9IHtcbiAgICAgIGV2ZW50Q291bnQsXG4gICAgICB0YXJnZXQ6IHJlYWN0VGFnXG4gICAgfTtcblxuICAgIGlmICh0ZXh0KSB7XG4gICAgICBib2R5LnRleHQgPSB0ZXh0O1xuICAgIH1cblxuICAgIGlmIChrZXkpIHtcbiAgICAgIC8vIFRPRE86IEtleSBFdmVudCBIYW5kbGluZ1xuICAgIH1cblxuICAgIHRoaXMuc2VuZElucHV0RXZlbnQoZXZlbnRzW3R5cGVdLCBib2R5KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBTZW5kIGEgcHJlLXByZXBhcmVkIGV2ZW50IG9iamVjdC5cbiAgICpcbiAgICogRXZlbnRzIGFyZSBzZW50IHRvIEpTIGFzIHNvb24gYXMgdGhlIHRocmVhZCBpcyBmcmVlIHRvIHByb2Nlc3MgdGhlbS5cbiAgICogSWYgYW4gZXZlbnQgY2FuIGJlIGNvYWxlc2NlZCBhbmQgdGhlcmUgaXMgYW5vdGhlciBjb21wYXRpYmxlIGV2ZW50IHdhaXRpbmcsIHRoZSBjb2FsZXNjaW5nIHdpbGwgaGFwcGVuIGltbWVkaWF0ZWx5LlxuICAgKi9cbiAgc2VuZEV2ZW50KGV2ZW50OiBSQ1RFdmVudCkge1xuICAgIGZvciAobGV0IG9ic2VydmVyIG9mIHRoaXMub2JzZXJ2ZXJzKSB7XG4gICAgICBvYnNlcnZlci5ldmVudERpc3BhdGNoZXJXaWxsRGlzcGF0Y2hFdmVudChldmVudCk7XG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnRJRCA9IFJDVEV2ZW50RGlzcGF0Y2hlci5SQ1RHZXRFdmVudElEKGV2ZW50KTtcblxuICAgIGNvbnN0IHByZXZpb3VzRXZlbnQgPSB0aGlzLmV2ZW50c1tldmVudElEXTtcbiAgICBpZiAocHJldmlvdXNFdmVudCkge1xuICAgICAgaW52YXJpYW50KFxuICAgICAgICBldmVudC5jYW5Db2FsZXNjZSgpLFxuICAgICAgICBgR290IGV2ZW50IHdoaWNoIGNhbm5vdCBiZSBjb2FsZXNjZWQsIGJ1dCBoYXMgdGhlIHNhbWUgZXZlbnRJRCAke2V2ZW50SUR9IGFzIHRoZSBwcmV2aW91cyBldmVudGBcbiAgICAgICk7XG4gICAgICBldmVudCA9IHByZXZpb3VzRXZlbnQuY29hbGVzY2VXaXRoRXZlbnQocHJldmlvdXNFdmVudCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuZXZlbnRRdWV1ZS5wdXNoKGV2ZW50SUQpO1xuICAgIH1cblxuICAgIHRoaXMuZXZlbnRzW2V2ZW50SURdID0gZXZlbnQ7XG5cbiAgICBsZXQgc2NoZWR1bGVFdmVudHNEaXNwYXRjaCA9IGZhbHNlO1xuICAgIGlmICghdGhpcy5ldmVudHNEaXNwYXRjaFNjaGVkdWxlZCkge1xuICAgICAgdGhpcy5ldmVudHNEaXNwYXRjaFNjaGVkdWxlZCA9IHRydWU7XG4gICAgICBzY2hlZHVsZUV2ZW50c0Rpc3BhdGNoID0gdHJ1ZTtcbiAgICB9XG5cbiAgICBpZiAoc2NoZWR1bGVFdmVudHNEaXNwYXRjaCkge1xuICAgICAgdGhpcy5mbHVzaEV2ZW50c1F1ZXVlKCk7XG4gICAgfVxuICB9XG5cbiAgZGlzcGF0Y2hFdmVudChldmVudDogUkNURXZlbnQpIHtcbiAgICB0aGlzLmJyaWRnZS5lbnF1ZXVlSlNDYWxsV2l0aERvdE1ldGhvZChcbiAgICAgIGV2ZW50Lm1vZHVsZURvdE1ldGhvZCgpLFxuICAgICAgZXZlbnQuYXJndW1lbnRzKClcbiAgICApO1xuICB9XG5cbiAgZmx1c2hFdmVudHNRdWV1ZSgpIHtcbiAgICBjb25zdCBldmVudHMgPSB7IC4uLnRoaXMuZXZlbnRzIH07XG4gICAgdGhpcy5ldmVudHMgPSB7fTtcblxuICAgIGNvbnN0IGV2ZW50UXVldWUgPSBbLi4udGhpcy5ldmVudFF1ZXVlXTtcbiAgICB0aGlzLmV2ZW50UXVldWUgPSBbXTtcblxuICAgIHRoaXMuZXZlbnRzRGlzcGF0Y2hTY2hlZHVsZWQgPSBmYWxzZTtcblxuICAgIGV2ZW50UXVldWUuZm9yRWFjaCgoZXZlbnRJZCkgPT4ge1xuICAgICAgdGhpcy5kaXNwYXRjaEV2ZW50KGV2ZW50c1tldmVudElkXSk7XG4gICAgfSk7XG4gIH1cblxuICBhZGREaXNwYXRjaE9ic2VydmVyKG9ic2VydmVyOiBSQ1RFdmVudERpc3BhdGNoZXJPYnNlcnZlcikge1xuICAgIHRoaXMub2JzZXJ2ZXJzLmFkZChvYnNlcnZlcik7XG4gIH1cblxuICByZW1vdmVEaXNwYXRjaE9ic2VydmVyKG9ic2VydmVyOiBSQ1RFdmVudERpc3BhdGNoZXJPYnNlcnZlcikge1xuICAgIHRoaXMub2JzZXJ2ZXJzLmRlbGV0ZShvYnNlcnZlcik7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgUkNURXZlbnREaXNwYXRjaGVyO1xuIl19