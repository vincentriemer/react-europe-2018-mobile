Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _dec,_class;var _RCTBridge=require("./RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _UIView2=require("./../base/UIView");var _UIView3=_interopRequireDefault(_UIView2);var _NotificationCenter=require("./../base/NotificationCenter");var _NotificationCenter2=_interopRequireDefault(_NotificationCenter);var _RCTDeviceInfo=require("./../modules/RCTDeviceInfo");var _RCTDeviceInfo2=_interopRequireDefault(_RCTDeviceInfo);var _RCTTiming=require("./../modules/RCTTiming");var _RCTTiming2=_interopRequireDefault(_RCTTiming);var _RCTTouchHandler=require("./../modules/RCTTouchHandler");var _RCTTouchHandler2=_interopRequireDefault(_RCTTouchHandler);var _CustomElement=require("./../utils/CustomElement");var _CustomElement2=_interopRequireDefault(_CustomElement);var _Instrument=require("./../utils/Instrument");var _Instrument2=_interopRequireDefault(_Instrument);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function getAvailableSize(){return{width:window.innerWidth,height:window.innerHeight};}var RCTRootView=(_dec=(0,_CustomElement2.default)("rct-root-view"),_dec(_class=function(_UIView){(0,_inherits3.default)(RCTRootView,_UIView);function RCTRootView(bundle,moduleName,parent){var enableHotReload=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var nativeModules=arguments[4];(0,_classCallCheck3.default)(this,RCTRootView);var _this=(0,_possibleConstructorReturn3.default)(this,(RCTRootView.__proto__||Object.getPrototypeOf(RCTRootView)).call(this));_this.bundleLocation=bundle;_this.enableHotReload=enableHotReload;_this.moduleName=moduleName;_this.parent=parent;if(_this.enableHotReload){bundle+="&hot=true";}var bridge=new _RCTBridge2.default(moduleName,bundle,nativeModules);_this.initialization=_this.initializeBridge(bridge);return _this;}(0,_createClass3.default)(RCTRootView,[{key:"initializeBridge",value:function initializeBridge(bridge){var deviceInfoModule,dimensions;return _regenerator2.default.async(function initializeBridge$(_context){while(1){switch(_context.prev=_context.next){case 0:this.bridge=bridge;this.bridge.bundleFinishedLoading=this.bundleFinishedLoading.bind(this);_context.next=4;return _regenerator2.default.awrap(this.bridge.initializeModules());case 4:deviceInfoModule=this.bridge.modulesByName["DeviceInfo"];dimensions=deviceInfoModule.exportedDimensions().window;this.availableSize={width:dimensions.width,height:dimensions.height};this.width=this.availableSize.width;this.height=this.availableSize.height;this.uiManager=this.bridge.uiManager;this.timing=this.bridge.modulesByName["Timing"];this.touchHandler=new _RCTTouchHandler2.default(this.bridge);this.touchHandler.attachToView(this);this.updateHostStyle({WebkitTapHighlightColor:"transparent",userSelect:"none",overflow:"hidden",position:"fixed"});this.ticking=false;case 15:case"end":return _context.stop();}}},null,this);}},{key:"bundleFinishedLoading",value:function bundleFinishedLoading(){this.runApplication();}},{key:"runApplication",value:function runApplication(){var appParameters={rootTag:this.reactTag,initialProps:{}};this.bridge.enqueueJSCall("AppRegistry","runApplication",[this.moduleName,appParameters]);if(this.enableHotReload){var bundleURL=new URL(this.bundleLocation);console.warn("HotReload on "+this.bundleLocation);this.bridge.enqueueJSCall("HMRClient","enable",["dom",bundleURL.pathname.toString().substr(1),bundleURL.hostname,bundleURL.port]);}this.requestTick();}},{key:"requestTick",value:function requestTick(){if(!this.ticking){window.requestAnimationFrame(this.renderLoop.bind(this));}this.ticking=true;}},{key:"renderLoop",value:function renderLoop(){var _this2=this;var frameStart;return _regenerator2.default.async(function renderLoop$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.ticking=false;frameStart=window.performance?performance.now():Date.now();_context2.next=4;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Timing",function(){return _this2.timing.frame();}));case 4:_context2.next=6;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Bridge",function(){return _this2.bridge.frame();}));case 6:_context2.next=8;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Rendering",function(){return _this2.uiManager.frame();}));case 8:_context2.next=10;return _regenerator2.default.awrap(this.timing.idle(frameStart));case 10:if(this.timing.shouldContinue()||this.bridge.shouldContinue()||this.uiManager.shouldContinue()){this.requestTick();}case 11:case"end":return _context2.stop();}}},null,this);}},{key:"render",value:function render(){return _regenerator2.default.async(function render$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regenerator2.default.awrap(this.initialization);case 2:this.parent.appendChild(this);this.bridge.loadBridgeConfig();this.requestTick();case 5:case"end":return _context3.stop();}}},null,this);}},{key:"reactTag",get:function get(){if(!this._reactTag){this._reactTag=this.uiManager.allocateRootTag;this.uiManager.registerRootView(this);}return this._reactTag;},set:function set(value){}}]);return RCTRootView;}(_UIView3.default))||_class);exports.default=RCTRootView;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL1JlYWN0RG9tL2JyaWRnZS9SQ1RSb290Vmlldy5qcyJdLCJuYW1lcyI6WyJnZXRBdmFpbGFibGVTaXplIiwid2lkdGgiLCJ3aW5kb3ciLCJpbm5lcldpZHRoIiwiaGVpZ2h0IiwiaW5uZXJIZWlnaHQiLCJSQ1RSb290VmlldyIsImJ1bmRsZSIsIm1vZHVsZU5hbWUiLCJwYXJlbnQiLCJlbmFibGVIb3RSZWxvYWQiLCJuYXRpdmVNb2R1bGVzIiwiYnVuZGxlTG9jYXRpb24iLCJicmlkZ2UiLCJpbml0aWFsaXphdGlvbiIsImluaXRpYWxpemVCcmlkZ2UiLCJidW5kbGVGaW5pc2hlZExvYWRpbmciLCJiaW5kIiwiaW5pdGlhbGl6ZU1vZHVsZXMiLCJkZXZpY2VJbmZvTW9kdWxlIiwibW9kdWxlc0J5TmFtZSIsImRpbWVuc2lvbnMiLCJleHBvcnRlZERpbWVuc2lvbnMiLCJhdmFpbGFibGVTaXplIiwidWlNYW5hZ2VyIiwidGltaW5nIiwidG91Y2hIYW5kbGVyIiwiYXR0YWNoVG9WaWV3IiwidXBkYXRlSG9zdFN0eWxlIiwiV2Via2l0VGFwSGlnaGxpZ2h0Q29sb3IiLCJ1c2VyU2VsZWN0Iiwib3ZlcmZsb3ciLCJwb3NpdGlvbiIsInRpY2tpbmciLCJydW5BcHBsaWNhdGlvbiIsImFwcFBhcmFtZXRlcnMiLCJyb290VGFnIiwicmVhY3RUYWciLCJpbml0aWFsUHJvcHMiLCJlbnF1ZXVlSlNDYWxsIiwiYnVuZGxlVVJMIiwiVVJMIiwiY29uc29sZSIsIndhcm4iLCJwYXRobmFtZSIsInRvU3RyaW5nIiwic3Vic3RyIiwiaG9zdG5hbWUiLCJwb3J0IiwicmVxdWVzdFRpY2siLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJyZW5kZXJMb29wIiwiZnJhbWVTdGFydCIsInBlcmZvcm1hbmNlIiwibm93IiwiRGF0ZSIsImZyYW1lIiwiaWRsZSIsInNob3VsZENvbnRpbnVlIiwiYXBwZW5kQ2hpbGQiLCJsb2FkQnJpZGdlQ29uZmlnIiwiX3JlYWN0VGFnIiwi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LEtBQUt0QyxTQUFMLENBQWV1QyxnQkFBZixDQUFnQyxJQUFoQyxFQUNELENBQ0QsTUFBTyxNQUFLRixTQUFaLENBQ0QsQyxrQkFFWUcsSyxDQUFlLENBQUUsQyxxRUFtRWpCMUQsVyIsImZpbGUiOiJSQ1RSb290Vmlldy5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQHByb3ZpZGVzTW9kdWxlIFJDVFJvb3RWaWV3XG4gKiBAZmxvd1xuICovXG5pbXBvcnQgUkNUQnJpZGdlIGZyb20gXCJSQ1RCcmlkZ2VcIjtcbmltcG9ydCBVSVZpZXcsIHsgRnJhbWVaZXJvIH0gZnJvbSBcIlVJVmlld1wiO1xuaW1wb3J0IE5vdGlmaWNhdGlvbkNlbnRlciBmcm9tIFwiTm90aWZpY2F0aW9uQ2VudGVyXCI7XG5pbXBvcnQgUkNURGV2aWNlSW5mbyBmcm9tIFwiUkNURGV2aWNlSW5mb1wiO1xuaW1wb3J0IFJDVFRpbWluZyBmcm9tIFwiUkNUVGltaW5nXCI7XG5pbXBvcnQgUkNUVG91Y2hIYW5kbGVyIGZyb20gXCJSQ1RUb3VjaEhhbmRsZXJcIjtcbmltcG9ydCBDdXN0b21FbGVtZW50IGZyb20gXCJDdXN0b21FbGVtZW50XCI7XG5pbXBvcnQgaW5zdHJ1bWVudCBmcm9tIFwiSW5zdHJ1bWVudFwiO1xuXG5pbXBvcnQgdHlwZSB7IE5hdGl2ZU1vZHVsZUltcG9ydHMgfSBmcm9tIFwiUkNUTW9kdWxlXCI7XG5cbmZ1bmN0aW9uIGdldEF2YWlsYWJsZVNpemUoKSB7XG4gIHJldHVybiB7XG4gICAgd2lkdGg6IHdpbmRvdy5pbm5lcldpZHRoLFxuICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0XG4gIH07XG59XG5cbkBDdXN0b21FbGVtZW50KFwicmN0LXJvb3Qtdmlld1wiKVxuLy8gJEZsb3dGaXhNZVxuY2xhc3MgUkNUUm9vdFZpZXcgZXh0ZW5kcyBVSVZpZXcge1xuICBfcmVhY3RUYWc6IG51bWJlcjtcblxuICBicmlkZ2U6IFJDVEJyaWRnZTtcbiAgcmVuZGVyUm9vdDogSFRNTEVsZW1lbnQ7XG4gIG1vZHVsZU5hbWU6IHN0cmluZztcbiAgYXZhaWxhYmxlU2l6ZTogU2l6ZTtcbiAgcGFyZW50OiBFbGVtZW50O1xuICB1aU1hbmFnZXI6ICo7XG4gIHRpbWluZzogUkNUVGltaW5nO1xuICB0aWNraW5nOiBib29sZWFuO1xuICBidW5kbGVMb2NhdGlvbjogc3RyaW5nO1xuICBlbmFibGVIb3RSZWxvYWQ6IGJvb2xlYW47XG5cbiAgdG91Y2hIYW5kbGVyOiBSQ1RUb3VjaEhhbmRsZXI7XG5cbiAgaW5pdGlhbGl6YXRpb246IFByb21pc2U8dm9pZD47XG5cbiAgY29uc3RydWN0b3IoXG4gICAgYnVuZGxlOiBzdHJpbmcsXG4gICAgbW9kdWxlTmFtZTogc3RyaW5nLFxuICAgIHBhcmVudDogRWxlbWVudCxcbiAgICBlbmFibGVIb3RSZWxvYWQ6IGJvb2xlYW4gPSBmYWxzZSxcbiAgICBuYXRpdmVNb2R1bGVzOiBOYXRpdmVNb2R1bGVJbXBvcnRzXG4gICkge1xuICAgIHN1cGVyKCk7XG5cbiAgICB0aGlzLmJ1bmRsZUxvY2F0aW9uID0gYnVuZGxlO1xuICAgIHRoaXMuZW5hYmxlSG90UmVsb2FkID0gZW5hYmxlSG90UmVsb2FkO1xuICAgIHRoaXMubW9kdWxlTmFtZSA9IG1vZHVsZU5hbWU7XG4gICAgdGhpcy5wYXJlbnQgPSBwYXJlbnQ7XG5cbiAgICBpZiAodGhpcy5lbmFibGVIb3RSZWxvYWQpIHtcbiAgICAgIGJ1bmRsZSArPSBcIiZob3Q9dHJ1ZVwiO1xuICAgIH1cblxuICAgIGNvbnN0IGJyaWRnZSA9IG5ldyBSQ1RCcmlkZ2UobW9kdWxlTmFtZSwgYnVuZGxlLCBuYXRpdmVNb2R1bGVzKTtcbiAgICB0aGlzLmluaXRpYWxpemF0aW9uID0gdGhpcy5pbml0aWFsaXplQnJpZGdlKGJyaWRnZSk7XG4gIH1cblxuICBhc3luYyBpbml0aWFsaXplQnJpZGdlKGJyaWRnZTogUkNUQnJpZGdlKSB7XG4gICAgdGhpcy5icmlkZ2UgPSBicmlkZ2U7XG4gICAgdGhpcy5icmlkZ2UuYnVuZGxlRmluaXNoZWRMb2FkaW5nID0gdGhpcy5idW5kbGVGaW5pc2hlZExvYWRpbmcuYmluZCh0aGlzKTtcblxuICAgIGF3YWl0IHRoaXMuYnJpZGdlLmluaXRpYWxpemVNb2R1bGVzKCk7XG5cbiAgICBjb25zdCBkZXZpY2VJbmZvTW9kdWxlOiBSQ1REZXZpY2VJbmZvID0gKHRoaXMuYnJpZGdlLm1vZHVsZXNCeU5hbWVbXG4gICAgICBcIkRldmljZUluZm9cIlxuICAgIF06IGFueSk7XG5cbiAgICBjb25zdCBkaW1lbnNpb25zID0gZGV2aWNlSW5mb01vZHVsZS5leHBvcnRlZERpbWVuc2lvbnMoKS53aW5kb3c7XG4gICAgdGhpcy5hdmFpbGFibGVTaXplID0ge1xuICAgICAgd2lkdGg6IGRpbWVuc2lvbnMud2lkdGgsXG4gICAgICBoZWlnaHQ6IGRpbWVuc2lvbnMuaGVpZ2h0XG4gICAgfTtcblxuICAgIHRoaXMud2lkdGggPSB0aGlzLmF2YWlsYWJsZVNpemUud2lkdGg7XG4gICAgdGhpcy5oZWlnaHQgPSB0aGlzLmF2YWlsYWJsZVNpemUuaGVpZ2h0O1xuXG4gICAgdGhpcy51aU1hbmFnZXIgPSB0aGlzLmJyaWRnZS51aU1hbmFnZXI7XG4gICAgdGhpcy50aW1pbmcgPSAodGhpcy5icmlkZ2UubW9kdWxlc0J5TmFtZVtcIlRpbWluZ1wiXTogYW55KTtcblxuICAgIHRoaXMudG91Y2hIYW5kbGVyID0gbmV3IFJDVFRvdWNoSGFuZGxlcih0aGlzLmJyaWRnZSk7XG4gICAgdGhpcy50b3VjaEhhbmRsZXIuYXR0YWNoVG9WaWV3KHRoaXMpO1xuXG4gICAgdGhpcy51cGRhdGVIb3N0U3R5bGUoe1xuICAgICAgV2Via2l0VGFwSGlnaGxpZ2h0Q29sb3I6IFwidHJhbnNwYXJlbnRcIixcbiAgICAgIHVzZXJTZWxlY3Q6IFwibm9uZVwiLFxuICAgICAgb3ZlcmZsb3c6IFwiaGlkZGVuXCIsXG4gICAgICBwb3NpdGlvbjogXCJmaXhlZFwiXG4gICAgfSk7XG5cbiAgICB0aGlzLnRpY2tpbmcgPSBmYWxzZTtcbiAgfVxuXG4gIGdldCByZWFjdFRhZygpOiBudW1iZXIge1xuICAgIGlmICghdGhpcy5fcmVhY3RUYWcpIHtcbiAgICAgIHRoaXMuX3JlYWN0VGFnID0gdGhpcy51aU1hbmFnZXIuYWxsb2NhdGVSb290VGFnO1xuICAgICAgdGhpcy51aU1hbmFnZXIucmVnaXN0ZXJSb290Vmlldyh0aGlzKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuX3JlYWN0VGFnO1xuICB9XG5cbiAgc2V0IHJlYWN0VGFnKHZhbHVlOiBudW1iZXIpIHt9XG5cbiAgYnVuZGxlRmluaXNoZWRMb2FkaW5nKCkge1xuICAgIHRoaXMucnVuQXBwbGljYXRpb24oKTtcbiAgfVxuXG4gIHJ1bkFwcGxpY2F0aW9uKCkge1xuICAgIGNvbnN0IGFwcFBhcmFtZXRlcnMgPSB7XG4gICAgICByb290VGFnOiB0aGlzLnJlYWN0VGFnLFxuICAgICAgaW5pdGlhbFByb3BzOiB7fVxuICAgIH07XG5cbiAgICB0aGlzLmJyaWRnZS5lbnF1ZXVlSlNDYWxsKFwiQXBwUmVnaXN0cnlcIiwgXCJydW5BcHBsaWNhdGlvblwiLCBbXG4gICAgICB0aGlzLm1vZHVsZU5hbWUsXG4gICAgICBhcHBQYXJhbWV0ZXJzXG4gICAgXSk7XG5cbiAgICBpZiAodGhpcy5lbmFibGVIb3RSZWxvYWQpIHtcbiAgICAgIGNvbnN0IGJ1bmRsZVVSTCA9IG5ldyBVUkwodGhpcy5idW5kbGVMb2NhdGlvbik7XG4gICAgICBjb25zb2xlLndhcm4oXCJIb3RSZWxvYWQgb24gXCIgKyB0aGlzLmJ1bmRsZUxvY2F0aW9uKTtcbiAgICAgIHRoaXMuYnJpZGdlLmVucXVldWVKU0NhbGwoXCJITVJDbGllbnRcIiwgXCJlbmFibGVcIiwgW1xuICAgICAgICBcImRvbVwiLFxuICAgICAgICBidW5kbGVVUkwucGF0aG5hbWUudG9TdHJpbmcoKS5zdWJzdHIoMSksXG4gICAgICAgIGJ1bmRsZVVSTC5ob3N0bmFtZSxcbiAgICAgICAgYnVuZGxlVVJMLnBvcnRcbiAgICAgIF0pO1xuICAgIH1cblxuICAgIHRoaXMucmVxdWVzdFRpY2soKTtcbiAgfVxuXG4gIHJlcXVlc3RUaWNrKCkge1xuICAgIGlmICghdGhpcy50aWNraW5nKSB7XG4gICAgICB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lKHRoaXMucmVuZGVyTG9vcC5iaW5kKHRoaXMpKTtcbiAgICB9XG4gICAgdGhpcy50aWNraW5nID0gdHJ1ZTtcbiAgfVxuXG4gIGFzeW5jIHJlbmRlckxvb3AoKSB7XG4gICAgdGhpcy50aWNraW5nID0gZmFsc2U7XG5cbiAgICBjb25zdCBmcmFtZVN0YXJ0ID0gd2luZG93LnBlcmZvcm1hbmNlID8gcGVyZm9ybWFuY2Uubm93KCkgOiBEYXRlLm5vdygpO1xuXG4gICAgYXdhaXQgaW5zdHJ1bWVudChcIuKam++4jyBUaW1pbmdcIiwgKCkgPT4gdGhpcy50aW1pbmcuZnJhbWUoKSk7XG4gICAgYXdhaXQgaW5zdHJ1bWVudChcIuKam++4jyBCcmlkZ2VcIiwgKCkgPT4gdGhpcy5icmlkZ2UuZnJhbWUoKSk7XG4gICAgYXdhaXQgaW5zdHJ1bWVudChcIuKam++4jyBSZW5kZXJpbmdcIiwgKCkgPT4gdGhpcy51aU1hbmFnZXIuZnJhbWUoKSk7XG5cbiAgICBhd2FpdCB0aGlzLnRpbWluZy5pZGxlKGZyYW1lU3RhcnQpO1xuXG4gICAgaWYgKFxuICAgICAgdGhpcy50aW1pbmcuc2hvdWxkQ29udGludWUoKSB8fFxuICAgICAgdGhpcy5icmlkZ2Uuc2hvdWxkQ29udGludWUoKSB8fFxuICAgICAgdGhpcy51aU1hbmFnZXIuc2hvdWxkQ29udGludWUoKVxuICAgICkge1xuICAgICAgdGhpcy5yZXF1ZXN0VGljaygpO1xuICAgIH1cbiAgfVxuXG4gIGFzeW5jIHJlbmRlcigpIHtcbiAgICBhd2FpdCB0aGlzLmluaXRpYWxpemF0aW9uO1xuXG4gICAgdGhpcy5wYXJlbnQuYXBwZW5kQ2hpbGQodGhpcyk7XG4gICAgdGhpcy5icmlkZ2UubG9hZEJyaWRnZUNvbmZpZygpO1xuICAgIHRoaXMucmVxdWVzdFRpY2soKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBSQ1RSb290VmlldztcbiJdfQ==