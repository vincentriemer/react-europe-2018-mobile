Object.defineProperty(exports,"__esModule",{value:true});var _regenerator=require("babel-runtime/regenerator");var _regenerator2=_interopRequireDefault(_regenerator);var _classCallCheck2=require("babel-runtime/helpers/classCallCheck");var _classCallCheck3=_interopRequireDefault(_classCallCheck2);var _createClass2=require("babel-runtime/helpers/createClass");var _createClass3=_interopRequireDefault(_createClass2);var _possibleConstructorReturn2=require("babel-runtime/helpers/possibleConstructorReturn");var _possibleConstructorReturn3=_interopRequireDefault(_possibleConstructorReturn2);var _inherits2=require("babel-runtime/helpers/inherits");var _inherits3=_interopRequireDefault(_inherits2);var _dec,_class;var _RCTBridge=require("./RCTBridge");var _RCTBridge2=_interopRequireDefault(_RCTBridge);var _UIView2=require("./../base/UIView");var _UIView3=_interopRequireDefault(_UIView2);var _NotificationCenter=require("./../base/NotificationCenter");var _NotificationCenter2=_interopRequireDefault(_NotificationCenter);var _RCTDeviceInfo=require("./../modules/RCTDeviceInfo");var _RCTDeviceInfo2=_interopRequireDefault(_RCTDeviceInfo);var _RCTTiming=require("./../modules/RCTTiming");var _RCTTiming2=_interopRequireDefault(_RCTTiming);var _RCTTouchHandler=require("./../modules/RCTTouchHandler");var _RCTTouchHandler2=_interopRequireDefault(_RCTTouchHandler);var _CustomElement=require("./../utils/CustomElement");var _CustomElement2=_interopRequireDefault(_CustomElement);var _Instrument=require("./../utils/Instrument");var _Instrument2=_interopRequireDefault(_Instrument);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function getAvailableSize(){return{width:window.innerWidth,height:window.innerHeight};}var RCTRootView=(_dec=(0,_CustomElement2.default)("rct-root-view"),_dec(_class=function(_UIView){(0,_inherits3.default)(RCTRootView,_UIView);function RCTRootView(bundle,moduleName,parent){var enableHotReload=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var nativeModules=arguments[4];(0,_classCallCheck3.default)(this,RCTRootView);var _this=(0,_possibleConstructorReturn3.default)(this,(RCTRootView.__proto__||Object.getPrototypeOf(RCTRootView)).call(this));_this.requestTick=function(){if(!_this.ticking){window.requestAnimationFrame(_this.renderLoop.bind(_this));}_this.ticking=true;};_this.bundleLocation=bundle;_this.enableHotReload=enableHotReload;_this.moduleName=moduleName;_this.parent=parent;if(_this.enableHotReload){bundle+="&hot=true";}_this.updateHostStyle("touchAction","none");_this.setAttribute("touch-action","none");var bridge=new _RCTBridge2.default(moduleName,bundle,nativeModules);_this.initialization=_this.initializeBridge(bridge);return _this;}(0,_createClass3.default)(RCTRootView,[{key:"initializeBridge",value:function initializeBridge(bridge){var deviceInfoModule,dimensions;return _regenerator2.default.async(function initializeBridge$(_context){while(1){switch(_context.prev=_context.next){case 0:this.bridge=bridge;this.bridge.bundleFinishedLoading=this.bundleFinishedLoading.bind(this);_context.next=4;return _regenerator2.default.awrap(this.bridge.initializeModules());case 4:deviceInfoModule=this.bridge.modulesByName["DeviceInfo"];dimensions=deviceInfoModule.exportedDimensions().window;this.availableSize={width:dimensions.width,height:dimensions.height};this.width=this.availableSize.width;this.height=this.availableSize.height;this.uiManager=this.bridge.uiManager;this.timing=this.bridge.modulesByName["Timing"];this.touchHandler=new _RCTTouchHandler2.default(this.bridge);this.touchHandler.attachToView(this);this.updateHostStyle({WebkitTapHighlightColor:"transparent",userSelect:"none",overflow:"hidden",position:"fixed"});this.ticking=false;case 15:case"end":return _context.stop();}}},null,this);}},{key:"bundleFinishedLoading",value:function bundleFinishedLoading(){this.runApplication();}},{key:"runApplication",value:function runApplication(){var appParameters={rootTag:this.reactTag,initialProps:{}};this.bridge.enqueueJSCall("AppRegistry","runApplication",[this.moduleName,appParameters]);if(__DEV__&&this.enableHotReload){var bundleURL=new URL(this.bundleLocation);console.warn("HotReload on "+this.bundleLocation);this.bridge.enqueueJSCall("HMRClient","enable",["dom",bundleURL.pathname.toString().substr(1),bundleURL.hostname,bundleURL.port]);}this.requestTick();}},{key:"renderLoop",value:function renderLoop(){var _this2=this;var frameStart;return _regenerator2.default.async(function renderLoop$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:this.ticking=false;frameStart=window.performance?performance.now():Date.now();_context2.next=4;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Timing",function(){return _this2.timing.frame();}));case 4:_context2.next=6;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Bridge",function(){return _this2.bridge.frame();}));case 6:_context2.next=8;return _regenerator2.default.awrap((0,_Instrument2.default)("⚛️ Rendering",function(){return _this2.uiManager.frame();}));case 8:_context2.next=10;return _regenerator2.default.awrap(this.timing.idle(frameStart));case 10:if(this.timing.shouldContinue()||this.bridge.shouldContinue()||this.uiManager.shouldContinue()){this.requestTick();}else{window.setTimeout(this.requestTick,1000);}case 11:case"end":return _context2.stop();}}},null,this);}},{key:"render",value:function render(){return _regenerator2.default.async(function render$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:_context3.next=2;return _regenerator2.default.awrap(this.initialization);case 2:this.parent.appendChild(this);this.bridge.loadBridgeConfig();this.requestTick();case 5:case"end":return _context3.stop();}}},null,this);}},{key:"reactTag",get:function get(){if(!this._reactTag){this._reactTag=this.uiManager.allocateRootTag;this.uiManager.registerRootView(this);}return this._reactTag;},set:function set(value){}}]);return RCTRootView;}(_UIView3.default))||_class);exports.default=RCTRootView;
//# sourceMappingURL=RCTRootView.js.map